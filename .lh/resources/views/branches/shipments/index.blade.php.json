{
    "sourceFile": "resources/views/branches/shipments/index.blade.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 16,
            "patches": [
                {
                    "date": 1733726932267,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1733726939043,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -93,9 +93,9 @@\n                                     <th>Sender<br>Name</th>\n                                     <th>Sender<br>Phone</th>\n                                     <th>Receiver<br>Name</th>\n                                     <th>Receiver<br>Country</th>\n-                                    <th>Receiver<br>Country</th>\n+                                    <th>Document<br>Country</th>\n                                     <th>Receiver<br>State</th>\n                                     <th>Shipping<br>Status</th>\n                                     <th>Payment<br>Method</th>\n                                     <th>Courier<br>Company</th>\n"
                },
                {
                    "date": 1733726946920,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,374 @@\n+@extends('layouts.app')\n+\n+@section('content')\n+\n+    <div class=\"content-page\" id=\"content-page\">\n+        <div class=\"content\">\n+\n+            <!-- Start Content-->\n+            <div class=\"container-fluid\">\n+\n+                <!-- start page title -->\n+                <div class=\"row\">\n+                    <div class=\"col-12\">\n+                        <div class=\"page-title-box\">\n+                            <div class=\"page-title-right\">\n+                                {!! breadcrumbs() !!}\n+                            </div>\n+                            <h4 class=\"page-title\">Invoices</h4>\n+                            @can(permission_create())\n+                                <div class=\"fa-pull-right pb-3\"><a href=\"{{create_url()}}\"\n+                                                                   class=\"btn btn-success\">Add New</a></div>\n+                            @endcan\n+                        </div>\n+                    </div>\n+\n+                </div>\n+\n+\n+                <div class=\"row\">\n+                    <div class=\"col-sm-12\">\n+\n+                        <div class=\"card-box table-responsive\">\n+{{--                            <form action=\"\" method=\"get\">--}}\n+{{--                                <div class=\"row justify-content-center\">--}}\n+\n+{{--                                    <div class=\"form-group\">--}}\n+{{--                                        <input type=\"date\" value=\"{{date('Y-m-d')}}\" max=\"{{date('Y-m-d')}}\"--}}\n+{{--                                               class=\"form-control\" id=\"propertyname\" name=\"date\"--}}\n+{{--                                               placeholder=\"Enter title\">--}}\n+{{--                                    </div>--}}\n+{{--                                    <div class=\"pl-1\">--}}\n+{{--                                        <button type=\"submit\" class=\"btn btn-success waves-effect waves-light\">Submit--}}\n+{{--                                        </button>--}}\n+{{--                                    </div>--}}\n+\n+{{--                                </div>--}}\n+{{--                            </form>--}}\n+\n+                            <div class=\"d-flex justify-content-end\" >\n+                                <form action=\"/branch/shipment\" class=\"d-flex\" id=\"shipmentForm\">\n+                                    <div class=\"row\">\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <input type=\"text\" name=\"from_date\" class=\"form-control datepicker\"  placeholder=\"From date\" value=\"{{ request('from_date') }}\">\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <input type=\"text\" name=\"to_date\" class=\"form-control datepicker\"    placeholder=\"To date\" value=\"{{ request('to_date') }}\">\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-3\">\n+                                            <div class=\"form-group\">\n+                                                <input name=\"search\" value=\"{{$search??''}}\" class=\"form-control \" type=\"search\" placeholder=\"Search\" aria-label=\"Search\">\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <button class=\"btn btn-info t-5\" type=\"submit\">Search</button>\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <a href=\"#\" class=\"btn btn-success\" id=\"exportButton\">Export</a>\n+                                            </div>\n+                                        </div>\n+                                    </div>\n+                                  </form>\n+                            </div>\n+                            <table id=\"bookingdatatable\"\n+                                   class=\"table table-striped table-bordered dt-responsive nowrap\"\n+                                   style=\"border-collapse: collapse; border-spacing: 0; width: 100%;\">\n+                                <thead>\n+\n+                                <tr>\n+                                    @canany([permission_edit(),permission_view(),'shipment-show'])\n+                                        <th style=\"text-align: center\">Action</th>\n+                                    @endcanany\n+                                    <th>Book<br>No</th>\n+                                    <th>No<br>Pcs</th>\n+                                    <th>Tot<br>Wgt</th>\n+                                    <th>Shipment <br>Type</th>\n+                                    <thd>Sender<br>Name</thd\n+                                    <th>Sender<br>Phone</th>\n+                                    <th>Receiver<br>Name</th>\n+                                    <th>Receiver<br>Country</th>\n+                                    <th>Document<br>ID</th>\n+                                    <th>Receiver<br>State</th>\n+                                    <th>Shipping<br>Status</th>\n+                                    <th>Payment<br>Method</th>\n+                                    <th>Courier<br>Company</th>\n+                                    <th>Driver/<br>Staff</th>\n+                                    <th>Date</th>\n+\n+                                </tr>\n+\n+                                </thead>\n+\n+                                <tbody>\n+                                    <?php\n+                                        $lastStatus = '';\n+                                        $statusList = [];\n+                                    ?>\n+                                @foreach($shipments as $key=> $shipment)\n+\n+                                <?php\n+                                    // if(!empty($shipment->statusVal->name)){\n+                                        // if($shipment->statusVal->name == \"Enquiry collected\") {\n+                                        //     $showAddItems = true;\n+                                        //     $style =\"style=background-color:yellow;padding:5px;\";\n+                                        // } else {\n+                                        //     $style =\"style=background-color:none\";\n+                                        //     $showAddItems = false;\n+                                        // }\n+                                    // }\n+                                    $status = '';\n+                                    $lastStatus = '';\n+                                    $statusList = '';\n+\n+                                    $status = $shipment->statusVal->name;\n+                                    foreach($shipment->boxes as $box) {\n+                                        if(($box->boxStatuses != null)) {\n+                                            $statusList = $shipment->last_status;\n+                                        }\n+                                    }\n+\n+\n+                                    $lastStatus = (!empty($statusList) ) ? $statusList : $status ;\n+                                    if($lastStatus == 'Enquiry collected') {\n+                                            $showAddItems = true;\n+                                            $style =\"style=background-color:yellow;padding:5px;\";\n+                                    } else {\n+                                        $style =\"style=background-color:none\";\n+                                        $showAddItems = false;\n+                                    }\n+                                    $statusss = null;\n+                                    if ($shipment->boxes->isEmpty()) {\n+                                        $statusss = $shipment->status_id;\n+                                    } else {\n+                                        if($statusss == 15 || $statusss == 1 || $statusss == null) {\n+\n+                                            foreach ($shipment->boxes as $box) {\n+                                                $latestStatus = $box->boxStatuses()->orderBy('id', 'desc')->first();\n+                                                if ($latestStatus && ($latestStatus->id != 15 && $latestStatus->id != 1)) {\n+                                                    $statusss = $latestStatus->status_id;\n+                                                    break;\n+                                                }\n+                                            }\n+                                        }\n+                                        else{\n+                                            $statusss = $shipment->status_id;\n+                                        }\n+\n+                                    }\n+                                ?>\n+                                    <tr>\n+                                        <td>\n+                                            @can(permission_edit())\n+                                            @if(branch()->id == $shipment->branch_id)\n+                                                <a href=\"{{edit_url($shipment->id)}}\"\n+                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning editBtn\" ststus=\"{{$statusss}}\" statusName=\"{{  $lastStatus??'' }}\">\n+                                                    <i class=\"fas  fa-lg fa-pencil-alt\"></i>\n+                                                </a>\n+                                            @endif\n+                                            @endcan\n+                                            @can(permission_view())\n+                                                <a href=\"{{show_url($shipment->id)}}\"\n+                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-success \">\n+                                                    <i class=\"fas  fa-lg fa-eye\"></i>\n+                                                </a>\n+                                            @endcan\n+                                            @can('shipment-print')\n+                                                <a href=\"{{route('branch.shipment.print',$shipment->id)}}\" target=\"_blank\"\n+                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\">\n+                                                    <i class=\"fas  fa-lg fa-print\"   title=\"Customs copy\"></i>\n+                                                </a>\n+\n+                                                <!--<a href=\"{{route('branch.shipment.print_customer',$shipment->id)}}\" target=\"_blank\"-->\n+                                                <!--    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\" style=\"background:#1274bb; border: 0px;\"  >-->\n+                                                <!--    <i class=\"fas  fa-lg fa-print\"   title=\"Customer copy\"></i>-->\n+                                                <!--</a>-->\n+\n+                                            @endcan\n+                                            @if($showAddItems)\n+                                                @if(branch()->id == $shipment->branch_id)\n+                                                    <a href=\"{{edit_url($shipment->id)}}\"\n+                                                        class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning\" >\n+                                                        <i class=\"fas  fa-lg fa-plus\"></i>\n+                                                    </a>\n+                                                @endif\n+                                            @endif\n+                                        </td>\n+                                        <td>{{ $shipment->booking_number }}</td>\n+                                        <td>{{ $shipment->number_of_pcs?$shipment->number_of_pcs: $shipment->number_of_pcs_create }}</td>\n+                                        <td>{{ $shipment->grand_total_weight }}</td>\n+                                        <td>{{ $shipment->shipMethType->name??\"\" }}</td>\n+                                        <td>{{ $shipment->sender->name }}</td>\n+                                        <td>{{ $shipment->sender->phone??'-' }}</td>\n+                                        <td>{{ $shipment->receiver->name??\"\"}}</td>\n+                                        <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n+                                        <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n+                                        <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n+                                        <td>{{ $shipment->payment_method }}</td>\n+                                        <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n+                                        <td>    @if($shipment->collected_by == 'driver')\n+                                                    {{ $shipment->driver?$shipment->driver->name:'-'}}\n+                                                @else\n+                                                    {{$shipment->staff?$shipment->staff->full_name:'-'}}\n+                                                @endif\n+                                        </td>\n+                                        <td>{{ !empty($shipment->created_date)? date('d-m-Y', strtotime($shipment->created_date)):''  }}</td>\n+\n+                                        <!-- @canany([permission_edit(),permission_view(),'shipment-show'])\n+                                            <form method=\"post\" action=\"{{delete_url($shipment->id)}}\"> -->\n+                                                <!-- <td>\n+                                                    @can(permission_edit())\n+                                                        <a href=\"{{edit_url($shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n+                                                            <i class=\"fas fa-pencil-alt\"></i>\n+                                                        </a>\n+                                                    @endcan\n+                                                    @can(permission_view())\n+                                                        <a href=\"{{show_url($shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-success\">\n+                                                            <i class=\"fas fa-eye\"></i>\n+                                                        </a>\n+                                                    @endcan\n+                                                    @can('shipment-print')\n+                                                        <a href=\"{{route('branch.shipment.print',$shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-dark\">\n+                                                            <i class=\"fas fa-print\"></i>\n+                                                        </a>\n+                                                    @endcan\n+                                                    @if($showAddItems)\n+                                                        <a href=\"{{route('branch.shipment.item',$shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n+                                                            <i class=\"fas fa-plus\"></i>\n+                                                        </a>\n+                                                    @endif\n+                                                </td> -->\n+                                            <!-- </form> -->\n+                                        <!-- @endcanany -->\n+                                    </tr>\n+                                @endforeach\n+                                </tbody>\n+                            </table>\n+                            <div class=\"d-flex justify-content-end\">\n+                                {{ $shipments->onEachSide(1)->links() }}\n+                            </div>\n+\n+                        </div>\n+                    </div>\n+                </div>\n+\n+            </div>\n+            <!-- end container-fluid -->\n+\n+        </div>\n+        <!-- end content -->\n+\n+        <div class=\"modal fade\" id=\"exampleModalCenter\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalCenterTitle\" aria-hidden=\"true\">\n+            <div class=\"modal-dialog modal-dialog-centered\" role=\"document\">\n+              <div class=\"modal-content\">\n+                <div class=\"modal-header\">\n+                  <h5 class=\"modal-title\" id=\"exampleModalLongTitle\">Enter access key</h5>\n+                  <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n+                    <span aria-hidden=\"true\">&times;</span>\n+                  </button>\n+                </div>\n+                <div class=\"modal-body\">\n+                  <div class=\"form-group\">\n+                    <input type=\"password\" class=\"form-control\" id=\"passkey\">\n+                  </div>\n+                </div>\n+                <div class=\"modal-footer justify-content-center\">\n+                  {{-- <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button> --}}\n+                  <button type=\"button\" class=\"btn btn-primary\" id=\"passkeyBtn\">Submit</button>\n+                </div>\n+              </div>\n+            </div>\n+        </div>\n+\n+@endsection\n+@section('styles')\n+    @include('layouts.datatables_style')\n+@endsection\n+\n+@section('scripts')\n+    @include('layouts.datatables_js')\n+    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js\"></script>\n+    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js\"></script>\n+    @if(session('showModal'))\n+        <script>\n+            $(document).ready(function() {\n+                $('#exampleModalCenter').modal('show');\n+            });\n+        </script>\n+    @endif\n+    <script>\n+\n+$(document).ready(function () {\n+    $('#bookingdatatable').DataTable({\n+        \"autoWidth\": false,\n+        \"aaSorting\": [ [0,'desc'] ],\n+        \"scrollX\": true,\n+        \"paging\": false,\n+        \"responsive\": false,\n+        \"searching\": false\n+    });\n+\n+    $('.datepicker').datepicker({\n+        format: 'dd/mm/yyyy',\n+        autoclose: true,\n+        todayHighlight: true\n+    });\n+\n+\n+    $('#exportButton').click(function(event) {\n+        event.preventDefault();\n+\n+        var formData = $('#shipmentForm').serialize();\n+\n+        var exportUrl = '/branch/shipment/export?' + formData;\n+\n+        window.location.href = exportUrl;\n+    });\n+\n+    $('.editBtn').click(function(event) {\n+        event.preventDefault();\n+        var status = $(this).attr('ststus') || null;\n+        var statusName = $(this).attr('statusName');\n+        console.log(statusName);\n+        var url = $(this).attr('href');\n+        if(statusName == \"Shipment received\" || statusName == \"Enquiry collected\"){\n+            if(status == 15 || status == 1 || status == 2 || status == null ){\n+            window.location.href = url;\n+            }\n+            else{\n+                $('#passkey').attr('data-url', url);\n+                $('#exampleModalCenter').modal('show');\n+            }\n+        }\n+        else{\n+            $('#passkey').attr('data-url', url);\n+            $('#exampleModalCenter').modal('show');\n+        }\n+    });\n+\n+    $('#passkeyBtn').click(function(event) {\n+        var passkey = $('#passkey').val();\n+        var url = $('#passkey').data('url');\n+        var encryptedPasskey = CryptoJS.SHA256(passkey).toString();\n+\n+        var exportUrl = url + '?password=' + encodeURIComponent(encryptedPasskey);\n+\n+        window.location.href = exportUrl;\n+    });\n+\n+\n+\n+});\n+\n+    </script>\n+@endsection\n"
                },
                {
                    "date": 1733726953819,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,374 @@\n+@extends('layouts.app')\n+\n+@section('content')\n+\n+    <div class=\"content-page\" id=\"content-page\">\n+        <div class=\"content\">\n+\n+            <!-- Start Content-->\n+            <div class=\"container-fluid\">\n+\n+                <!-- start page title -->\n+                <div class=\"row\">\n+                    <div class=\"col-12\">\n+                        <div class=\"page-title-box\">\n+                            <div class=\"page-title-right\">\n+                                {!! breadcrumbs() !!}\n+                            </div>\n+                            <h4 class=\"page-title\">Invoices</h4>\n+                            @can(permission_create())\n+                                <div class=\"fa-pull-right pb-3\"><a href=\"{{create_url()}}\"\n+                                                                   class=\"btn btn-success\">Add New</a></div>\n+                            @endcan\n+                        </div>\n+                    </div>\n+\n+                </div>\n+\n+\n+                <div class=\"row\">\n+                    <div class=\"col-sm-12\">\n+\n+                        <div class=\"card-box table-responsive\">\n+{{--                            <form action=\"\" method=\"get\">--}}\n+{{--                                <div class=\"row justify-content-center\">--}}\n+\n+{{--                                    <div class=\"form-group\">--}}\n+{{--                                        <input type=\"date\" value=\"{{date('Y-m-d')}}\" max=\"{{date('Y-m-d')}}\"--}}\n+{{--                                               class=\"form-control\" id=\"propertyname\" name=\"date\"--}}\n+{{--                                               placeholder=\"Enter title\">--}}\n+{{--                                    </div>--}}\n+{{--                                    <div class=\"pl-1\">--}}\n+{{--                                        <button type=\"submit\" class=\"btn btn-success waves-effect waves-light\">Submit--}}\n+{{--                                        </button>--}}\n+{{--                                    </div>--}}\n+\n+{{--                                </div>--}}\n+{{--                            </form>--}}\n+\n+                            <div class=\"d-flex justify-content-end\" >\n+                                <form action=\"/branch/shipment\" class=\"d-flex\" id=\"shipmentForm\">\n+                                    <div class=\"row\">\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <input type=\"text\" name=\"from_date\" class=\"form-control datepicker\"  placeholder=\"From date\" value=\"{{ request('from_date') }}\">\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <input type=\"text\" name=\"to_date\" class=\"form-control datepicker\"    placeholder=\"To date\" value=\"{{ request('to_date') }}\">\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-3\">\n+                                            <div class=\"form-group\">\n+                                                <input name=\"search\" value=\"{{$search??''}}\" class=\"form-control \" type=\"search\" placeholder=\"Search\" aria-label=\"Search\">\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <button class=\"btn btn-info t-5\" type=\"submit\">Search</button>\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <a href=\"#\" class=\"btn btn-success\" id=\"exportButton\">Export</a>\n+                                            </div>\n+                                        </div>\n+                                    </div>\n+                                  </form>\n+                            </div>\n+                            <table id=\"bookingdatatable\"\n+                                   class=\"table table-striped table-bordered dt-responsive nowrap\"\n+                                   style=\"border-collapse: collapse; border-spacing: 0; width: 100%;\">\n+                                <thead>\n+\n+                                <tr>\n+                                    @canany([permission_edit(),permission_view(),'shipment-show'])\n+                                        <th style=\"text-align: center\">Action</th>\n+                                    @endcanany\n+                                    <th>Book<br>No</th>\n+                                    <th>No<br>Pcs</th>\n+                                    <th>Tot<br>Wgt</th>\n+                                    <th>Shipment <br>Type</th>\n+                                    <th>Sender<br>Name</th>\n+                                    <th>Sender<br>Phone</th>\n+                                    <th>Receiver<br>Name</th>\n+                                    <th>Receiver<br>Country</th>\n+                                    <th>Document<br>Id</th>\n+                                    <th>Receiver<br>State</th>\n+                                    <th>Shipping<br>Status</th>\n+                                    <th>Payment<br>Method</th>\n+                                    <th>Courier<br>Company</th>\n+                                    <th>Driver/<br>Staff</th>\n+                                    <th>Date</th>\n+\n+                                </tr>\n+\n+                                </thead>\n+\n+                                <tbody>\n+                                    <?php\n+                                        $lastStatus = '';\n+                                        $statusList = [];\n+                                    ?>\n+                                @foreach($shipments as $key=> $shipment)\n+\n+                                <?php\n+                                    // if(!empty($shipment->statusVal->name)){\n+                                        // if($shipment->statusVal->name == \"Enquiry collected\") {\n+                                        //     $showAddItems = true;\n+                                        //     $style =\"style=background-color:yellow;padding:5px;\";\n+                                        // } else {\n+                                        //     $style =\"style=background-color:none\";\n+                                        //     $showAddItems = false;\n+                                        // }\n+                                    // }\n+                                    $status = '';\n+                                    $lastStatus = '';\n+                                    $statusList = '';\n+\n+                                    $status = $shipment->statusVal->name;\n+                                    foreach($shipment->boxes as $box) {\n+                                        if(($box->boxStatuses != null)) {\n+                                            $statusList = $shipment->last_status;\n+                                        }\n+                                    }\n+\n+\n+                                    $lastStatus = (!empty($statusList) ) ? $statusList : $status ;\n+                                    if($lastStatus == 'Enquiry collected') {\n+                                            $showAddItems = true;\n+                                            $style =\"style=background-color:yellow;padding:5px;\";\n+                                    } else {\n+                                        $style =\"style=background-color:none\";\n+                                        $showAddItems = false;\n+                                    }\n+                                    $statusss = null;\n+                                    if ($shipment->boxes->isEmpty()) {\n+                                        $statusss = $shipment->status_id;\n+                                    } else {\n+                                        if($statusss == 15 || $statusss == 1 || $statusss == null) {\n+\n+                                            foreach ($shipment->boxes as $box) {\n+                                                $latestStatus = $box->boxStatuses()->orderBy('id', 'desc')->first();\n+                                                if ($latestStatus && ($latestStatus->id != 15 && $latestStatus->id != 1)) {\n+                                                    $statusss = $latestStatus->status_id;\n+                                                    break;\n+                                                }\n+                                            }\n+                                        }\n+                                        else{\n+                                            $statusss = $shipment->status_id;\n+                                        }\n+\n+                                    }\n+                                ?>\n+                                    <tr>\n+                                        <td>\n+                                            @can(permission_edit())\n+                                            @if(branch()->id == $shipment->branch_id)\n+                                                <a href=\"{{edit_url($shipment->id)}}\"\n+                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning editBtn\" ststus=\"{{$statusss}}\" statusName=\"{{  $lastStatus??'' }}\">\n+                                                    <i class=\"fas  fa-lg fa-pencil-alt\"></i>\n+                                                </a>\n+                                            @endif\n+                                            @endcan\n+                                            @can(permission_view())\n+                                                <a href=\"{{show_url($shipment->id)}}\"\n+                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-success \">\n+                                                    <i class=\"fas  fa-lg fa-eye\"></i>\n+                                                </a>\n+                                            @endcan\n+                                            @can('shipment-print')\n+                                                <a href=\"{{route('branch.shipment.print',$shipment->id)}}\" target=\"_blank\"\n+                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\">\n+                                                    <i class=\"fas  fa-lg fa-print\"   title=\"Customs copy\"></i>\n+                                                </a>\n+\n+                                                <!--<a href=\"{{route('branch.shipment.print_customer',$shipment->id)}}\" target=\"_blank\"-->\n+                                                <!--    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\" style=\"background:#1274bb; border: 0px;\"  >-->\n+                                                <!--    <i class=\"fas  fa-lg fa-print\"   title=\"Customer copy\"></i>-->\n+                                                <!--</a>-->\n+\n+                                            @endcan\n+                                            @if($showAddItems)\n+                                                @if(branch()->id == $shipment->branch_id)\n+                                                    <a href=\"{{edit_url($shipment->id)}}\"\n+                                                        class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning\" >\n+                                                        <i class=\"fas  fa-lg fa-plus\"></i>\n+                                                    </a>\n+                                                @endif\n+                                            @endif\n+                                        </td>\n+                                        <td>{{ $shipment->booking_number }}</td>\n+                                        <td>{{ $shipment->number_of_pcs?$shipment->number_of_pcs: $shipment->number_of_pcs_create }}</td>\n+                                        <td>{{ $shipment->grand_total_weight }}</td>\n+                                        <td>{{ $shipment->shipMethType->name??\"\" }}</td>\n+                                        <td>{{ $shipment->sender->name }}</td>\n+                                        <td>{{ $shipment->sender->phone??'-' }}</td>\n+                                        <td>{{ $shipment->receiver->name??\"\"}}</td>\n+                                        <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n+                                        <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n+                                        <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n+                                        <td>{{ $shipment->payment_method }}</td>\n+                                        <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n+                                        <td>    @if($shipment->collected_by == 'driver')\n+                                                    {{ $shipment->driver?$shipment->driver->name:'-'}}\n+                                                @else\n+                                                    {{$shipment->staff?$shipment->staff->full_name:'-'}}\n+                                                @endif\n+                                        </td>\n+                                        <td>{{ !empty($shipment->created_date)? date('d-m-Y', strtotime($shipment->created_date)):''  }}</td>\n+\n+                                        <!-- @canany([permission_edit(),permission_view(),'shipment-show'])\n+                                            <form method=\"post\" action=\"{{delete_url($shipment->id)}}\"> -->\n+                                                <!-- <td>\n+                                                    @can(permission_edit())\n+                                                        <a href=\"{{edit_url($shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n+                                                            <i class=\"fas fa-pencil-alt\"></i>\n+                                                        </a>\n+                                                    @endcan\n+                                                    @can(permission_view())\n+                                                        <a href=\"{{show_url($shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-success\">\n+                                                            <i class=\"fas fa-eye\"></i>\n+                                                        </a>\n+                                                    @endcan\n+                                                    @can('shipment-print')\n+                                                        <a href=\"{{route('branch.shipment.print',$shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-dark\">\n+                                                            <i class=\"fas fa-print\"></i>\n+                                                        </a>\n+                                                    @endcan\n+                                                    @if($showAddItems)\n+                                                        <a href=\"{{route('branch.shipment.item',$shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n+                                                            <i class=\"fas fa-plus\"></i>\n+                                                        </a>\n+                                                    @endif\n+                                                </td> -->\n+                                            <!-- </form> -->\n+                                        <!-- @endcanany -->\n+                                    </tr>\n+                                @endforeach\n+                                </tbody>\n+                            </table>\n+                            <div class=\"d-flex justify-content-end\">\n+                                {{ $shipments->onEachSide(1)->links() }}\n+                            </div>\n+\n+                        </div>\n+                    </div>\n+                </div>\n+\n+            </div>\n+            <!-- end container-fluid -->\n+\n+        </div>\n+        <!-- end content -->\n+\n+        <div class=\"modal fade\" id=\"exampleModalCenter\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalCenterTitle\" aria-hidden=\"true\">\n+            <div class=\"modal-dialog modal-dialog-centered\" role=\"document\">\n+              <div class=\"modal-content\">\n+                <div class=\"modal-header\">\n+                  <h5 class=\"modal-title\" id=\"exampleModalLongTitle\">Enter access key</h5>\n+                  <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n+                    <span aria-hidden=\"true\">&times;</span>\n+                  </button>\n+                </div>\n+                <div class=\"modal-body\">\n+                  <div class=\"form-group\">\n+                    <input type=\"password\" class=\"form-control\" id=\"passkey\">\n+                  </div>\n+                </div>\n+                <div class=\"modal-footer justify-content-center\">\n+                  {{-- <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button> --}}\n+                  <button type=\"button\" class=\"btn btn-primary\" id=\"passkeyBtn\">Submit</button>\n+                </div>\n+              </div>\n+            </div>\n+        </div>\n+\n+@endsection\n+@section('styles')\n+    @include('layouts.datatables_style')\n+@endsection\n+\n+@section('scripts')\n+    @include('layouts.datatables_js')\n+    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js\"></script>\n+    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js\"></script>\n+    @if(session('showModal'))\n+        <script>\n+            $(document).ready(function() {\n+                $('#exampleModalCenter').modal('show');\n+            });\n+        </script>\n+    @endif\n+    <script>\n+\n+$(document).ready(function () {\n+    $('#bookingdatatable').DataTable({\n+        \"autoWidth\": false,\n+        \"aaSorting\": [ [0,'desc'] ],\n+        \"scrollX\": true,\n+        \"paging\": false,\n+        \"responsive\": false,\n+        \"searching\": false\n+    });\n+\n+    $('.datepicker').datepicker({\n+        format: 'dd/mm/yyyy',\n+        autoclose: true,\n+        todayHighlight: true\n+    });\n+\n+\n+    $('#exportButton').click(function(event) {\n+        event.preventDefault();\n+\n+        var formData = $('#shipmentForm').serialize();\n+\n+        var exportUrl = '/branch/shipment/export?' + formData;\n+\n+        window.location.href = exportUrl;\n+    });\n+\n+    $('.editBtn').click(function(event) {\n+        event.preventDefault();\n+        var status = $(this).attr('ststus') || null;\n+        var statusName = $(this).attr('statusName');\n+        console.log(statusName);\n+        var url = $(this).attr('href');\n+        if(statusName == \"Shipment received\" || statusName == \"Enquiry collected\"){\n+            if(status == 15 || status == 1 || status == 2 || status == null ){\n+            window.location.href = url;\n+            }\n+            else{\n+                $('#passkey').attr('data-url', url);\n+                $('#exampleModalCenter').modal('show');\n+            }\n+        }\n+        else{\n+            $('#passkey').attr('data-url', url);\n+            $('#exampleModalCenter').modal('show');\n+        }\n+    });\n+\n+    $('#passkeyBtn').click(function(event) {\n+        var passkey = $('#passkey').val();\n+        var url = $('#passkey').data('url');\n+        var encryptedPasskey = CryptoJS.SHA256(passkey).toString();\n+\n+        var exportUrl = url + '?password=' + encodeURIComponent(encryptedPasskey);\n+\n+        window.location.href = exportUrl;\n+    });\n+\n+\n+\n+});\n+\n+    </script>\n+@endsection\n"
                },
                {
                    "date": 1733727011903,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -93,9 +93,9 @@\n                                     <th>Sender<br>Name</th>\n                                     <th>Sender<br>Phone</th>\n                                     <th>Receiver<br>Name</th>\n                                     <th>Receiver<br>Country</th>\n-                                    <th>Document<br>Id</th>\n+                                   \n                                     <th>Receiver<br>State</th>\n                                     <th>Shipping<br>Status</th>\n                                     <th>Payment<br>Method</th>\n                                     <th>Courier<br>Company</th>\n@@ -371,752 +371,4 @@\n });\n \n     </script>\n @endsection\n-@extends('layouts.app')\n-\n-@section('content')\n-\n-    <div class=\"content-page\" id=\"content-page\">\n-        <div class=\"content\">\n-\n-            <!-- Start Content-->\n-            <div class=\"container-fluid\">\n-\n-                <!-- start page title -->\n-                <div class=\"row\">\n-                    <div class=\"col-12\">\n-                        <div class=\"page-title-box\">\n-                            <div class=\"page-title-right\">\n-                                {!! breadcrumbs() !!}\n-                            </div>\n-                            <h4 class=\"page-title\">Invoices</h4>\n-                            @can(permission_create())\n-                                <div class=\"fa-pull-right pb-3\"><a href=\"{{create_url()}}\"\n-                                                                   class=\"btn btn-success\">Add New</a></div>\n-                            @endcan\n-                        </div>\n-                    </div>\n-\n-                </div>\n-\n-\n-                <div class=\"row\">\n-                    <div class=\"col-sm-12\">\n-\n-                        <div class=\"card-box table-responsive\">\n-{{--                            <form action=\"\" method=\"get\">--}}\n-{{--                                <div class=\"row justify-content-center\">--}}\n-\n-{{--                                    <div class=\"form-group\">--}}\n-{{--                                        <input type=\"date\" value=\"{{date('Y-m-d')}}\" max=\"{{date('Y-m-d')}}\"--}}\n-{{--                                               class=\"form-control\" id=\"propertyname\" name=\"date\"--}}\n-{{--                                               placeholder=\"Enter title\">--}}\n-{{--                                    </div>--}}\n-{{--                                    <div class=\"pl-1\">--}}\n-{{--                                        <button type=\"submit\" class=\"btn btn-success waves-effect waves-light\">Submit--}}\n-{{--                                        </button>--}}\n-{{--                                    </div>--}}\n-\n-{{--                                </div>--}}\n-{{--                            </form>--}}\n-\n-                            <div class=\"d-flex justify-content-end\" >\n-                                <form action=\"/branch/shipment\" class=\"d-flex\" id=\"shipmentForm\">\n-                                    <div class=\"row\">\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <input type=\"text\" name=\"from_date\" class=\"form-control datepicker\"  placeholder=\"From date\" value=\"{{ request('from_date') }}\">\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <input type=\"text\" name=\"to_date\" class=\"form-control datepicker\"    placeholder=\"To date\" value=\"{{ request('to_date') }}\">\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-3\">\n-                                            <div class=\"form-group\">\n-                                                <input name=\"search\" value=\"{{$search??''}}\" class=\"form-control \" type=\"search\" placeholder=\"Search\" aria-label=\"Search\">\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <button class=\"btn btn-info t-5\" type=\"submit\">Search</button>\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <a href=\"#\" class=\"btn btn-success\" id=\"exportButton\">Export</a>\n-                                            </div>\n-                                        </div>\n-                                    </div>\n-                                  </form>\n-                            </div>\n-                            <table id=\"bookingdatatable\"\n-                                   class=\"table table-striped table-bordered dt-responsive nowrap\"\n-                                   style=\"border-collapse: collapse; border-spacing: 0; width: 100%;\">\n-                                <thead>\n-\n-                                <tr>\n-                                    @canany([permission_edit(),permission_view(),'shipment-show'])\n-                                        <th style=\"text-align: center\">Action</th>\n-                                    @endcanany\n-                                    <th>Book<br>No</th>\n-                                    <th>No<br>Pcs</th>\n-                                    <th>Tot<br>Wgt</th>\n-                                    <th>Shipment <br>Type</th>\n-                                    <thd>Sender<br>Name</thd\n-                                    <th>Sender<br>Phone</th>\n-                                    <th>Receiver<br>Name</th>\n-                                    <th>Receiver<br>Country</th>\n-                                    <th>Document<br>ID</th>\n-                                    <th>Receiver<br>State</th>\n-                                    <th>Shipping<br>Status</th>\n-                                    <th>Payment<br>Method</th>\n-                                    <th>Courier<br>Company</th>\n-                                    <th>Driver/<br>Staff</th>\n-                                    <th>Date</th>\n-\n-                                </tr>\n-\n-                                </thead>\n-\n-                                <tbody>\n-                                    <?php\n-                                        $lastStatus = '';\n-                                        $statusList = [];\n-                                    ?>\n-                                @foreach($shipments as $key=> $shipment)\n-\n-                                <?php\n-                                    // if(!empty($shipment->statusVal->name)){\n-                                        // if($shipment->statusVal->name == \"Enquiry collected\") {\n-                                        //     $showAddItems = true;\n-                                        //     $style =\"style=background-color:yellow;padding:5px;\";\n-                                        // } else {\n-                                        //     $style =\"style=background-color:none\";\n-                                        //     $showAddItems = false;\n-                                        // }\n-                                    // }\n-                                    $status = '';\n-                                    $lastStatus = '';\n-                                    $statusList = '';\n-\n-                                    $status = $shipment->statusVal->name;\n-                                    foreach($shipment->boxes as $box) {\n-                                        if(($box->boxStatuses != null)) {\n-                                            $statusList = $shipment->last_status;\n-                                        }\n-                                    }\n-\n-\n-                                    $lastStatus = (!empty($statusList) ) ? $statusList : $status ;\n-                                    if($lastStatus == 'Enquiry collected') {\n-                                            $showAddItems = true;\n-                                            $style =\"style=background-color:yellow;padding:5px;\";\n-                                    } else {\n-                                        $style =\"style=background-color:none\";\n-                                        $showAddItems = false;\n-                                    }\n-                                    $statusss = null;\n-                                    if ($shipment->boxes->isEmpty()) {\n-                                        $statusss = $shipment->status_id;\n-                                    } else {\n-                                        if($statusss == 15 || $statusss == 1 || $statusss == null) {\n-\n-                                            foreach ($shipment->boxes as $box) {\n-                                                $latestStatus = $box->boxStatuses()->orderBy('id', 'desc')->first();\n-                                                if ($latestStatus && ($latestStatus->id != 15 && $latestStatus->id != 1)) {\n-                                                    $statusss = $latestStatus->status_id;\n-                                                    break;\n-                                                }\n-                                            }\n-                                        }\n-                                        else{\n-                                            $statusss = $shipment->status_id;\n-                                        }\n-\n-                                    }\n-                                ?>\n-                                    <tr>\n-                                        <td>\n-                                            @can(permission_edit())\n-                                            @if(branch()->id == $shipment->branch_id)\n-                                                <a href=\"{{edit_url($shipment->id)}}\"\n-                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning editBtn\" ststus=\"{{$statusss}}\" statusName=\"{{  $lastStatus??'' }}\">\n-                                                    <i class=\"fas  fa-lg fa-pencil-alt\"></i>\n-                                                </a>\n-                                            @endif\n-                                            @endcan\n-                                            @can(permission_view())\n-                                                <a href=\"{{show_url($shipment->id)}}\"\n-                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-success \">\n-                                                    <i class=\"fas  fa-lg fa-eye\"></i>\n-                                                </a>\n-                                            @endcan\n-                                            @can('shipment-print')\n-                                                <a href=\"{{route('branch.shipment.print',$shipment->id)}}\" target=\"_blank\"\n-                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\">\n-                                                    <i class=\"fas  fa-lg fa-print\"   title=\"Customs copy\"></i>\n-                                                </a>\n-\n-                                                <!--<a href=\"{{route('branch.shipment.print_customer',$shipment->id)}}\" target=\"_blank\"-->\n-                                                <!--    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\" style=\"background:#1274bb; border: 0px;\"  >-->\n-                                                <!--    <i class=\"fas  fa-lg fa-print\"   title=\"Customer copy\"></i>-->\n-                                                <!--</a>-->\n-\n-                                            @endcan\n-                                            @if($showAddItems)\n-                                                @if(branch()->id == $shipment->branch_id)\n-                                                    <a href=\"{{edit_url($shipment->id)}}\"\n-                                                        class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning\" >\n-                                                        <i class=\"fas  fa-lg fa-plus\"></i>\n-                                                    </a>\n-                                                @endif\n-                                            @endif\n-                                        </td>\n-                                        <td>{{ $shipment->booking_number }}</td>\n-                                        <td>{{ $shipment->number_of_pcs?$shipment->number_of_pcs: $shipment->number_of_pcs_create }}</td>\n-                                        <td>{{ $shipment->grand_total_weight }}</td>\n-                                        <td>{{ $shipment->shipMethType->name??\"\" }}</td>\n-                                        <td>{{ $shipment->sender->name }}</td>\n-                                        <td>{{ $shipment->sender->phone??'-' }}</td>\n-                                        <td>{{ $shipment->receiver->name??\"\"}}</td>\n-                                        <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n-                                        <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n-                                        <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n-                                        <td>{{ $shipment->payment_method }}</td>\n-                                        <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n-                                        <td>    @if($shipment->collected_by == 'driver')\n-                                                    {{ $shipment->driver?$shipment->driver->name:'-'}}\n-                                                @else\n-                                                    {{$shipment->staff?$shipment->staff->full_name:'-'}}\n-                                                @endif\n-                                        </td>\n-                                        <td>{{ !empty($shipment->created_date)? date('d-m-Y', strtotime($shipment->created_date)):''  }}</td>\n-\n-                                        <!-- @canany([permission_edit(),permission_view(),'shipment-show'])\n-                                            <form method=\"post\" action=\"{{delete_url($shipment->id)}}\"> -->\n-                                                <!-- <td>\n-                                                    @can(permission_edit())\n-                                                        <a href=\"{{edit_url($shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n-                                                            <i class=\"fas fa-pencil-alt\"></i>\n-                                                        </a>\n-                                                    @endcan\n-                                                    @can(permission_view())\n-                                                        <a href=\"{{show_url($shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-success\">\n-                                                            <i class=\"fas fa-eye\"></i>\n-                                                        </a>\n-                                                    @endcan\n-                                                    @can('shipment-print')\n-                                                        <a href=\"{{route('branch.shipment.print',$shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-dark\">\n-                                                            <i class=\"fas fa-print\"></i>\n-                                                        </a>\n-                                                    @endcan\n-                                                    @if($showAddItems)\n-                                                        <a href=\"{{route('branch.shipment.item',$shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n-                                                            <i class=\"fas fa-plus\"></i>\n-                                                        </a>\n-                                                    @endif\n-                                                </td> -->\n-                                            <!-- </form> -->\n-                                        <!-- @endcanany -->\n-                                    </tr>\n-                                @endforeach\n-                                </tbody>\n-                            </table>\n-                            <div class=\"d-flex justify-content-end\">\n-                                {{ $shipments->onEachSide(1)->links() }}\n-                            </div>\n-\n-                        </div>\n-                    </div>\n-                </div>\n-\n-            </div>\n-            <!-- end container-fluid -->\n-\n-        </div>\n-        <!-- end content -->\n-\n-        <div class=\"modal fade\" id=\"exampleModalCenter\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalCenterTitle\" aria-hidden=\"true\">\n-            <div class=\"modal-dialog modal-dialog-centered\" role=\"document\">\n-              <div class=\"modal-content\">\n-                <div class=\"modal-header\">\n-                  <h5 class=\"modal-title\" id=\"exampleModalLongTitle\">Enter access key</h5>\n-                  <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n-                    <span aria-hidden=\"true\">&times;</span>\n-                  </button>\n-                </div>\n-                <div class=\"modal-body\">\n-                  <div class=\"form-group\">\n-                    <input type=\"password\" class=\"form-control\" id=\"passkey\">\n-                  </div>\n-                </div>\n-                <div class=\"modal-footer justify-content-center\">\n-                  {{-- <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button> --}}\n-                  <button type=\"button\" class=\"btn btn-primary\" id=\"passkeyBtn\">Submit</button>\n-                </div>\n-              </div>\n-            </div>\n-        </div>\n-\n-@endsection\n-@section('styles')\n-    @include('layouts.datatables_style')\n-@endsection\n-\n-@section('scripts')\n-    @include('layouts.datatables_js')\n-    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js\"></script>\n-    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js\"></script>\n-    @if(session('showModal'))\n-        <script>\n-            $(document).ready(function() {\n-                $('#exampleModalCenter').modal('show');\n-            });\n-        </script>\n-    @endif\n-    <script>\n-\n-$(document).ready(function () {\n-    $('#bookingdatatable').DataTable({\n-        \"autoWidth\": false,\n-        \"aaSorting\": [ [0,'desc'] ],\n-        \"scrollX\": true,\n-        \"paging\": false,\n-        \"responsive\": false,\n-        \"searching\": false\n-    });\n-\n-    $('.datepicker').datepicker({\n-        format: 'dd/mm/yyyy',\n-        autoclose: true,\n-        todayHighlight: true\n-    });\n-\n-\n-    $('#exportButton').click(function(event) {\n-        event.preventDefault();\n-\n-        var formData = $('#shipmentForm').serialize();\n-\n-        var exportUrl = '/branch/shipment/export?' + formData;\n-\n-        window.location.href = exportUrl;\n-    });\n-\n-    $('.editBtn').click(function(event) {\n-        event.preventDefault();\n-        var status = $(this).attr('ststus') || null;\n-        var statusName = $(this).attr('statusName');\n-        console.log(statusName);\n-        var url = $(this).attr('href');\n-        if(statusName == \"Shipment received\" || statusName == \"Enquiry collected\"){\n-            if(status == 15 || status == 1 || status == 2 || status == null ){\n-            window.location.href = url;\n-            }\n-            else{\n-                $('#passkey').attr('data-url', url);\n-                $('#exampleModalCenter').modal('show');\n-            }\n-        }\n-        else{\n-            $('#passkey').attr('data-url', url);\n-            $('#exampleModalCenter').modal('show');\n-        }\n-    });\n-\n-    $('#passkeyBtn').click(function(event) {\n-        var passkey = $('#passkey').val();\n-        var url = $('#passkey').data('url');\n-        var encryptedPasskey = CryptoJS.SHA256(passkey).toString();\n-\n-        var exportUrl = url + '?password=' + encodeURIComponent(encryptedPasskey);\n-\n-        window.location.href = exportUrl;\n-    });\n-\n-\n-\n-});\n-\n-    </script>\n-@endsection\n-@extends('layouts.app')\n-\n-@section('content')\n-\n-    <div class=\"content-page\" id=\"content-page\">\n-        <div class=\"content\">\n-\n-            <!-- Start Content-->\n-            <div class=\"container-fluid\">\n-\n-                <!-- start page title -->\n-                <div class=\"row\">\n-                    <div class=\"col-12\">\n-                        <div class=\"page-title-box\">\n-                            <div class=\"page-title-right\">\n-                                {!! breadcrumbs() !!}\n-                            </div>\n-                            <h4 class=\"page-title\">Invoices</h4>\n-                            @can(permission_create())\n-                                <div class=\"fa-pull-right pb-3\"><a href=\"{{create_url()}}\"\n-                                                                   class=\"btn btn-success\">Add New</a></div>\n-                            @endcan\n-                        </div>\n-                    </div>\n-\n-                </div>\n-\n-\n-                <div class=\"row\">\n-                    <div class=\"col-sm-12\">\n-\n-                        <div class=\"card-box table-responsive\">\n-{{--                            <form action=\"\" method=\"get\">--}}\n-{{--                                <div class=\"row justify-content-center\">--}}\n-\n-{{--                                    <div class=\"form-group\">--}}\n-{{--                                        <input type=\"date\" value=\"{{date('Y-m-d')}}\" max=\"{{date('Y-m-d')}}\"--}}\n-{{--                                               class=\"form-control\" id=\"propertyname\" name=\"date\"--}}\n-{{--                                               placeholder=\"Enter title\">--}}\n-{{--                                    </div>--}}\n-{{--                                    <div class=\"pl-1\">--}}\n-{{--                                        <button type=\"submit\" class=\"btn btn-success waves-effect waves-light\">Submit--}}\n-{{--                                        </button>--}}\n-{{--                                    </div>--}}\n-\n-{{--                                </div>--}}\n-{{--                            </form>--}}\n-\n-                            <div class=\"d-flex justify-content-end\" >\n-                                <form action=\"/branch/shipment\" class=\"d-flex\" id=\"shipmentForm\">\n-                                    <div class=\"row\">\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <input type=\"text\" name=\"from_date\" class=\"form-control datepicker\"  placeholder=\"From date\" value=\"{{ request('from_date') }}\">\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <input type=\"text\" name=\"to_date\" class=\"form-control datepicker\"    placeholder=\"To date\" value=\"{{ request('to_date') }}\">\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-3\">\n-                                            <div class=\"form-group\">\n-                                                <input name=\"search\" value=\"{{$search??''}}\" class=\"form-control \" type=\"search\" placeholder=\"Search\" aria-label=\"Search\">\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <button class=\"btn btn-info t-5\" type=\"submit\">Search</button>\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <a href=\"#\" class=\"btn btn-success\" id=\"exportButton\">Export</a>\n-                                            </div>\n-                                        </div>\n-                                    </div>\n-                                  </form>\n-                            </div>\n-                            <table id=\"bookingdatatable\"\n-                                   class=\"table table-striped table-bordered dt-responsive nowrap\"\n-                                   style=\"border-collapse: collapse; border-spacing: 0; width: 100%;\">\n-                                <thead>\n-\n-                                <tr>\n-                                    @canany([permission_edit(),permission_view(),'shipment-show'])\n-                                        <th style=\"text-align: center\">Action</th>\n-                                    @endcanany\n-                                    <th>Book<br>No</th>\n-                                    <th>No<br>Pcs</th>\n-                                    <th>Tot<br>Wgt</th>\n-                                    <th>Shipment <br>Type</th>\n-                                    <th>Sender<br>Name</th>\n-                                    <th>Sender<br>Phone</th>\n-                                    <th>Receiver<br>Name</th>\n-                                    <th>Receiver<br>Country</th>\n-                                    <th>Document<br>Country</th>\n-                                    <th>Receiver<br>State</th>\n-                                    <th>Shipping<br>Status</th>\n-                                    <th>Payment<br>Method</th>\n-                                    <th>Courier<br>Company</th>\n-                                    <th>Driver/<br>Staff</th>\n-                                    <th>Date</th>\n-\n-                                </tr>\n-\n-                                </thead>\n-\n-                                <tbody>\n-                                    <?php\n-                                        $lastStatus = '';\n-                                        $statusList = [];\n-                                    ?>\n-                                @foreach($shipments as $key=> $shipment)\n-\n-                                <?php\n-                                    // if(!empty($shipment->statusVal->name)){\n-                                        // if($shipment->statusVal->name == \"Enquiry collected\") {\n-                                        //     $showAddItems = true;\n-                                        //     $style =\"style=background-color:yellow;padding:5px;\";\n-                                        // } else {\n-                                        //     $style =\"style=background-color:none\";\n-                                        //     $showAddItems = false;\n-                                        // }\n-                                    // }\n-                                    $status = '';\n-                                    $lastStatus = '';\n-                                    $statusList = '';\n-\n-                                    $status = $shipment->statusVal->name;\n-                                    foreach($shipment->boxes as $box) {\n-                                        if(($box->boxStatuses != null)) {\n-                                            $statusList = $shipment->last_status;\n-                                        }\n-                                    }\n-\n-\n-                                    $lastStatus = (!empty($statusList) ) ? $statusList : $status ;\n-                                    if($lastStatus == 'Enquiry collected') {\n-                                            $showAddItems = true;\n-                                            $style =\"style=background-color:yellow;padding:5px;\";\n-                                    } else {\n-                                        $style =\"style=background-color:none\";\n-                                        $showAddItems = false;\n-                                    }\n-                                    $statusss = null;\n-                                    if ($shipment->boxes->isEmpty()) {\n-                                        $statusss = $shipment->status_id;\n-                                    } else {\n-                                        if($statusss == 15 || $statusss == 1 || $statusss == null) {\n-\n-                                            foreach ($shipment->boxes as $box) {\n-                                                $latestStatus = $box->boxStatuses()->orderBy('id', 'desc')->first();\n-                                                if ($latestStatus && ($latestStatus->id != 15 && $latestStatus->id != 1)) {\n-                                                    $statusss = $latestStatus->status_id;\n-                                                    break;\n-                                                }\n-                                            }\n-                                        }\n-                                        else{\n-                                            $statusss = $shipment->status_id;\n-                                        }\n-\n-                                    }\n-                                ?>\n-                                    <tr>\n-                                        <td>\n-                                            @can(permission_edit())\n-                                            @if(branch()->id == $shipment->branch_id)\n-                                                <a href=\"{{edit_url($shipment->id)}}\"\n-                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning editBtn\" ststus=\"{{$statusss}}\" statusName=\"{{  $lastStatus??'' }}\">\n-                                                    <i class=\"fas  fa-lg fa-pencil-alt\"></i>\n-                                                </a>\n-                                            @endif\n-                                            @endcan\n-                                            @can(permission_view())\n-                                                <a href=\"{{show_url($shipment->id)}}\"\n-                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-success \">\n-                                                    <i class=\"fas  fa-lg fa-eye\"></i>\n-                                                </a>\n-                                            @endcan\n-                                            @can('shipment-print')\n-                                                <a href=\"{{route('branch.shipment.print',$shipment->id)}}\" target=\"_blank\"\n-                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\">\n-                                                    <i class=\"fas  fa-lg fa-print\"   title=\"Customs copy\"></i>\n-                                                </a>\n-\n-                                                <!--<a href=\"{{route('branch.shipment.print_customer',$shipment->id)}}\" target=\"_blank\"-->\n-                                                <!--    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\" style=\"background:#1274bb; border: 0px;\"  >-->\n-                                                <!--    <i class=\"fas  fa-lg fa-print\"   title=\"Customer copy\"></i>-->\n-                                                <!--</a>-->\n-\n-                                            @endcan\n-                                            @if($showAddItems)\n-                                                @if(branch()->id == $shipment->branch_id)\n-                                                    <a href=\"{{edit_url($shipment->id)}}\"\n-                                                        class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning\" >\n-                                                        <i class=\"fas  fa-lg fa-plus\"></i>\n-                                                    </a>\n-                                                @endif\n-                                            @endif\n-                                        </td>\n-                                        <td>{{ $shipment->booking_number }}</td>\n-                                        <td>{{ $shipment->number_of_pcs?$shipment->number_of_pcs: $shipment->number_of_pcs_create }}</td>\n-                                        <td>{{ $shipment->grand_total_weight }}</td>\n-                                        <td>{{ $shipment->shipMethType->name??\"\" }}</td>\n-                                        <td>{{ $shipment->sender->name }}</td>\n-                                        <td>{{ $shipment->sender->phone??'-' }}</td>\n-                                        <td>{{ $shipment->receiver->name??\"\"}}</td>\n-                                        <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n-                                        <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n-                                        <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n-                                        <td>{{ $shipment->payment_method }}</td>\n-                                        <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n-                                        <td>    @if($shipment->collected_by == 'driver')\n-                                                    {{ $shipment->driver?$shipment->driver->name:'-'}}\n-                                                @else\n-                                                    {{$shipment->staff?$shipment->staff->full_name:'-'}}\n-                                                @endif\n-                                        </td>\n-                                        <td>{{ !empty($shipment->created_date)? date('d-m-Y', strtotime($shipment->created_date)):''  }}</td>\n-\n-                                        <!-- @canany([permission_edit(),permission_view(),'shipment-show'])\n-                                            <form method=\"post\" action=\"{{delete_url($shipment->id)}}\"> -->\n-                                                <!-- <td>\n-                                                    @can(permission_edit())\n-                                                        <a href=\"{{edit_url($shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n-                                                            <i class=\"fas fa-pencil-alt\"></i>\n-                                                        </a>\n-                                                    @endcan\n-                                                    @can(permission_view())\n-                                                        <a href=\"{{show_url($shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-success\">\n-                                                            <i class=\"fas fa-eye\"></i>\n-                                                        </a>\n-                                                    @endcan\n-                                                    @can('shipment-print')\n-                                                        <a href=\"{{route('branch.shipment.print',$shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-dark\">\n-                                                            <i class=\"fas fa-print\"></i>\n-                                                        </a>\n-                                                    @endcan\n-                                                    @if($showAddItems)\n-                                                        <a href=\"{{route('branch.shipment.item',$shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n-                                                            <i class=\"fas fa-plus\"></i>\n-                                                        </a>\n-                                                    @endif\n-                                                </td> -->\n-                                            <!-- </form> -->\n-                                        <!-- @endcanany -->\n-                                    </tr>\n-                                @endforeach\n-                                </tbody>\n-                            </table>\n-                            <div class=\"d-flex justify-content-end\">\n-                                {{ $shipments->onEachSide(1)->links() }}\n-                            </div>\n-\n-                        </div>\n-                    </div>\n-                </div>\n-\n-            </div>\n-            <!-- end container-fluid -->\n-\n-        </div>\n-        <!-- end content -->\n-\n-        <div class=\"modal fade\" id=\"exampleModalCenter\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalCenterTitle\" aria-hidden=\"true\">\n-            <div class=\"modal-dialog modal-dialog-centered\" role=\"document\">\n-              <div class=\"modal-content\">\n-                <div class=\"modal-header\">\n-                  <h5 class=\"modal-title\" id=\"exampleModalLongTitle\">Enter access key</h5>\n-                  <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n-                    <span aria-hidden=\"true\">&times;</span>\n-                  </button>\n-                </div>\n-                <div class=\"modal-body\">\n-                  <div class=\"form-group\">\n-                    <input type=\"password\" class=\"form-control\" id=\"passkey\">\n-                  </div>\n-                </div>\n-                <div class=\"modal-footer justify-content-center\">\n-                  {{-- <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button> --}}\n-                  <button type=\"button\" class=\"btn btn-primary\" id=\"passkeyBtn\">Submit</button>\n-                </div>\n-              </div>\n-            </div>\n-        </div>\n-\n-@endsection\n-@section('styles')\n-    @include('layouts.datatables_style')\n-@endsection\n-\n-@section('scripts')\n-    @include('layouts.datatables_js')\n-    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js\"></script>\n-    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js\"></script>\n-    @if(session('showModal'))\n-        <script>\n-            $(document).ready(function() {\n-                $('#exampleModalCenter').modal('show');\n-            });\n-        </script>\n-    @endif\n-    <script>\n-\n-$(document).ready(function () {\n-    $('#bookingdatatable').DataTable({\n-        \"autoWidth\": false,\n-        \"aaSorting\": [ [0,'desc'] ],\n-        \"scrollX\": true,\n-        \"paging\": false,\n-        \"responsive\": false,\n-        \"searching\": false\n-    });\n-\n-    $('.datepicker').datepicker({\n-        format: 'dd/mm/yyyy',\n-        autoclose: true,\n-        todayHighlight: true\n-    });\n-\n-\n-    $('#exportButton').click(function(event) {\n-        event.preventDefault();\n-\n-        var formData = $('#shipmentForm').serialize();\n-\n-        var exportUrl = '/branch/shipment/export?' + formData;\n-\n-        window.location.href = exportUrl;\n-    });\n-\n-    $('.editBtn').click(function(event) {\n-        event.preventDefault();\n-        var status = $(this).attr('ststus') || null;\n-        var statusName = $(this).attr('statusName');\n-        console.log(statusName);\n-        var url = $(this).attr('href');\n-        if(statusName == \"Shipment received\" || statusName == \"Enquiry collected\"){\n-            if(status == 15 || status == 1 || status == 2 || status == null ){\n-            window.location.href = url;\n-            }\n-            else{\n-                $('#passkey').attr('data-url', url);\n-                $('#exampleModalCenter').modal('show');\n-            }\n-        }\n-        else{\n-            $('#passkey').attr('data-url', url);\n-            $('#exampleModalCenter').modal('show');\n-        }\n-    });\n-\n-    $('#passkeyBtn').click(function(event) {\n-        var passkey = $('#passkey').val();\n-        var url = $('#passkey').data('url');\n-        var encryptedPasskey = CryptoJS.SHA256(passkey).toString();\n-\n-        var exportUrl = url + '?password=' + encodeURIComponent(encryptedPasskey);\n-\n-        window.location.href = exportUrl;\n-    });\n-\n-\n-\n-});\n-\n-    </script>\n-@endsection\n"
                },
                {
                    "date": 1733727020679,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,374 @@\n+@extends('layouts.app')\n+\n+@section('content')\n+\n+    <div class=\"content-page\" id=\"content-page\">\n+        <div class=\"content\">\n+\n+            <!-- Start Content-->\n+            <div class=\"container-fluid\">\n+\n+                <!-- start page title -->\n+                <div class=\"row\">\n+                    <div class=\"col-12\">\n+                        <div class=\"page-title-box\">\n+                            <div class=\"page-title-right\">\n+                                {!! breadcrumbs() !!}\n+                            </div>\n+                            <h4 class=\"page-title\">Invoices</h4>\n+                            @can(permission_create())\n+                                <div class=\"fa-pull-right pb-3\"><a href=\"{{create_url()}}\"\n+                                                                   class=\"btn btn-success\">Add New</a></div>\n+                            @endcan\n+                        </div>\n+                    </div>\n+\n+                </div>\n+\n+\n+                <div class=\"row\">\n+                    <div class=\"col-sm-12\">\n+\n+                        <div class=\"card-box table-responsive\">\n+{{--                            <form action=\"\" method=\"get\">--}}\n+{{--                                <div class=\"row justify-content-center\">--}}\n+\n+{{--                                    <div class=\"form-group\">--}}\n+{{--                                        <input type=\"date\" value=\"{{date('Y-m-d')}}\" max=\"{{date('Y-m-d')}}\"--}}\n+{{--                                               class=\"form-control\" id=\"propertyname\" name=\"date\"--}}\n+{{--                                               placeholder=\"Enter title\">--}}\n+{{--                                    </div>--}}\n+{{--                                    <div class=\"pl-1\">--}}\n+{{--                                        <button type=\"submit\" class=\"btn btn-success waves-effect waves-light\">Submit--}}\n+{{--                                        </button>--}}\n+{{--                                    </div>--}}\n+\n+{{--                                </div>--}}\n+{{--                            </form>--}}\n+\n+                            <div class=\"d-flex justify-content-end\" >\n+                                <form action=\"/branch/shipment\" class=\"d-flex\" id=\"shipmentForm\">\n+                                    <div class=\"row\">\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <input type=\"text\" name=\"from_date\" class=\"form-control datepicker\"  placeholder=\"From date\" value=\"{{ request('from_date') }}\">\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <input type=\"text\" name=\"to_date\" class=\"form-control datepicker\"    placeholder=\"To date\" value=\"{{ request('to_date') }}\">\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-3\">\n+                                            <div class=\"form-group\">\n+                                                <input name=\"search\" value=\"{{$search??''}}\" class=\"form-control \" type=\"search\" placeholder=\"Search\" aria-label=\"Search\">\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <button class=\"btn btn-info t-5\" type=\"submit\">Search</button>\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <a href=\"#\" class=\"btn btn-success\" id=\"exportButton\">Export</a>\n+                                            </div>\n+                                        </div>\n+                                    </div>\n+                                  </form>\n+                            </div>\n+                            <table id=\"bookingdatatable\"\n+                                   class=\"table table-striped table-bordered dt-responsive nowrap\"\n+                                   style=\"border-collapse: collapse; border-spacing: 0; width: 100%;\">\n+                                <thead>\n+\n+                                <tr>\n+                                    @canany([permission_edit(),permission_view(),'shipment-show'])\n+                                        <th style=\"text-align: center\">Action</th>\n+                                    @endcanany\n+                                    <th>Book<br>No</th>\n+                                    <th>No<br>Pcs</th>\n+                                    <th>Tot<br>Wgt</th>\n+                                    <th>Shipment <br>Type</th>\n+                                    <th>Sender<br>Name</th>\n+                                    <th>Sender<br>Phone</th>\n+                                    <th>Receiver<br>Name</th>\n+                                    <th>Receiver<br>Country</th>             \n+                                    <th>Receiver<br>State</th>\n+                                    <th>Document<br>Id</th>\n+                                    <th>Shipping<br>Status</th>\n+                                    <th>Payment<br>Method</th>\n+                                    <th>Courier<br>Company</th>\n+                                    <th>Driver/<br>Staff</th>\n+                                    <th>Date</th>\n+\n+                                </tr>\n+\n+                                </thead>\n+\n+                                <tbody>\n+                                    <?php\n+                                        $lastStatus = '';\n+                                        $statusList = [];\n+                                    ?>\n+                                @foreach($shipments as $key=> $shipment)\n+\n+                                <?php\n+                                    // if(!empty($shipment->statusVal->name)){\n+                                        // if($shipment->statusVal->name == \"Enquiry collected\") {\n+                                        //     $showAddItems = true;\n+                                        //     $style =\"style=background-color:yellow;padding:5px;\";\n+                                        // } else {\n+                                        //     $style =\"style=background-color:none\";\n+                                        //     $showAddItems = false;\n+                                        // }\n+                                    // }\n+                                    $status = '';\n+                                    $lastStatus = '';\n+                                    $statusList = '';\n+\n+                                    $status = $shipment->statusVal->name;\n+                                    foreach($shipment->boxes as $box) {\n+                                        if(($box->boxStatuses != null)) {\n+                                            $statusList = $shipment->last_status;\n+                                        }\n+                                    }\n+\n+\n+                                    $lastStatus = (!empty($statusList) ) ? $statusList : $status ;\n+                                    if($lastStatus == 'Enquiry collected') {\n+                                            $showAddItems = true;\n+                                            $style =\"style=background-color:yellow;padding:5px;\";\n+                                    } else {\n+                                        $style =\"style=background-color:none\";\n+                                        $showAddItems = false;\n+                                    }\n+                                    $statusss = null;\n+                                    if ($shipment->boxes->isEmpty()) {\n+                                        $statusss = $shipment->status_id;\n+                                    } else {\n+                                        if($statusss == 15 || $statusss == 1 || $statusss == null) {\n+\n+                                            foreach ($shipment->boxes as $box) {\n+                                                $latestStatus = $box->boxStatuses()->orderBy('id', 'desc')->first();\n+                                                if ($latestStatus && ($latestStatus->id != 15 && $latestStatus->id != 1)) {\n+                                                    $statusss = $latestStatus->status_id;\n+                                                    break;\n+                                                }\n+                                            }\n+                                        }\n+                                        else{\n+                                            $statusss = $shipment->status_id;\n+                                        }\n+\n+                                    }\n+                                ?>\n+                                    <tr>\n+                                        <td>\n+                                            @can(permission_edit())\n+                                            @if(branch()->id == $shipment->branch_id)\n+                                                <a href=\"{{edit_url($shipment->id)}}\"\n+                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning editBtn\" ststus=\"{{$statusss}}\" statusName=\"{{  $lastStatus??'' }}\">\n+                                                    <i class=\"fas  fa-lg fa-pencil-alt\"></i>\n+                                                </a>\n+                                            @endif\n+                                            @endcan\n+                                            @can(permission_view())\n+                                                <a href=\"{{show_url($shipment->id)}}\"\n+                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-success \">\n+                                                    <i class=\"fas  fa-lg fa-eye\"></i>\n+                                                </a>\n+                                            @endcan\n+                                            @can('shipment-print')\n+                                                <a href=\"{{route('branch.shipment.print',$shipment->id)}}\" target=\"_blank\"\n+                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\">\n+                                                    <i class=\"fas  fa-lg fa-print\"   title=\"Customs copy\"></i>\n+                                                </a>\n+\n+                                                <!--<a href=\"{{route('branch.shipment.print_customer',$shipment->id)}}\" target=\"_blank\"-->\n+                                                <!--    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\" style=\"background:#1274bb; border: 0px;\"  >-->\n+                                                <!--    <i class=\"fas  fa-lg fa-print\"   title=\"Customer copy\"></i>-->\n+                                                <!--</a>-->\n+\n+                                            @endcan\n+                                            @if($showAddItems)\n+                                                @if(branch()->id == $shipment->branch_id)\n+                                                    <a href=\"{{edit_url($shipment->id)}}\"\n+                                                        class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning\" >\n+                                                        <i class=\"fas  fa-lg fa-plus\"></i>\n+                                                    </a>\n+                                                @endif\n+                                            @endif\n+                                        </td>\n+                                        <td>{{ $shipment->booking_number }}</td>\n+                                        <td>{{ $shipment->number_of_pcs?$shipment->number_of_pcs: $shipment->number_of_pcs_create }}</td>\n+                                        <td>{{ $shipment->grand_total_weight }}</td>\n+                                        <td>{{ $shipment->shipMethType->name??\"\" }}</td>\n+                                        <td>{{ $shipment->sender->name }}</td>\n+                                        <td>{{ $shipment->sender->phone??'-' }}</td>\n+                                        <td>{{ $shipment->receiver->name??\"\"}}</td>\n+                                        <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n+                                        <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n+                                        <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n+                                        <td>{{ $shipment->payment_method }}</td>\n+                                        <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n+                                        <td>    @if($shipment->collected_by == 'driver')\n+                                                    {{ $shipment->driver?$shipment->driver->name:'-'}}\n+                                                @else\n+                                                    {{$shipment->staff?$shipment->staff->full_name:'-'}}\n+                                                @endif\n+                                        </td>\n+                                        <td>{{ !empty($shipment->created_date)? date('d-m-Y', strtotime($shipment->created_date)):''  }}</td>\n+\n+                                        <!-- @canany([permission_edit(),permission_view(),'shipment-show'])\n+                                            <form method=\"post\" action=\"{{delete_url($shipment->id)}}\"> -->\n+                                                <!-- <td>\n+                                                    @can(permission_edit())\n+                                                        <a href=\"{{edit_url($shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n+                                                            <i class=\"fas fa-pencil-alt\"></i>\n+                                                        </a>\n+                                                    @endcan\n+                                                    @can(permission_view())\n+                                                        <a href=\"{{show_url($shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-success\">\n+                                                            <i class=\"fas fa-eye\"></i>\n+                                                        </a>\n+                                                    @endcan\n+                                                    @can('shipment-print')\n+                                                        <a href=\"{{route('branch.shipment.print',$shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-dark\">\n+                                                            <i class=\"fas fa-print\"></i>\n+                                                        </a>\n+                                                    @endcan\n+                                                    @if($showAddItems)\n+                                                        <a href=\"{{route('branch.shipment.item',$shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n+                                                            <i class=\"fas fa-plus\"></i>\n+                                                        </a>\n+                                                    @endif\n+                                                </td> -->\n+                                            <!-- </form> -->\n+                                        <!-- @endcanany -->\n+                                    </tr>\n+                                @endforeach\n+                                </tbody>\n+                            </table>\n+                            <div class=\"d-flex justify-content-end\">\n+                                {{ $shipments->onEachSide(1)->links() }}\n+                            </div>\n+\n+                        </div>\n+                    </div>\n+                </div>\n+\n+            </div>\n+            <!-- end container-fluid -->\n+\n+        </div>\n+        <!-- end content -->\n+\n+        <div class=\"modal fade\" id=\"exampleModalCenter\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalCenterTitle\" aria-hidden=\"true\">\n+            <div class=\"modal-dialog modal-dialog-centered\" role=\"document\">\n+              <div class=\"modal-content\">\n+                <div class=\"modal-header\">\n+                  <h5 class=\"modal-title\" id=\"exampleModalLongTitle\">Enter access key</h5>\n+                  <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n+                    <span aria-hidden=\"true\">&times;</span>\n+                  </button>\n+                </div>\n+                <div class=\"modal-body\">\n+                  <div class=\"form-group\">\n+                    <input type=\"password\" class=\"form-control\" id=\"passkey\">\n+                  </div>\n+                </div>\n+                <div class=\"modal-footer justify-content-center\">\n+                  {{-- <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button> --}}\n+                  <button type=\"button\" class=\"btn btn-primary\" id=\"passkeyBtn\">Submit</button>\n+                </div>\n+              </div>\n+            </div>\n+        </div>\n+\n+@endsection\n+@section('styles')\n+    @include('layouts.datatables_style')\n+@endsection\n+\n+@section('scripts')\n+    @include('layouts.datatables_js')\n+    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js\"></script>\n+    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js\"></script>\n+    @if(session('showModal'))\n+        <script>\n+            $(document).ready(function() {\n+                $('#exampleModalCenter').modal('show');\n+            });\n+        </script>\n+    @endif\n+    <script>\n+\n+$(document).ready(function () {\n+    $('#bookingdatatable').DataTable({\n+        \"autoWidth\": false,\n+        \"aaSorting\": [ [0,'desc'] ],\n+        \"scrollX\": true,\n+        \"paging\": false,\n+        \"responsive\": false,\n+        \"searching\": false\n+    });\n+\n+    $('.datepicker').datepicker({\n+        format: 'dd/mm/yyyy',\n+        autoclose: true,\n+        todayHighlight: true\n+    });\n+\n+\n+    $('#exportButton').click(function(event) {\n+        event.preventDefault();\n+\n+        var formData = $('#shipmentForm').serialize();\n+\n+        var exportUrl = '/branch/shipment/export?' + formData;\n+\n+        window.location.href = exportUrl;\n+    });\n+\n+    $('.editBtn').click(function(event) {\n+        event.preventDefault();\n+        var status = $(this).attr('ststus') || null;\n+        var statusName = $(this).attr('statusName');\n+        console.log(statusName);\n+        var url = $(this).attr('href');\n+        if(statusName == \"Shipment received\" || statusName == \"Enquiry collected\"){\n+            if(status == 15 || status == 1 || status == 2 || status == null ){\n+            window.location.href = url;\n+            }\n+            else{\n+                $('#passkey').attr('data-url', url);\n+                $('#exampleModalCenter').modal('show');\n+            }\n+        }\n+        else{\n+            $('#passkey').attr('data-url', url);\n+            $('#exampleModalCenter').modal('show');\n+        }\n+    });\n+\n+    $('#passkeyBtn').click(function(event) {\n+        var passkey = $('#passkey').val();\n+        var url = $('#passkey').data('url');\n+        var encryptedPasskey = CryptoJS.SHA256(passkey).toString();\n+\n+        var exportUrl = url + '?password=' + encodeURIComponent(encryptedPasskey);\n+\n+        window.location.href = exportUrl;\n+    });\n+\n+\n+\n+});\n+\n+    </script>\n+@endsection\n"
                },
                {
                    "date": 1733727041689,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,375 @@\n+@extends('layouts.app')\n+\n+@section('content')\n+\n+    <div class=\"content-page\" id=\"content-page\">\n+        <div class=\"content\">\n+\n+            <!-- Start Content-->\n+            <div class=\"container-fluid\">\n+\n+                <!-- start page title -->\n+                <div class=\"row\">\n+                    <div class=\"col-12\">\n+                        <div class=\"page-title-box\">\n+                            <div class=\"page-title-right\">\n+                                {!! breadcrumbs() !!}\n+                            </div>\n+                            <h4 class=\"page-title\">Invoices</h4>\n+                            @can(permission_create())\n+                                <div class=\"fa-pull-right pb-3\"><a href=\"{{create_url()}}\"\n+                                                                   class=\"btn btn-success\">Add New</a></div>\n+                            @endcan\n+                        </div>\n+                    </div>\n+\n+                </div>\n+\n+\n+                <div class=\"row\">\n+                    <div class=\"col-sm-12\">\n+\n+                        <div class=\"card-box table-responsive\">\n+{{--                            <form action=\"\" method=\"get\">--}}\n+{{--                                <div class=\"row justify-content-center\">--}}\n+\n+{{--                                    <div class=\"form-group\">--}}\n+{{--                                        <input type=\"date\" value=\"{{date('Y-m-d')}}\" max=\"{{date('Y-m-d')}}\"--}}\n+{{--                                               class=\"form-control\" id=\"propertyname\" name=\"date\"--}}\n+{{--                                               placeholder=\"Enter title\">--}}\n+{{--                                    </div>--}}\n+{{--                                    <div class=\"pl-1\">--}}\n+{{--                                        <button type=\"submit\" class=\"btn btn-success waves-effect waves-light\">Submit--}}\n+{{--                                        </button>--}}\n+{{--                                    </div>--}}\n+\n+{{--                                </div>--}}\n+{{--                            </form>--}}\n+\n+                            <div class=\"d-flex justify-content-end\" >\n+                                <form action=\"/branch/shipment\" class=\"d-flex\" id=\"shipmentForm\">\n+                                    <div class=\"row\">\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <input type=\"text\" name=\"from_date\" class=\"form-control datepicker\"  placeholder=\"From date\" value=\"{{ request('from_date') }}\">\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <input type=\"text\" name=\"to_date\" class=\"form-control datepicker\"    placeholder=\"To date\" value=\"{{ request('to_date') }}\">\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-3\">\n+                                            <div class=\"form-group\">\n+                                                <input name=\"search\" value=\"{{$search??''}}\" class=\"form-control \" type=\"search\" placeholder=\"Search\" aria-label=\"Search\">\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <button class=\"btn btn-info t-5\" type=\"submit\">Search</button>\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <a href=\"#\" class=\"btn btn-success\" id=\"exportButton\">Export</a>\n+                                            </div>\n+                                        </div>\n+                                    </div>\n+                                  </form>\n+                            </div>\n+                            <table id=\"bookingdatatable\"\n+                                   class=\"table table-striped table-bordered dt-responsive nowrap\"\n+                                   style=\"border-collapse: collapse; border-spacing: 0; width: 100%;\">\n+                                <thead>\n+\n+                                <tr>\n+                                    @canany([permission_edit(),permission_view(),'shipment-show'])\n+                                        <th style=\"text-align: center\">Action</th>\n+                                    @endcanany\n+                                    <th>Book<br>No</th>\n+                                    <th>No<br>Pcs</th>\n+                                    <th>Tot<br>Wgt</th>\n+                                    <th>Shipment <br>Type</th>\n+                                    <th>Sender<br>Name</th>\n+                                    <th>Sender<br>Phone</th>\n+                                    <th>Receiver<br>Name</th>\n+                                    <th>Receiver<br>Country</th>             \n+                                    <th>Receiver<br>State</th>\n+                                    <th>Document<br>Id</th>\n+                                    <th>Shipping<br>Status</th>\n+                                    <th>Payment<br>Method</th>\n+                                    <th>Courier<br>Company</th>\n+                                    <th>Driver/<br>Staff</th>\n+                                    <th>Date</th>\n+\n+                                </tr>\n+\n+                                </thead>\n+\n+                                <tbody>\n+                                    <?php\n+                                        $lastStatus = '';\n+                                        $statusList = [];\n+                                    ?>\n+                                @foreach($shipments as $key=> $shipment)\n+\n+                                <?php\n+                                    // if(!empty($shipment->statusVal->name)){\n+                                        // if($shipment->statusVal->name == \"Enquiry collected\") {\n+                                        //     $showAddItems = true;\n+                                        //     $style =\"style=background-color:yellow;padding:5px;\";\n+                                        // } else {\n+                                        //     $style =\"style=background-color:none\";\n+                                        //     $showAddItems = false;\n+                                        // }\n+                                    // }\n+                                    $status = '';\n+                                    $lastStatus = '';\n+                                    $statusList = '';\n+\n+                                    $status = $shipment->statusVal->name;\n+                                    foreach($shipment->boxes as $box) {\n+                                        if(($box->boxStatuses != null)) {\n+                                            $statusList = $shipment->last_status;\n+                                        }\n+                                    }\n+\n+\n+                                    $lastStatus = (!empty($statusList) ) ? $statusList : $status ;\n+                                    if($lastStatus == 'Enquiry collected') {\n+                                            $showAddItems = true;\n+                                            $style =\"style=background-color:yellow;padding:5px;\";\n+                                    } else {\n+                                        $style =\"style=background-color:none\";\n+                                        $showAddItems = false;\n+                                    }\n+                                    $statusss = null;\n+                                    if ($shipment->boxes->isEmpty()) {\n+                                        $statusss = $shipment->status_id;\n+                                    } else {\n+                                        if($statusss == 15 || $statusss == 1 || $statusss == null) {\n+\n+                                            foreach ($shipment->boxes as $box) {\n+                                                $latestStatus = $box->boxStatuses()->orderBy('id', 'desc')->first();\n+                                                if ($latestStatus && ($latestStatus->id != 15 && $latestStatus->id != 1)) {\n+                                                    $statusss = $latestStatus->status_id;\n+                                                    break;\n+                                                }\n+                                            }\n+                                        }\n+                                        else{\n+                                            $statusss = $shipment->status_id;\n+                                        }\n+\n+                                    }\n+                                ?>\n+                                    <tr>\n+                                        <td>\n+                                            @can(permission_edit())\n+                                            @if(branch()->id == $shipment->branch_id)\n+                                                <a href=\"{{edit_url($shipment->id)}}\"\n+                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning editBtn\" ststus=\"{{$statusss}}\" statusName=\"{{  $lastStatus??'' }}\">\n+                                                    <i class=\"fas  fa-lg fa-pencil-alt\"></i>\n+                                                </a>\n+                                            @endif\n+                                            @endcan\n+                                            @can(permission_view())\n+                                                <a href=\"{{show_url($shipment->id)}}\"\n+                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-success \">\n+                                                    <i class=\"fas  fa-lg fa-eye\"></i>\n+                                                </a>\n+                                            @endcan\n+                                            @can('shipment-print')\n+                                                <a href=\"{{route('branch.shipment.print',$shipment->id)}}\" target=\"_blank\"\n+                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\">\n+                                                    <i class=\"fas  fa-lg fa-print\"   title=\"Customs copy\"></i>\n+                                                </a>\n+\n+                                                <!--<a href=\"{{route('branch.shipment.print_customer',$shipment->id)}}\" target=\"_blank\"-->\n+                                                <!--    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\" style=\"background:#1274bb; border: 0px;\"  >-->\n+                                                <!--    <i class=\"fas  fa-lg fa-print\"   title=\"Customer copy\"></i>-->\n+                                                <!--</a>-->\n+\n+                                            @endcan\n+                                            @if($showAddItems)\n+                                                @if(branch()->id == $shipment->branch_id)\n+                                                    <a href=\"{{edit_url($shipment->id)}}\"\n+                                                        class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning\" >\n+                                                        <i class=\"fas  fa-lg fa-plus\"></i>\n+                                                    </a>\n+                                                @endif\n+                                            @endif\n+                                        </td>\n+                                        <td>{{ $shipment->booking_number }}</td>\n+                                        <td>{{ $shipment->number_of_pcs?$shipment->number_of_pcs: $shipment->number_of_pcs_create }}</td>\n+                                        <td>{{ $shipment->grand_total_weight }}</td>\n+                                        <td>{{ $shipment->shipMethType->name??\"\" }}</td>\n+                                        <td>{{ $shipment->sender->name }}</td>\n+                                        <td>{{ $shipment->sender->phone??'-' }}</td>\n+                                        <td>{{ $shipment->receiver->name??\"\"}}</td>\n+                                        <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n+                                        <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n+                                        <td>{{ $shipment->receiver->name??\"\"}}</td>\n+                                        <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n+                                        <td>{{ $shipment->payment_method }}</td>\n+                                        <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n+                                        <td>    @if($shipment->collected_by == 'driver')\n+                                                    {{ $shipment->driver?$shipment->driver->name:'-'}}\n+                                                @else\n+                                                    {{$shipment->staff?$shipment->staff->full_name:'-'}}\n+                                                @endif\n+                                        </td>\n+                                        <td>{{ !empty($shipment->created_date)? date('d-m-Y', strtotime($shipment->created_date)):''  }}</td>\n+\n+                                        <!-- @canany([permission_edit(),permission_view(),'shipment-show'])\n+                                            <form method=\"post\" action=\"{{delete_url($shipment->id)}}\"> -->\n+                                                <!-- <td>\n+                                                    @can(permission_edit())\n+                                                        <a href=\"{{edit_url($shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n+                                                            <i class=\"fas fa-pencil-alt\"></i>\n+                                                        </a>\n+                                                    @endcan\n+                                                    @can(permission_view())\n+                                                        <a href=\"{{show_url($shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-success\">\n+                                                            <i class=\"fas fa-eye\"></i>\n+                                                        </a>\n+                                                    @endcan\n+                                                    @can('shipment-print')\n+                                                        <a href=\"{{route('branch.shipment.print',$shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-dark\">\n+                                                            <i class=\"fas fa-print\"></i>\n+                                                        </a>\n+                                                    @endcan\n+                                                    @if($showAddItems)\n+                                                        <a href=\"{{route('branch.shipment.item',$shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n+                                                            <i class=\"fas fa-plus\"></i>\n+                                                        </a>\n+                                                    @endif\n+                                                </td> -->\n+                                            <!-- </form> -->\n+                                        <!-- @endcanany -->\n+                                    </tr>\n+                                @endforeach\n+                                </tbody>\n+                            </table>\n+                            <div class=\"d-flex justify-content-end\">\n+                                {{ $shipments->onEachSide(1)->links() }}\n+                            </div>\n+\n+                        </div>\n+                    </div>\n+                </div>\n+\n+            </div>\n+            <!-- end container-fluid -->\n+\n+        </div>\n+        <!-- end content -->\n+\n+        <div class=\"modal fade\" id=\"exampleModalCenter\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalCenterTitle\" aria-hidden=\"true\">\n+            <div class=\"modal-dialog modal-dialog-centered\" role=\"document\">\n+              <div class=\"modal-content\">\n+                <div class=\"modal-header\">\n+                  <h5 class=\"modal-title\" id=\"exampleModalLongTitle\">Enter access key</h5>\n+                  <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n+                    <span aria-hidden=\"true\">&times;</span>\n+                  </button>\n+                </div>\n+                <div class=\"modal-body\">\n+                  <div class=\"form-group\">\n+                    <input type=\"password\" class=\"form-control\" id=\"passkey\">\n+                  </div>\n+                </div>\n+                <div class=\"modal-footer justify-content-center\">\n+                  {{-- <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button> --}}\n+                  <button type=\"button\" class=\"btn btn-primary\" id=\"passkeyBtn\">Submit</button>\n+                </div>\n+              </div>\n+            </div>\n+        </div>\n+\n+@endsection\n+@section('styles')\n+    @include('layouts.datatables_style')\n+@endsection\n+\n+@section('scripts')\n+    @include('layouts.datatables_js')\n+    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js\"></script>\n+    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js\"></script>\n+    @if(session('showModal'))\n+        <script>\n+            $(document).ready(function() {\n+                $('#exampleModalCenter').modal('show');\n+            });\n+        </script>\n+    @endif\n+    <script>\n+\n+$(document).ready(function () {\n+    $('#bookingdatatable').DataTable({\n+        \"autoWidth\": false,\n+        \"aaSorting\": [ [0,'desc'] ],\n+        \"scrollX\": true,\n+        \"paging\": false,\n+        \"responsive\": false,\n+        \"searching\": false\n+    });\n+\n+    $('.datepicker').datepicker({\n+        format: 'dd/mm/yyyy',\n+        autoclose: true,\n+        todayHighlight: true\n+    });\n+\n+\n+    $('#exportButton').click(function(event) {\n+        event.preventDefault();\n+\n+        var formData = $('#shipmentForm').serialize();\n+\n+        var exportUrl = '/branch/shipment/export?' + formData;\n+\n+        window.location.href = exportUrl;\n+    });\n+\n+    $('.editBtn').click(function(event) {\n+        event.preventDefault();\n+        var status = $(this).attr('ststus') || null;\n+        var statusName = $(this).attr('statusName');\n+        console.log(statusName);\n+        var url = $(this).attr('href');\n+        if(statusName == \"Shipment received\" || statusName == \"Enquiry collected\"){\n+            if(status == 15 || status == 1 || status == 2 || status == null ){\n+            window.location.href = url;\n+            }\n+            else{\n+                $('#passkey').attr('data-url', url);\n+                $('#exampleModalCenter').modal('show');\n+            }\n+        }\n+        else{\n+            $('#passkey').attr('data-url', url);\n+            $('#exampleModalCenter').modal('show');\n+        }\n+    });\n+\n+    $('#passkeyBtn').click(function(event) {\n+        var passkey = $('#passkey').val();\n+        var url = $('#passkey').data('url');\n+        var encryptedPasskey = CryptoJS.SHA256(passkey).toString();\n+\n+        var exportUrl = url + '?password=' + encodeURIComponent(encryptedPasskey);\n+\n+        window.location.href = exportUrl;\n+    });\n+\n+\n+\n+});\n+\n+    </script>\n+@endsection\n"
                },
                {
                    "date": 1733727054648,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,375 @@\n+@extends('layouts.app')\n+\n+@section('content')\n+\n+    <div class=\"content-page\" id=\"content-page\">\n+        <div class=\"content\">\n+\n+            <!-- Start Content-->\n+            <div class=\"container-fluid\">\n+\n+                <!-- start page title -->\n+                <div class=\"row\">\n+                    <div class=\"col-12\">\n+                        <div class=\"page-title-box\">\n+                            <div class=\"page-title-right\">\n+                                {!! breadcrumbs() !!}\n+                            </div>\n+                            <h4 class=\"page-title\">Invoices</h4>\n+                            @can(permission_create())\n+                                <div class=\"fa-pull-right pb-3\"><a href=\"{{create_url()}}\"\n+                                                                   class=\"btn btn-success\">Add New</a></div>\n+                            @endcan\n+                        </div>\n+                    </div>\n+\n+                </div>\n+\n+\n+                <div class=\"row\">\n+                    <div class=\"col-sm-12\">\n+\n+                        <div class=\"card-box table-responsive\">\n+{{--                            <form action=\"\" method=\"get\">--}}\n+{{--                                <div class=\"row justify-content-center\">--}}\n+\n+{{--                                    <div class=\"form-group\">--}}\n+{{--                                        <input type=\"date\" value=\"{{date('Y-m-d')}}\" max=\"{{date('Y-m-d')}}\"--}}\n+{{--                                               class=\"form-control\" id=\"propertyname\" name=\"date\"--}}\n+{{--                                               placeholder=\"Enter title\">--}}\n+{{--                                    </div>--}}\n+{{--                                    <div class=\"pl-1\">--}}\n+{{--                                        <button type=\"submit\" class=\"btn btn-success waves-effect waves-light\">Submit--}}\n+{{--                                        </button>--}}\n+{{--                                    </div>--}}\n+\n+{{--                                </div>--}}\n+{{--                            </form>--}}\n+\n+                            <div class=\"d-flex justify-content-end\" >\n+                                <form action=\"/branch/shipment\" class=\"d-flex\" id=\"shipmentForm\">\n+                                    <div class=\"row\">\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <input type=\"text\" name=\"from_date\" class=\"form-control datepicker\"  placeholder=\"From date\" value=\"{{ request('from_date') }}\">\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <input type=\"text\" name=\"to_date\" class=\"form-control datepicker\"    placeholder=\"To date\" value=\"{{ request('to_date') }}\">\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-3\">\n+                                            <div class=\"form-group\">\n+                                                <input name=\"search\" value=\"{{$search??''}}\" class=\"form-control \" type=\"search\" placeholder=\"Search\" aria-label=\"Search\">\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <button class=\"btn btn-info t-5\" type=\"submit\">Search</button>\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <a href=\"#\" class=\"btn btn-success\" id=\"exportButton\">Export</a>\n+                                            </div>\n+                                        </div>\n+                                    </div>\n+                                  </form>\n+                            </div>\n+                            <table id=\"bookingdatatable\"\n+                                   class=\"table table-striped table-bordered dt-responsive nowrap\"\n+                                   style=\"border-collapse: collapse; border-spacing: 0; width: 100%;\">\n+                                <thead>\n+\n+                                <tr>\n+                                    @canany([permission_edit(),permission_view(),'shipment-show'])\n+                                        <th style=\"text-align: center\">Action</th>\n+                                    @endcanany\n+                                    <th>Book<br>No</th>\n+                                    <th>No<br>Pcs</th>\n+                                    <th>Tot<br>Wgt</th>\n+                                    <th>Shipment <br>Type</th>\n+                                    <th>Sender<br>Name</th>\n+                                    <th>Sender<br>Phone</th>\n+                                    <th>Receiver<br>Name</th>\n+                                    <th>Receiver<br>Country</th>             \n+                                    <th>Receiver<br>State</th>\n+                                    <th>Document<br>Id</th>\n+                                    <th>Shipping<br>Status</th>\n+                                    <th>Payment<br>Method</th>\n+                                    <th>Courier<br>Company</th>\n+                                    <th>Driver/<br>Staff</th>\n+                                    <th>Date</th>\n+\n+                                </tr>\n+\n+                                </thead>\n+\n+                                <tbody>\n+                                    <?php\n+                                        $lastStatus = '';\n+                                        $statusList = [];\n+                                    ?>\n+                                @foreach($shipments as $key=> $shipment)\n+\n+                                <?php\n+                                    // if(!empty($shipment->statusVal->name)){\n+                                        // if($shipment->statusVal->name == \"Enquiry collected\") {\n+                                        //     $showAddItems = true;\n+                                        //     $style =\"style=background-color:yellow;padding:5px;\";\n+                                        // } else {\n+                                        //     $style =\"style=background-color:none\";\n+                                        //     $showAddItems = false;\n+                                        // }\n+                                    // }\n+                                    $status = '';\n+                                    $lastStatus = '';\n+                                    $statusList = '';\n+\n+                                    $status = $shipment->statusVal->name;\n+                                    foreach($shipment->boxes as $box) {\n+                                        if(($box->boxStatuses != null)) {\n+                                            $statusList = $shipment->last_status;\n+                                        }\n+                                    }\n+\n+\n+                                    $lastStatus = (!empty($statusList) ) ? $statusList : $status ;\n+                                    if($lastStatus == 'Enquiry collected') {\n+                                            $showAddItems = true;\n+                                            $style =\"style=background-color:yellow;padding:5px;\";\n+                                    } else {\n+                                        $style =\"style=background-color:none\";\n+                                        $showAddItems = false;\n+                                    }\n+                                    $statusss = null;\n+                                    if ($shipment->boxes->isEmpty()) {\n+                                        $statusss = $shipment->status_id;\n+                                    } else {\n+                                        if($statusss == 15 || $statusss == 1 || $statusss == null) {\n+\n+                                            foreach ($shipment->boxes as $box) {\n+                                                $latestStatus = $box->boxStatuses()->orderBy('id', 'desc')->first();\n+                                                if ($latestStatus && ($latestStatus->id != 15 && $latestStatus->id != 1)) {\n+                                                    $statusss = $latestStatus->status_id;\n+                                                    break;\n+                                                }\n+                                            }\n+                                        }\n+                                        else{\n+                                            $statusss = $shipment->status_id;\n+                                        }\n+\n+                                    }\n+                                ?>\n+                                    <tr>\n+                                        <td>\n+                                            @can(permission_edit())\n+                                            @if(branch()->id == $shipment->branch_id)\n+                                                <a href=\"{{edit_url($shipment->id)}}\"\n+                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning editBtn\" ststus=\"{{$statusss}}\" statusName=\"{{  $lastStatus??'' }}\">\n+                                                    <i class=\"fas  fa-lg fa-pencil-alt\"></i>\n+                                                </a>\n+                                            @endif\n+                                            @endcan\n+                                            @can(permission_view())\n+                                                <a href=\"{{show_url($shipment->id)}}\"\n+                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-success \">\n+                                                    <i class=\"fas  fa-lg fa-eye\"></i>\n+                                                </a>\n+                                            @endcan\n+                                            @can('shipment-print')\n+                                                <a href=\"{{route('branch.shipment.print',$shipment->id)}}\" target=\"_blank\"\n+                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\">\n+                                                    <i class=\"fas  fa-lg fa-print\"   title=\"Customs copy\"></i>\n+                                                </a>\n+\n+                                                <!--<a href=\"{{route('branch.shipment.print_customer',$shipment->id)}}\" target=\"_blank\"-->\n+                                                <!--    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\" style=\"background:#1274bb; border: 0px;\"  >-->\n+                                                <!--    <i class=\"fas  fa-lg fa-print\"   title=\"Customer copy\"></i>-->\n+                                                <!--</a>-->\n+\n+                                            @endcan\n+                                            @if($showAddItems)\n+                                                @if(branch()->id == $shipment->branch_id)\n+                                                    <a href=\"{{edit_url($shipment->id)}}\"\n+                                                        class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning\" >\n+                                                        <i class=\"fas  fa-lg fa-plus\"></i>\n+                                                    </a>\n+                                                @endif\n+                                            @endif\n+                                        </td>\n+                                        <td>{{ $shipment->booking_number }}</td>\n+                                        <td>{{ $shipment->number_of_pcs?$shipment->number_of_pcs: $shipment->number_of_pcs_create }}</td>\n+                                        <td>{{ $shipment->grand_total_weight }}</td>\n+                                        <td>{{ $shipment->shipMethType->name??\"\" }}</td>\n+                                        <td>{{ $shipment->sender->name }}</td>\n+                                        <td>{{ $shipment->sender->phone??'-' }}</td>\n+                                        <td>{{ $shipment->receiver->name??\"\"}}</td>\n+                                        <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n+                                        <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n+                                        <td>{{ $shipment->grand_total_weight }}</td>\n+                                        <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n+                                        <td>{{ $shipment->payment_method }}</td>\n+                                        <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n+                                        <td>    @if($shipment->collected_by == 'driver')\n+                                                    {{ $shipment->driver?$shipment->driver->name:'-'}}\n+                                                @else\n+                                                    {{$shipment->staff?$shipment->staff->full_name:'-'}}\n+                                                @endif\n+                                        </td>\n+                                        <td>{{ !empty($shipment->created_date)? date('d-m-Y', strtotime($shipment->created_date)):''  }}</td>\n+\n+                                        <!-- @canany([permission_edit(),permission_view(),'shipment-show'])\n+                                            <form method=\"post\" action=\"{{delete_url($shipment->id)}}\"> -->\n+                                                <!-- <td>\n+                                                    @can(permission_edit())\n+                                                        <a href=\"{{edit_url($shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n+                                                            <i class=\"fas fa-pencil-alt\"></i>\n+                                                        </a>\n+                                                    @endcan\n+                                                    @can(permission_view())\n+                                                        <a href=\"{{show_url($shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-success\">\n+                                                            <i class=\"fas fa-eye\"></i>\n+                                                        </a>\n+                                                    @endcan\n+                                                    @can('shipment-print')\n+                                                        <a href=\"{{route('branch.shipment.print',$shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-dark\">\n+                                                            <i class=\"fas fa-print\"></i>\n+                                                        </a>\n+                                                    @endcan\n+                                                    @if($showAddItems)\n+                                                        <a href=\"{{route('branch.shipment.item',$shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n+                                                            <i class=\"fas fa-plus\"></i>\n+                                                        </a>\n+                                                    @endif\n+                                                </td> -->\n+                                            <!-- </form> -->\n+                                        <!-- @endcanany -->\n+                                    </tr>\n+                                @endforeach\n+                                </tbody>\n+                            </table>\n+                            <div class=\"d-flex justify-content-end\">\n+                                {{ $shipments->onEachSide(1)->links() }}\n+                            </div>\n+\n+                        </div>\n+                    </div>\n+                </div>\n+\n+            </div>\n+            <!-- end container-fluid -->\n+\n+        </div>\n+        <!-- end content -->\n+\n+        <div class=\"modal fade\" id=\"exampleModalCenter\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalCenterTitle\" aria-hidden=\"true\">\n+            <div class=\"modal-dialog modal-dialog-centered\" role=\"document\">\n+              <div class=\"modal-content\">\n+                <div class=\"modal-header\">\n+                  <h5 class=\"modal-title\" id=\"exampleModalLongTitle\">Enter access key</h5>\n+                  <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n+                    <span aria-hidden=\"true\">&times;</span>\n+                  </button>\n+                </div>\n+                <div class=\"modal-body\">\n+                  <div class=\"form-group\">\n+                    <input type=\"password\" class=\"form-control\" id=\"passkey\">\n+                  </div>\n+                </div>\n+                <div class=\"modal-footer justify-content-center\">\n+                  {{-- <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button> --}}\n+                  <button type=\"button\" class=\"btn btn-primary\" id=\"passkeyBtn\">Submit</button>\n+                </div>\n+              </div>\n+            </div>\n+        </div>\n+\n+@endsection\n+@section('styles')\n+    @include('layouts.datatables_style')\n+@endsection\n+\n+@section('scripts')\n+    @include('layouts.datatables_js')\n+    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js\"></script>\n+    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js\"></script>\n+    @if(session('showModal'))\n+        <script>\n+            $(document).ready(function() {\n+                $('#exampleModalCenter').modal('show');\n+            });\n+        </script>\n+    @endif\n+    <script>\n+\n+$(document).ready(function () {\n+    $('#bookingdatatable').DataTable({\n+        \"autoWidth\": false,\n+        \"aaSorting\": [ [0,'desc'] ],\n+        \"scrollX\": true,\n+        \"paging\": false,\n+        \"responsive\": false,\n+        \"searching\": false\n+    });\n+\n+    $('.datepicker').datepicker({\n+        format: 'dd/mm/yyyy',\n+        autoclose: true,\n+        todayHighlight: true\n+    });\n+\n+\n+    $('#exportButton').click(function(event) {\n+        event.preventDefault();\n+\n+        var formData = $('#shipmentForm').serialize();\n+\n+        var exportUrl = '/branch/shipment/export?' + formData;\n+\n+        window.location.href = exportUrl;\n+    });\n+\n+    $('.editBtn').click(function(event) {\n+        event.preventDefault();\n+        var status = $(this).attr('ststus') || null;\n+        var statusName = $(this).attr('statusName');\n+        console.log(statusName);\n+        var url = $(this).attr('href');\n+        if(statusName == \"Shipment received\" || statusName == \"Enquiry collected\"){\n+            if(status == 15 || status == 1 || status == 2 || status == null ){\n+            window.location.href = url;\n+            }\n+            else{\n+                $('#passkey').attr('data-url', url);\n+                $('#exampleModalCenter').modal('show');\n+            }\n+        }\n+        else{\n+            $('#passkey').attr('data-url', url);\n+            $('#exampleModalCenter').modal('show');\n+        }\n+    });\n+\n+    $('#passkeyBtn').click(function(event) {\n+        var passkey = $('#passkey').val();\n+        var url = $('#passkey').data('url');\n+        var encryptedPasskey = CryptoJS.SHA256(passkey).toString();\n+\n+        var exportUrl = url + '?password=' + encodeURIComponent(encryptedPasskey);\n+\n+        window.location.href = exportUrl;\n+    });\n+\n+\n+\n+});\n+\n+    </script>\n+@endsection\n"
                },
                {
                    "date": 1733727374464,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -208,9 +208,9 @@\n                                         <td>{{ $shipment->sender->phone??'-' }}</td>\n                                         <td>{{ $shipment->receiver->name??\"\"}}</td>\n                                         <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n                                         <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n-                                        <td>{{ $shipment->grand_total_weight }}</td>\n+                                        <td>{{ $coustomers->grand_total_weight }}</td>\n                                         <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n                                         <td>{{ $shipment->payment_method }}</td>\n                                         <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n                                         <td>    @if($shipment->collected_by == 'driver')\n@@ -372,1127 +372,4 @@\n });\n \n     </script>\n @endsection\n-@extends('layouts.app')\n-\n-@section('content')\n-\n-    <div class=\"content-page\" id=\"content-page\">\n-        <div class=\"content\">\n-\n-            <!-- Start Content-->\n-            <div class=\"container-fluid\">\n-\n-                <!-- start page title -->\n-                <div class=\"row\">\n-                    <div class=\"col-12\">\n-                        <div class=\"page-title-box\">\n-                            <div class=\"page-title-right\">\n-                                {!! breadcrumbs() !!}\n-                            </div>\n-                            <h4 class=\"page-title\">Invoices</h4>\n-                            @can(permission_create())\n-                                <div class=\"fa-pull-right pb-3\"><a href=\"{{create_url()}}\"\n-                                                                   class=\"btn btn-success\">Add New</a></div>\n-                            @endcan\n-                        </div>\n-                    </div>\n-\n-                </div>\n-\n-\n-                <div class=\"row\">\n-                    <div class=\"col-sm-12\">\n-\n-                        <div class=\"card-box table-responsive\">\n-{{--                            <form action=\"\" method=\"get\">--}}\n-{{--                                <div class=\"row justify-content-center\">--}}\n-\n-{{--                                    <div class=\"form-group\">--}}\n-{{--                                        <input type=\"date\" value=\"{{date('Y-m-d')}}\" max=\"{{date('Y-m-d')}}\"--}}\n-{{--                                               class=\"form-control\" id=\"propertyname\" name=\"date\"--}}\n-{{--                                               placeholder=\"Enter title\">--}}\n-{{--                                    </div>--}}\n-{{--                                    <div class=\"pl-1\">--}}\n-{{--                                        <button type=\"submit\" class=\"btn btn-success waves-effect waves-light\">Submit--}}\n-{{--                                        </button>--}}\n-{{--                                    </div>--}}\n-\n-{{--                                </div>--}}\n-{{--                            </form>--}}\n-\n-                            <div class=\"d-flex justify-content-end\" >\n-                                <form action=\"/branch/shipment\" class=\"d-flex\" id=\"shipmentForm\">\n-                                    <div class=\"row\">\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <input type=\"text\" name=\"from_date\" class=\"form-control datepicker\"  placeholder=\"From date\" value=\"{{ request('from_date') }}\">\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <input type=\"text\" name=\"to_date\" class=\"form-control datepicker\"    placeholder=\"To date\" value=\"{{ request('to_date') }}\">\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-3\">\n-                                            <div class=\"form-group\">\n-                                                <input name=\"search\" value=\"{{$search??''}}\" class=\"form-control \" type=\"search\" placeholder=\"Search\" aria-label=\"Search\">\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <button class=\"btn btn-info t-5\" type=\"submit\">Search</button>\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <a href=\"#\" class=\"btn btn-success\" id=\"exportButton\">Export</a>\n-                                            </div>\n-                                        </div>\n-                                    </div>\n-                                  </form>\n-                            </div>\n-                            <table id=\"bookingdatatable\"\n-                                   class=\"table table-striped table-bordered dt-responsive nowrap\"\n-                                   style=\"border-collapse: collapse; border-spacing: 0; width: 100%;\">\n-                                <thead>\n-\n-                                <tr>\n-                                    @canany([permission_edit(),permission_view(),'shipment-show'])\n-                                        <th style=\"text-align: center\">Action</th>\n-                                    @endcanany\n-                                    <th>Book<br>No</th>\n-                                    <th>No<br>Pcs</th>\n-                                    <th>Tot<br>Wgt</th>\n-                                    <th>Shipment <br>Type</th>\n-                                    <th>Sender<br>Name</th>\n-                                    <th>Sender<br>Phone</th>\n-                                    <th>Receiver<br>Name</th>\n-                                    <th>Receiver<br>Country</th>             \n-                                    <th>Receiver<br>State</th>\n-                                    <th>Document<br>Id</th>\n-                                    <th>Shipping<br>Status</th>\n-                                    <th>Payment<br>Method</th>\n-                                    <th>Courier<br>Company</th>\n-                                    <th>Driver/<br>Staff</th>\n-                                    <th>Date</th>\n-\n-                                </tr>\n-\n-                                </thead>\n-\n-                                <tbody>\n-                                    <?php\n-                                        $lastStatus = '';\n-                                        $statusList = [];\n-                                    ?>\n-                                @foreach($shipments as $key=> $shipment)\n-\n-                                <?php\n-                                    // if(!empty($shipment->statusVal->name)){\n-                                        // if($shipment->statusVal->name == \"Enquiry collected\") {\n-                                        //     $showAddItems = true;\n-                                        //     $style =\"style=background-color:yellow;padding:5px;\";\n-                                        // } else {\n-                                        //     $style =\"style=background-color:none\";\n-                                        //     $showAddItems = false;\n-                                        // }\n-                                    // }\n-                                    $status = '';\n-                                    $lastStatus = '';\n-                                    $statusList = '';\n-\n-                                    $status = $shipment->statusVal->name;\n-                                    foreach($shipment->boxes as $box) {\n-                                        if(($box->boxStatuses != null)) {\n-                                            $statusList = $shipment->last_status;\n-                                        }\n-                                    }\n-\n-\n-                                    $lastStatus = (!empty($statusList) ) ? $statusList : $status ;\n-                                    if($lastStatus == 'Enquiry collected') {\n-                                            $showAddItems = true;\n-                                            $style =\"style=background-color:yellow;padding:5px;\";\n-                                    } else {\n-                                        $style =\"style=background-color:none\";\n-                                        $showAddItems = false;\n-                                    }\n-                                    $statusss = null;\n-                                    if ($shipment->boxes->isEmpty()) {\n-                                        $statusss = $shipment->status_id;\n-                                    } else {\n-                                        if($statusss == 15 || $statusss == 1 || $statusss == null) {\n-\n-                                            foreach ($shipment->boxes as $box) {\n-                                                $latestStatus = $box->boxStatuses()->orderBy('id', 'desc')->first();\n-                                                if ($latestStatus && ($latestStatus->id != 15 && $latestStatus->id != 1)) {\n-                                                    $statusss = $latestStatus->status_id;\n-                                                    break;\n-                                                }\n-                                            }\n-                                        }\n-                                        else{\n-                                            $statusss = $shipment->status_id;\n-                                        }\n-\n-                                    }\n-                                ?>\n-                                    <tr>\n-                                        <td>\n-                                            @can(permission_edit())\n-                                            @if(branch()->id == $shipment->branch_id)\n-                                                <a href=\"{{edit_url($shipment->id)}}\"\n-                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning editBtn\" ststus=\"{{$statusss}}\" statusName=\"{{  $lastStatus??'' }}\">\n-                                                    <i class=\"fas  fa-lg fa-pencil-alt\"></i>\n-                                                </a>\n-                                            @endif\n-                                            @endcan\n-                                            @can(permission_view())\n-                                                <a href=\"{{show_url($shipment->id)}}\"\n-                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-success \">\n-                                                    <i class=\"fas  fa-lg fa-eye\"></i>\n-                                                </a>\n-                                            @endcan\n-                                            @can('shipment-print')\n-                                                <a href=\"{{route('branch.shipment.print',$shipment->id)}}\" target=\"_blank\"\n-                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\">\n-                                                    <i class=\"fas  fa-lg fa-print\"   title=\"Customs copy\"></i>\n-                                                </a>\n-\n-                                                <!--<a href=\"{{route('branch.shipment.print_customer',$shipment->id)}}\" target=\"_blank\"-->\n-                                                <!--    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\" style=\"background:#1274bb; border: 0px;\"  >-->\n-                                                <!--    <i class=\"fas  fa-lg fa-print\"   title=\"Customer copy\"></i>-->\n-                                                <!--</a>-->\n-\n-                                            @endcan\n-                                            @if($showAddItems)\n-                                                @if(branch()->id == $shipment->branch_id)\n-                                                    <a href=\"{{edit_url($shipment->id)}}\"\n-                                                        class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning\" >\n-                                                        <i class=\"fas  fa-lg fa-plus\"></i>\n-                                                    </a>\n-                                                @endif\n-                                            @endif\n-                                        </td>\n-                                        <td>{{ $shipment->booking_number }}</td>\n-                                        <td>{{ $shipment->number_of_pcs?$shipment->number_of_pcs: $shipment->number_of_pcs_create }}</td>\n-                                        <td>{{ $shipment->grand_total_weight }}</td>\n-                                        <td>{{ $shipment->shipMethType->name??\"\" }}</td>\n-                                        <td>{{ $shipment->sender->name }}</td>\n-                                        <td>{{ $shipment->sender->phone??'-' }}</td>\n-                                        <td>{{ $shipment->receiver->name??\"\"}}</td>\n-                                        <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n-                                        <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n-                                        <td>{{ $shipment->receiver->name??\"\"}}</td>\n-                                        <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n-                                        <td>{{ $shipment->payment_method }}</td>\n-                                        <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n-                                        <td>    @if($shipment->collected_by == 'driver')\n-                                                    {{ $shipment->driver?$shipment->driver->name:'-'}}\n-                                                @else\n-                                                    {{$shipment->staff?$shipment->staff->full_name:'-'}}\n-                                                @endif\n-                                        </td>\n-                                        <td>{{ !empty($shipment->created_date)? date('d-m-Y', strtotime($shipment->created_date)):''  }}</td>\n-\n-                                        <!-- @canany([permission_edit(),permission_view(),'shipment-show'])\n-                                            <form method=\"post\" action=\"{{delete_url($shipment->id)}}\"> -->\n-                                                <!-- <td>\n-                                                    @can(permission_edit())\n-                                                        <a href=\"{{edit_url($shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n-                                                            <i class=\"fas fa-pencil-alt\"></i>\n-                                                        </a>\n-                                                    @endcan\n-                                                    @can(permission_view())\n-                                                        <a href=\"{{show_url($shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-success\">\n-                                                            <i class=\"fas fa-eye\"></i>\n-                                                        </a>\n-                                                    @endcan\n-                                                    @can('shipment-print')\n-                                                        <a href=\"{{route('branch.shipment.print',$shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-dark\">\n-                                                            <i class=\"fas fa-print\"></i>\n-                                                        </a>\n-                                                    @endcan\n-                                                    @if($showAddItems)\n-                                                        <a href=\"{{route('branch.shipment.item',$shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n-                                                            <i class=\"fas fa-plus\"></i>\n-                                                        </a>\n-                                                    @endif\n-                                                </td> -->\n-                                            <!-- </form> -->\n-                                        <!-- @endcanany -->\n-                                    </tr>\n-                                @endforeach\n-                                </tbody>\n-                            </table>\n-                            <div class=\"d-flex justify-content-end\">\n-                                {{ $shipments->onEachSide(1)->links() }}\n-                            </div>\n-\n-                        </div>\n-                    </div>\n-                </div>\n-\n-            </div>\n-            <!-- end container-fluid -->\n-\n-        </div>\n-        <!-- end content -->\n-\n-        <div class=\"modal fade\" id=\"exampleModalCenter\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalCenterTitle\" aria-hidden=\"true\">\n-            <div class=\"modal-dialog modal-dialog-centered\" role=\"document\">\n-              <div class=\"modal-content\">\n-                <div class=\"modal-header\">\n-                  <h5 class=\"modal-title\" id=\"exampleModalLongTitle\">Enter access key</h5>\n-                  <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n-                    <span aria-hidden=\"true\">&times;</span>\n-                  </button>\n-                </div>\n-                <div class=\"modal-body\">\n-                  <div class=\"form-group\">\n-                    <input type=\"password\" class=\"form-control\" id=\"passkey\">\n-                  </div>\n-                </div>\n-                <div class=\"modal-footer justify-content-center\">\n-                  {{-- <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button> --}}\n-                  <button type=\"button\" class=\"btn btn-primary\" id=\"passkeyBtn\">Submit</button>\n-                </div>\n-              </div>\n-            </div>\n-        </div>\n-\n-@endsection\n-@section('styles')\n-    @include('layouts.datatables_style')\n-@endsection\n-\n-@section('scripts')\n-    @include('layouts.datatables_js')\n-    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js\"></script>\n-    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js\"></script>\n-    @if(session('showModal'))\n-        <script>\n-            $(document).ready(function() {\n-                $('#exampleModalCenter').modal('show');\n-            });\n-        </script>\n-    @endif\n-    <script>\n-\n-$(document).ready(function () {\n-    $('#bookingdatatable').DataTable({\n-        \"autoWidth\": false,\n-        \"aaSorting\": [ [0,'desc'] ],\n-        \"scrollX\": true,\n-        \"paging\": false,\n-        \"responsive\": false,\n-        \"searching\": false\n-    });\n-\n-    $('.datepicker').datepicker({\n-        format: 'dd/mm/yyyy',\n-        autoclose: true,\n-        todayHighlight: true\n-    });\n-\n-\n-    $('#exportButton').click(function(event) {\n-        event.preventDefault();\n-\n-        var formData = $('#shipmentForm').serialize();\n-\n-        var exportUrl = '/branch/shipment/export?' + formData;\n-\n-        window.location.href = exportUrl;\n-    });\n-\n-    $('.editBtn').click(function(event) {\n-        event.preventDefault();\n-        var status = $(this).attr('ststus') || null;\n-        var statusName = $(this).attr('statusName');\n-        console.log(statusName);\n-        var url = $(this).attr('href');\n-        if(statusName == \"Shipment received\" || statusName == \"Enquiry collected\"){\n-            if(status == 15 || status == 1 || status == 2 || status == null ){\n-            window.location.href = url;\n-            }\n-            else{\n-                $('#passkey').attr('data-url', url);\n-                $('#exampleModalCenter').modal('show');\n-            }\n-        }\n-        else{\n-            $('#passkey').attr('data-url', url);\n-            $('#exampleModalCenter').modal('show');\n-        }\n-    });\n-\n-    $('#passkeyBtn').click(function(event) {\n-        var passkey = $('#passkey').val();\n-        var url = $('#passkey').data('url');\n-        var encryptedPasskey = CryptoJS.SHA256(passkey).toString();\n-\n-        var exportUrl = url + '?password=' + encodeURIComponent(encryptedPasskey);\n-\n-        window.location.href = exportUrl;\n-    });\n-\n-\n-\n-});\n-\n-    </script>\n-@endsection\n-@extends('layouts.app')\n-\n-@section('content')\n-\n-    <div class=\"content-page\" id=\"content-page\">\n-        <div class=\"content\">\n-\n-            <!-- Start Content-->\n-            <div class=\"container-fluid\">\n-\n-                <!-- start page title -->\n-                <div class=\"row\">\n-                    <div class=\"col-12\">\n-                        <div class=\"page-title-box\">\n-                            <div class=\"page-title-right\">\n-                                {!! breadcrumbs() !!}\n-                            </div>\n-                            <h4 class=\"page-title\">Invoices</h4>\n-                            @can(permission_create())\n-                                <div class=\"fa-pull-right pb-3\"><a href=\"{{create_url()}}\"\n-                                                                   class=\"btn btn-success\">Add New</a></div>\n-                            @endcan\n-                        </div>\n-                    </div>\n-\n-                </div>\n-\n-\n-                <div class=\"row\">\n-                    <div class=\"col-sm-12\">\n-\n-                        <div class=\"card-box table-responsive\">\n-{{--                            <form action=\"\" method=\"get\">--}}\n-{{--                                <div class=\"row justify-content-center\">--}}\n-\n-{{--                                    <div class=\"form-group\">--}}\n-{{--                                        <input type=\"date\" value=\"{{date('Y-m-d')}}\" max=\"{{date('Y-m-d')}}\"--}}\n-{{--                                               class=\"form-control\" id=\"propertyname\" name=\"date\"--}}\n-{{--                                               placeholder=\"Enter title\">--}}\n-{{--                                    </div>--}}\n-{{--                                    <div class=\"pl-1\">--}}\n-{{--                                        <button type=\"submit\" class=\"btn btn-success waves-effect waves-light\">Submit--}}\n-{{--                                        </button>--}}\n-{{--                                    </div>--}}\n-\n-{{--                                </div>--}}\n-{{--                            </form>--}}\n-\n-                            <div class=\"d-flex justify-content-end\" >\n-                                <form action=\"/branch/shipment\" class=\"d-flex\" id=\"shipmentForm\">\n-                                    <div class=\"row\">\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <input type=\"text\" name=\"from_date\" class=\"form-control datepicker\"  placeholder=\"From date\" value=\"{{ request('from_date') }}\">\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <input type=\"text\" name=\"to_date\" class=\"form-control datepicker\"    placeholder=\"To date\" value=\"{{ request('to_date') }}\">\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-3\">\n-                                            <div class=\"form-group\">\n-                                                <input name=\"search\" value=\"{{$search??''}}\" class=\"form-control \" type=\"search\" placeholder=\"Search\" aria-label=\"Search\">\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <button class=\"btn btn-info t-5\" type=\"submit\">Search</button>\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <a href=\"#\" class=\"btn btn-success\" id=\"exportButton\">Export</a>\n-                                            </div>\n-                                        </div>\n-                                    </div>\n-                                  </form>\n-                            </div>\n-                            <table id=\"bookingdatatable\"\n-                                   class=\"table table-striped table-bordered dt-responsive nowrap\"\n-                                   style=\"border-collapse: collapse; border-spacing: 0; width: 100%;\">\n-                                <thead>\n-\n-                                <tr>\n-                                    @canany([permission_edit(),permission_view(),'shipment-show'])\n-                                        <th style=\"text-align: center\">Action</th>\n-                                    @endcanany\n-                                    <th>Book<br>No</th>\n-                                    <th>No<br>Pcs</th>\n-                                    <th>Tot<br>Wgt</th>\n-                                    <th>Shipment <br>Type</th>\n-                                    <th>Sender<br>Name</th>\n-                                    <th>Sender<br>Phone</th>\n-                                    <th>Receiver<br>Name</th>\n-                                    <th>Receiver<br>Country</th>             \n-                                    <th>Receiver<br>State</th>\n-                                    <th>Document<br>Id</th>\n-                                    <th>Shipping<br>Status</th>\n-                                    <th>Payment<br>Method</th>\n-                                    <th>Courier<br>Company</th>\n-                                    <th>Driver/<br>Staff</th>\n-                                    <th>Date</th>\n-\n-                                </tr>\n-\n-                                </thead>\n-\n-                                <tbody>\n-                                    <?php\n-                                        $lastStatus = '';\n-                                        $statusList = [];\n-                                    ?>\n-                                @foreach($shipments as $key=> $shipment)\n-\n-                                <?php\n-                                    // if(!empty($shipment->statusVal->name)){\n-                                        // if($shipment->statusVal->name == \"Enquiry collected\") {\n-                                        //     $showAddItems = true;\n-                                        //     $style =\"style=background-color:yellow;padding:5px;\";\n-                                        // } else {\n-                                        //     $style =\"style=background-color:none\";\n-                                        //     $showAddItems = false;\n-                                        // }\n-                                    // }\n-                                    $status = '';\n-                                    $lastStatus = '';\n-                                    $statusList = '';\n-\n-                                    $status = $shipment->statusVal->name;\n-                                    foreach($shipment->boxes as $box) {\n-                                        if(($box->boxStatuses != null)) {\n-                                            $statusList = $shipment->last_status;\n-                                        }\n-                                    }\n-\n-\n-                                    $lastStatus = (!empty($statusList) ) ? $statusList : $status ;\n-                                    if($lastStatus == 'Enquiry collected') {\n-                                            $showAddItems = true;\n-                                            $style =\"style=background-color:yellow;padding:5px;\";\n-                                    } else {\n-                                        $style =\"style=background-color:none\";\n-                                        $showAddItems = false;\n-                                    }\n-                                    $statusss = null;\n-                                    if ($shipment->boxes->isEmpty()) {\n-                                        $statusss = $shipment->status_id;\n-                                    } else {\n-                                        if($statusss == 15 || $statusss == 1 || $statusss == null) {\n-\n-                                            foreach ($shipment->boxes as $box) {\n-                                                $latestStatus = $box->boxStatuses()->orderBy('id', 'desc')->first();\n-                                                if ($latestStatus && ($latestStatus->id != 15 && $latestStatus->id != 1)) {\n-                                                    $statusss = $latestStatus->status_id;\n-                                                    break;\n-                                                }\n-                                            }\n-                                        }\n-                                        else{\n-                                            $statusss = $shipment->status_id;\n-                                        }\n-\n-                                    }\n-                                ?>\n-                                    <tr>\n-                                        <td>\n-                                            @can(permission_edit())\n-                                            @if(branch()->id == $shipment->branch_id)\n-                                                <a href=\"{{edit_url($shipment->id)}}\"\n-                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning editBtn\" ststus=\"{{$statusss}}\" statusName=\"{{  $lastStatus??'' }}\">\n-                                                    <i class=\"fas  fa-lg fa-pencil-alt\"></i>\n-                                                </a>\n-                                            @endif\n-                                            @endcan\n-                                            @can(permission_view())\n-                                                <a href=\"{{show_url($shipment->id)}}\"\n-                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-success \">\n-                                                    <i class=\"fas  fa-lg fa-eye\"></i>\n-                                                </a>\n-                                            @endcan\n-                                            @can('shipment-print')\n-                                                <a href=\"{{route('branch.shipment.print',$shipment->id)}}\" target=\"_blank\"\n-                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\">\n-                                                    <i class=\"fas  fa-lg fa-print\"   title=\"Customs copy\"></i>\n-                                                </a>\n-\n-                                                <!--<a href=\"{{route('branch.shipment.print_customer',$shipment->id)}}\" target=\"_blank\"-->\n-                                                <!--    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\" style=\"background:#1274bb; border: 0px;\"  >-->\n-                                                <!--    <i class=\"fas  fa-lg fa-print\"   title=\"Customer copy\"></i>-->\n-                                                <!--</a>-->\n-\n-                                            @endcan\n-                                            @if($showAddItems)\n-                                                @if(branch()->id == $shipment->branch_id)\n-                                                    <a href=\"{{edit_url($shipment->id)}}\"\n-                                                        class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning\" >\n-                                                        <i class=\"fas  fa-lg fa-plus\"></i>\n-                                                    </a>\n-                                                @endif\n-                                            @endif\n-                                        </td>\n-                                        <td>{{ $shipment->booking_number }}</td>\n-                                        <td>{{ $shipment->number_of_pcs?$shipment->number_of_pcs: $shipment->number_of_pcs_create }}</td>\n-                                        <td>{{ $shipment->grand_total_weight }}</td>\n-                                        <td>{{ $shipment->shipMethType->name??\"\" }}</td>\n-                                        <td>{{ $shipment->sender->name }}</td>\n-                                        <td>{{ $shipment->sender->phone??'-' }}</td>\n-                                        <td>{{ $shipment->receiver->name??\"\"}}</td>\n-                                        <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n-                                        <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n-                                        <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n-                                        <td>{{ $shipment->payment_method }}</td>\n-                                        <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n-                                        <td>    @if($shipment->collected_by == 'driver')\n-                                                    {{ $shipment->driver?$shipment->driver->name:'-'}}\n-                                                @else\n-                                                    {{$shipment->staff?$shipment->staff->full_name:'-'}}\n-                                                @endif\n-                                        </td>\n-                                        <td>{{ !empty($shipment->created_date)? date('d-m-Y', strtotime($shipment->created_date)):''  }}</td>\n-\n-                                        <!-- @canany([permission_edit(),permission_view(),'shipment-show'])\n-                                            <form method=\"post\" action=\"{{delete_url($shipment->id)}}\"> -->\n-                                                <!-- <td>\n-                                                    @can(permission_edit())\n-                                                        <a href=\"{{edit_url($shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n-                                                            <i class=\"fas fa-pencil-alt\"></i>\n-                                                        </a>\n-                                                    @endcan\n-                                                    @can(permission_view())\n-                                                        <a href=\"{{show_url($shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-success\">\n-                                                            <i class=\"fas fa-eye\"></i>\n-                                                        </a>\n-                                                    @endcan\n-                                                    @can('shipment-print')\n-                                                        <a href=\"{{route('branch.shipment.print',$shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-dark\">\n-                                                            <i class=\"fas fa-print\"></i>\n-                                                        </a>\n-                                                    @endcan\n-                                                    @if($showAddItems)\n-                                                        <a href=\"{{route('branch.shipment.item',$shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n-                                                            <i class=\"fas fa-plus\"></i>\n-                                                        </a>\n-                                                    @endif\n-                                                </td> -->\n-                                            <!-- </form> -->\n-                                        <!-- @endcanany -->\n-                                    </tr>\n-                                @endforeach\n-                                </tbody>\n-                            </table>\n-                            <div class=\"d-flex justify-content-end\">\n-                                {{ $shipments->onEachSide(1)->links() }}\n-                            </div>\n-\n-                        </div>\n-                    </div>\n-                </div>\n-\n-            </div>\n-            <!-- end container-fluid -->\n-\n-        </div>\n-        <!-- end content -->\n-\n-        <div class=\"modal fade\" id=\"exampleModalCenter\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalCenterTitle\" aria-hidden=\"true\">\n-            <div class=\"modal-dialog modal-dialog-centered\" role=\"document\">\n-              <div class=\"modal-content\">\n-                <div class=\"modal-header\">\n-                  <h5 class=\"modal-title\" id=\"exampleModalLongTitle\">Enter access key</h5>\n-                  <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n-                    <span aria-hidden=\"true\">&times;</span>\n-                  </button>\n-                </div>\n-                <div class=\"modal-body\">\n-                  <div class=\"form-group\">\n-                    <input type=\"password\" class=\"form-control\" id=\"passkey\">\n-                  </div>\n-                </div>\n-                <div class=\"modal-footer justify-content-center\">\n-                  {{-- <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button> --}}\n-                  <button type=\"button\" class=\"btn btn-primary\" id=\"passkeyBtn\">Submit</button>\n-                </div>\n-              </div>\n-            </div>\n-        </div>\n-\n-@endsection\n-@section('styles')\n-    @include('layouts.datatables_style')\n-@endsection\n-\n-@section('scripts')\n-    @include('layouts.datatables_js')\n-    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js\"></script>\n-    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js\"></script>\n-    @if(session('showModal'))\n-        <script>\n-            $(document).ready(function() {\n-                $('#exampleModalCenter').modal('show');\n-            });\n-        </script>\n-    @endif\n-    <script>\n-\n-$(document).ready(function () {\n-    $('#bookingdatatable').DataTable({\n-        \"autoWidth\": false,\n-        \"aaSorting\": [ [0,'desc'] ],\n-        \"scrollX\": true,\n-        \"paging\": false,\n-        \"responsive\": false,\n-        \"searching\": false\n-    });\n-\n-    $('.datepicker').datepicker({\n-        format: 'dd/mm/yyyy',\n-        autoclose: true,\n-        todayHighlight: true\n-    });\n-\n-\n-    $('#exportButton').click(function(event) {\n-        event.preventDefault();\n-\n-        var formData = $('#shipmentForm').serialize();\n-\n-        var exportUrl = '/branch/shipment/export?' + formData;\n-\n-        window.location.href = exportUrl;\n-    });\n-\n-    $('.editBtn').click(function(event) {\n-        event.preventDefault();\n-        var status = $(this).attr('ststus') || null;\n-        var statusName = $(this).attr('statusName');\n-        console.log(statusName);\n-        var url = $(this).attr('href');\n-        if(statusName == \"Shipment received\" || statusName == \"Enquiry collected\"){\n-            if(status == 15 || status == 1 || status == 2 || status == null ){\n-            window.location.href = url;\n-            }\n-            else{\n-                $('#passkey').attr('data-url', url);\n-                $('#exampleModalCenter').modal('show');\n-            }\n-        }\n-        else{\n-            $('#passkey').attr('data-url', url);\n-            $('#exampleModalCenter').modal('show');\n-        }\n-    });\n-\n-    $('#passkeyBtn').click(function(event) {\n-        var passkey = $('#passkey').val();\n-        var url = $('#passkey').data('url');\n-        var encryptedPasskey = CryptoJS.SHA256(passkey).toString();\n-\n-        var exportUrl = url + '?password=' + encodeURIComponent(encryptedPasskey);\n-\n-        window.location.href = exportUrl;\n-    });\n-\n-\n-\n-});\n-\n-    </script>\n-@endsection\n-@extends('layouts.app')\n-\n-@section('content')\n-\n-    <div class=\"content-page\" id=\"content-page\">\n-        <div class=\"content\">\n-\n-            <!-- Start Content-->\n-            <div class=\"container-fluid\">\n-\n-                <!-- start page title -->\n-                <div class=\"row\">\n-                    <div class=\"col-12\">\n-                        <div class=\"page-title-box\">\n-                            <div class=\"page-title-right\">\n-                                {!! breadcrumbs() !!}\n-                            </div>\n-                            <h4 class=\"page-title\">Invoices</h4>\n-                            @can(permission_create())\n-                                <div class=\"fa-pull-right pb-3\"><a href=\"{{create_url()}}\"\n-                                                                   class=\"btn btn-success\">Add New</a></div>\n-                            @endcan\n-                        </div>\n-                    </div>\n-\n-                </div>\n-\n-\n-                <div class=\"row\">\n-                    <div class=\"col-sm-12\">\n-\n-                        <div class=\"card-box table-responsive\">\n-{{--                            <form action=\"\" method=\"get\">--}}\n-{{--                                <div class=\"row justify-content-center\">--}}\n-\n-{{--                                    <div class=\"form-group\">--}}\n-{{--                                        <input type=\"date\" value=\"{{date('Y-m-d')}}\" max=\"{{date('Y-m-d')}}\"--}}\n-{{--                                               class=\"form-control\" id=\"propertyname\" name=\"date\"--}}\n-{{--                                               placeholder=\"Enter title\">--}}\n-{{--                                    </div>--}}\n-{{--                                    <div class=\"pl-1\">--}}\n-{{--                                        <button type=\"submit\" class=\"btn btn-success waves-effect waves-light\">Submit--}}\n-{{--                                        </button>--}}\n-{{--                                    </div>--}}\n-\n-{{--                                </div>--}}\n-{{--                            </form>--}}\n-\n-                            <div class=\"d-flex justify-content-end\" >\n-                                <form action=\"/branch/shipment\" class=\"d-flex\" id=\"shipmentForm\">\n-                                    <div class=\"row\">\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <input type=\"text\" name=\"from_date\" class=\"form-control datepicker\"  placeholder=\"From date\" value=\"{{ request('from_date') }}\">\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <input type=\"text\" name=\"to_date\" class=\"form-control datepicker\"    placeholder=\"To date\" value=\"{{ request('to_date') }}\">\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-3\">\n-                                            <div class=\"form-group\">\n-                                                <input name=\"search\" value=\"{{$search??''}}\" class=\"form-control \" type=\"search\" placeholder=\"Search\" aria-label=\"Search\">\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <button class=\"btn btn-info t-5\" type=\"submit\">Search</button>\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <a href=\"#\" class=\"btn btn-success\" id=\"exportButton\">Export</a>\n-                                            </div>\n-                                        </div>\n-                                    </div>\n-                                  </form>\n-                            </div>\n-                            <table id=\"bookingdatatable\"\n-                                   class=\"table table-striped table-bordered dt-responsive nowrap\"\n-                                   style=\"border-collapse: collapse; border-spacing: 0; width: 100%;\">\n-                                <thead>\n-\n-                                <tr>\n-                                    @canany([permission_edit(),permission_view(),'shipment-show'])\n-                                        <th style=\"text-align: center\">Action</th>\n-                                    @endcanany\n-                                    <th>Book<br>No</th>\n-                                    <th>No<br>Pcs</th>\n-                                    <th>Tot<br>Wgt</th>\n-                                    <th>Shipment <br>Type</th>\n-                                    <th>Sender<br>Name</th>\n-                                    <th>Sender<br>Phone</th>\n-                                    <th>Receiver<br>Name</th>\n-                                    <th>Receiver<br>Country</th>\n-                                   \n-                                    <th>Receiver<br>State</th>\n-                                    <th>Shipping<br>Status</th>\n-                                    <th>Payment<br>Method</th>\n-                                    <th>Courier<br>Company</th>\n-                                    <th>Driver/<br>Staff</th>\n-                                    <th>Date</th>\n-\n-                                </tr>\n-\n-                                </thead>\n-\n-                                <tbody>\n-                                    <?php\n-                                        $lastStatus = '';\n-                                        $statusList = [];\n-                                    ?>\n-                                @foreach($shipments as $key=> $shipment)\n-\n-                                <?php\n-                                    // if(!empty($shipment->statusVal->name)){\n-                                        // if($shipment->statusVal->name == \"Enquiry collected\") {\n-                                        //     $showAddItems = true;\n-                                        //     $style =\"style=background-color:yellow;padding:5px;\";\n-                                        // } else {\n-                                        //     $style =\"style=background-color:none\";\n-                                        //     $showAddItems = false;\n-                                        // }\n-                                    // }\n-                                    $status = '';\n-                                    $lastStatus = '';\n-                                    $statusList = '';\n-\n-                                    $status = $shipment->statusVal->name;\n-                                    foreach($shipment->boxes as $box) {\n-                                        if(($box->boxStatuses != null)) {\n-                                            $statusList = $shipment->last_status;\n-                                        }\n-                                    }\n-\n-\n-                                    $lastStatus = (!empty($statusList) ) ? $statusList : $status ;\n-                                    if($lastStatus == 'Enquiry collected') {\n-                                            $showAddItems = true;\n-                                            $style =\"style=background-color:yellow;padding:5px;\";\n-                                    } else {\n-                                        $style =\"style=background-color:none\";\n-                                        $showAddItems = false;\n-                                    }\n-                                    $statusss = null;\n-                                    if ($shipment->boxes->isEmpty()) {\n-                                        $statusss = $shipment->status_id;\n-                                    } else {\n-                                        if($statusss == 15 || $statusss == 1 || $statusss == null) {\n-\n-                                            foreach ($shipment->boxes as $box) {\n-                                                $latestStatus = $box->boxStatuses()->orderBy('id', 'desc')->first();\n-                                                if ($latestStatus && ($latestStatus->id != 15 && $latestStatus->id != 1)) {\n-                                                    $statusss = $latestStatus->status_id;\n-                                                    break;\n-                                                }\n-                                            }\n-                                        }\n-                                        else{\n-                                            $statusss = $shipment->status_id;\n-                                        }\n-\n-                                    }\n-                                ?>\n-                                    <tr>\n-                                        <td>\n-                                            @can(permission_edit())\n-                                            @if(branch()->id == $shipment->branch_id)\n-                                                <a href=\"{{edit_url($shipment->id)}}\"\n-                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning editBtn\" ststus=\"{{$statusss}}\" statusName=\"{{  $lastStatus??'' }}\">\n-                                                    <i class=\"fas  fa-lg fa-pencil-alt\"></i>\n-                                                </a>\n-                                            @endif\n-                                            @endcan\n-                                            @can(permission_view())\n-                                                <a href=\"{{show_url($shipment->id)}}\"\n-                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-success \">\n-                                                    <i class=\"fas  fa-lg fa-eye\"></i>\n-                                                </a>\n-                                            @endcan\n-                                            @can('shipment-print')\n-                                                <a href=\"{{route('branch.shipment.print',$shipment->id)}}\" target=\"_blank\"\n-                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\">\n-                                                    <i class=\"fas  fa-lg fa-print\"   title=\"Customs copy\"></i>\n-                                                </a>\n-\n-                                                <!--<a href=\"{{route('branch.shipment.print_customer',$shipment->id)}}\" target=\"_blank\"-->\n-                                                <!--    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\" style=\"background:#1274bb; border: 0px;\"  >-->\n-                                                <!--    <i class=\"fas  fa-lg fa-print\"   title=\"Customer copy\"></i>-->\n-                                                <!--</a>-->\n-\n-                                            @endcan\n-                                            @if($showAddItems)\n-                                                @if(branch()->id == $shipment->branch_id)\n-                                                    <a href=\"{{edit_url($shipment->id)}}\"\n-                                                        class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning\" >\n-                                                        <i class=\"fas  fa-lg fa-plus\"></i>\n-                                                    </a>\n-                                                @endif\n-                                            @endif\n-                                        </td>\n-                                        <td>{{ $shipment->booking_number }}</td>\n-                                        <td>{{ $shipment->number_of_pcs?$shipment->number_of_pcs: $shipment->number_of_pcs_create }}</td>\n-                                        <td>{{ $shipment->grand_total_weight }}</td>\n-                                        <td>{{ $shipment->shipMethType->name??\"\" }}</td>\n-                                        <td>{{ $shipment->sender->name }}</td>\n-                                        <td>{{ $shipment->sender->phone??'-' }}</td>\n-                                        <td>{{ $shipment->receiver->name??\"\"}}</td>\n-                                        <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n-                                        <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n-                                        <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n-                                        <td>{{ $shipment->payment_method }}</td>\n-                                        <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n-                                        <td>    @if($shipment->collected_by == 'driver')\n-                                                    {{ $shipment->driver?$shipment->driver->name:'-'}}\n-                                                @else\n-                                                    {{$shipment->staff?$shipment->staff->full_name:'-'}}\n-                                                @endif\n-                                        </td>\n-                                        <td>{{ !empty($shipment->created_date)? date('d-m-Y', strtotime($shipment->created_date)):''  }}</td>\n-\n-                                        <!-- @canany([permission_edit(),permission_view(),'shipment-show'])\n-                                            <form method=\"post\" action=\"{{delete_url($shipment->id)}}\"> -->\n-                                                <!-- <td>\n-                                                    @can(permission_edit())\n-                                                        <a href=\"{{edit_url($shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n-                                                            <i class=\"fas fa-pencil-alt\"></i>\n-                                                        </a>\n-                                                    @endcan\n-                                                    @can(permission_view())\n-                                                        <a href=\"{{show_url($shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-success\">\n-                                                            <i class=\"fas fa-eye\"></i>\n-                                                        </a>\n-                                                    @endcan\n-                                                    @can('shipment-print')\n-                                                        <a href=\"{{route('branch.shipment.print',$shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-dark\">\n-                                                            <i class=\"fas fa-print\"></i>\n-                                                        </a>\n-                                                    @endcan\n-                                                    @if($showAddItems)\n-                                                        <a href=\"{{route('branch.shipment.item',$shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n-                                                            <i class=\"fas fa-plus\"></i>\n-                                                        </a>\n-                                                    @endif\n-                                                </td> -->\n-                                            <!-- </form> -->\n-                                        <!-- @endcanany -->\n-                                    </tr>\n-                                @endforeach\n-                                </tbody>\n-                            </table>\n-                            <div class=\"d-flex justify-content-end\">\n-                                {{ $shipments->onEachSide(1)->links() }}\n-                            </div>\n-\n-                        </div>\n-                    </div>\n-                </div>\n-\n-            </div>\n-            <!-- end container-fluid -->\n-\n-        </div>\n-        <!-- end content -->\n-\n-        <div class=\"modal fade\" id=\"exampleModalCenter\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalCenterTitle\" aria-hidden=\"true\">\n-            <div class=\"modal-dialog modal-dialog-centered\" role=\"document\">\n-              <div class=\"modal-content\">\n-                <div class=\"modal-header\">\n-                  <h5 class=\"modal-title\" id=\"exampleModalLongTitle\">Enter access key</h5>\n-                  <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n-                    <span aria-hidden=\"true\">&times;</span>\n-                  </button>\n-                </div>\n-                <div class=\"modal-body\">\n-                  <div class=\"form-group\">\n-                    <input type=\"password\" class=\"form-control\" id=\"passkey\">\n-                  </div>\n-                </div>\n-                <div class=\"modal-footer justify-content-center\">\n-                  {{-- <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button> --}}\n-                  <button type=\"button\" class=\"btn btn-primary\" id=\"passkeyBtn\">Submit</button>\n-                </div>\n-              </div>\n-            </div>\n-        </div>\n-\n-@endsection\n-@section('styles')\n-    @include('layouts.datatables_style')\n-@endsection\n-\n-@section('scripts')\n-    @include('layouts.datatables_js')\n-    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js\"></script>\n-    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js\"></script>\n-    @if(session('showModal'))\n-        <script>\n-            $(document).ready(function() {\n-                $('#exampleModalCenter').modal('show');\n-            });\n-        </script>\n-    @endif\n-    <script>\n-\n-$(document).ready(function () {\n-    $('#bookingdatatable').DataTable({\n-        \"autoWidth\": false,\n-        \"aaSorting\": [ [0,'desc'] ],\n-        \"scrollX\": true,\n-        \"paging\": false,\n-        \"responsive\": false,\n-        \"searching\": false\n-    });\n-\n-    $('.datepicker').datepicker({\n-        format: 'dd/mm/yyyy',\n-        autoclose: true,\n-        todayHighlight: true\n-    });\n-\n-\n-    $('#exportButton').click(function(event) {\n-        event.preventDefault();\n-\n-        var formData = $('#shipmentForm').serialize();\n-\n-        var exportUrl = '/branch/shipment/export?' + formData;\n-\n-        window.location.href = exportUrl;\n-    });\n-\n-    $('.editBtn').click(function(event) {\n-        event.preventDefault();\n-        var status = $(this).attr('ststus') || null;\n-        var statusName = $(this).attr('statusName');\n-        console.log(statusName);\n-        var url = $(this).attr('href');\n-        if(statusName == \"Shipment received\" || statusName == \"Enquiry collected\"){\n-            if(status == 15 || status == 1 || status == 2 || status == null ){\n-            window.location.href = url;\n-            }\n-            else{\n-                $('#passkey').attr('data-url', url);\n-                $('#exampleModalCenter').modal('show');\n-            }\n-        }\n-        else{\n-            $('#passkey').attr('data-url', url);\n-            $('#exampleModalCenter').modal('show');\n-        }\n-    });\n-\n-    $('#passkeyBtn').click(function(event) {\n-        var passkey = $('#passkey').val();\n-        var url = $('#passkey').data('url');\n-        var encryptedPasskey = CryptoJS.SHA256(passkey).toString();\n-\n-        var exportUrl = url + '?password=' + encodeURIComponent(encryptedPasskey);\n-\n-        window.location.href = exportUrl;\n-    });\n-\n-\n-\n-});\n-\n-    </script>\n-@endsection\n"
                },
                {
                    "date": 1733727397406,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -208,9 +208,9 @@\n                                         <td>{{ $shipment->sender->phone??'-' }}</td>\n                                         <td>{{ $shipment->receiver->name??\"\"}}</td>\n                                         <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n                                         <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n-                                        <td>{{ $coustomers->grand_total_weight }}</td>\n+                                        <td>{{ $customers->grand_total_weight }}</td>\n                                         <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n                                         <td>{{ $shipment->payment_method }}</td>\n                                         <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n                                         <td>    @if($shipment->collected_by == 'driver')\n"
                },
                {
                    "date": 1733727418101,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -208,9 +208,9 @@\n                                         <td>{{ $shipment->sender->phone??'-' }}</td>\n                                         <td>{{ $shipment->receiver->name??\"\"}}</td>\n                                         <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n                                         <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n-                                        <td>{{ $customers->grand_total_weight }}</td>\n+                                        <td>{{ $customers->identification_number }}</td>\n                                         <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n                                         <td>{{ $shipment->payment_method }}</td>\n                                         <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n                                         <td>    @if($shipment->collected_by == 'driver')\n"
                },
                {
                    "date": 1733727436101,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -208,9 +208,9 @@\n                                         <td>{{ $shipment->sender->phone??'-' }}</td>\n                                         <td>{{ $shipment->receiver->name??\"\"}}</td>\n                                         <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n                                         <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n-                                        <td>{{ $customers->identification_number }}</td>\n+                                        <td>{{ $customer->identification_number }}</td>\n                                         <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n                                         <td>{{ $shipment->payment_method }}</td>\n                                         <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n                                         <td>    @if($shipment->collected_by == 'driver')\n"
                },
                {
                    "date": 1733727452323,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -208,9 +208,9 @@\n                                         <td>{{ $shipment->sender->phone??'-' }}</td>\n                                         <td>{{ $shipment->receiver->name??\"\"}}</td>\n                                         <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n                                         <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n-                                        <td>{{ $customer->identification_number }}</td>\n+                                        <td>{{ $shipment->identification_number }}</td>\n                                         <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n                                         <td>{{ $shipment->payment_method }}</td>\n                                         <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n                                         <td>    @if($shipment->collected_by == 'driver')\n"
                },
                {
                    "date": 1733727486338,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -208,9 +208,9 @@\n                                         <td>{{ $shipment->sender->phone??'-' }}</td>\n                                         <td>{{ $shipment->receiver->name??\"\"}}</td>\n                                         <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n                                         <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n-                                        <td>{{ $shipment->identification_number }}</td>\n+                                        <td>{{ $customer->identification_number }}</td>\n                                         <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n                                         <td>{{ $shipment->payment_method }}</td>\n                                         <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n                                         <td>    @if($shipment->collected_by == 'driver')\n"
                },
                {
                    "date": 1733729595195,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,375 @@\n+@extends('layouts.app')\n+\n+@section('content')\n+\n+    <div class=\"content-page\" id=\"content-page\">\n+        <div class=\"content\">\n+\n+            <!-- Start Content-->\n+            <div class=\"container-fluid\">\n+\n+                <!-- start page title -->\n+                <div class=\"row\">\n+                    <div class=\"col-12\">\n+                        <div class=\"page-title-box\">\n+                            <div class=\"page-title-right\">\n+                                {!! breadcrumbs() !!}\n+                            </div>\n+                            <h4 class=\"page-title\">Invoices</h4>\n+                            @can(permission_create())\n+                                <div class=\"fa-pull-right pb-3\"><a href=\"{{create_url()}}\"\n+                                                                   class=\"btn btn-success\">Add New</a></div>\n+                            @endcan\n+                        </div>\n+                    </div>\n+\n+                </div>\n+\n+\n+                <div class=\"row\">\n+                    <div class=\"col-sm-12\">\n+\n+                        <div class=\"card-box table-responsive\">\n+{{--                            <form action=\"\" method=\"get\">--}}\n+{{--                                <div class=\"row justify-content-center\">--}}\n+\n+{{--                                    <div class=\"form-group\">--}}\n+{{--                                        <input type=\"date\" value=\"{{date('Y-m-d')}}\" max=\"{{date('Y-m-d')}}\"--}}\n+{{--                                               class=\"form-control\" id=\"propertyname\" name=\"date\"--}}\n+{{--                                               placeholder=\"Enter title\">--}}\n+{{--                                    </div>--}}\n+{{--                                    <div class=\"pl-1\">--}}\n+{{--                                        <button type=\"submit\" class=\"btn btn-success waves-effect waves-light\">Submit--}}\n+{{--                                        </button>--}}\n+{{--                                    </div>--}}\n+\n+{{--                                </div>--}}\n+{{--                            </form>--}}\n+\n+                            <div class=\"d-flex justify-content-end\" >\n+                                <form action=\"/branch/shipment\" class=\"d-flex\" id=\"shipmentForm\">\n+                                    <div class=\"row\">\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <input type=\"text\" name=\"from_date\" class=\"form-control datepicker\"  placeholder=\"From date\" value=\"{{ request('from_date') }}\">\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <input type=\"text\" name=\"to_date\" class=\"form-control datepicker\"    placeholder=\"To date\" value=\"{{ request('to_date') }}\">\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-3\">\n+                                            <div class=\"form-group\">\n+                                                <input name=\"search\" value=\"{{$search??''}}\" class=\"form-control \" type=\"search\" placeholder=\"Search\" aria-label=\"Search\">\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <button class=\"btn btn-info t-5\" type=\"submit\">Search</button>\n+                                            </div>\n+                                        </div>\n+                                        <div class=\"col-2\">\n+                                            <div class=\"form-group\">\n+                                                <a href=\"#\" class=\"btn btn-success\" id=\"exportButton\">Export</a>\n+                                            </div>\n+                                        </div>\n+                                    </div>\n+                                  </form>\n+                            </div>\n+                            <table id=\"bookingdatatable\"\n+                                   class=\"table table-striped table-bordered dt-responsive nowrap\"\n+                                   style=\"border-collapse: collapse; border-spacing: 0; width: 100%;\">\n+                                <thead>\n+\n+                                <tr>\n+                                    @canany([permission_edit(),permission_view(),'shipment-show'])\n+                                        <th style=\"text-align: center\">Action</th>\n+                                    @endcanany\n+                                    <th>Book<br>No</th>\n+                                    <th>No<br>Pcs</th>\n+                                    <th>Tot<br>Wgt</th>\n+                                    <th>Shipment <br>Type</th>\n+                                    <th>Sender<br>Name</th>\n+                                    <th>Sender<br>Phone</th>\n+                                    <th>Receiver<br>Name</th>\n+                                    <th>Receiver<br>Country</th>             \n+                                    <th>Receiver<br>State</th>\n+                                    <th>Document<br>Id</th>\n+                                    <th>Shipping<br>Status</th>\n+                                    <th>Payment<br>Method</th>\n+                                    <th>Courier<br>Company</th>\n+                                    <th>Driver/<br>Staff</th>\n+                                    <th>Date</th>\n+\n+                                </tr>\n+\n+                                </thead>\n+\n+                                <tbody>\n+                                    <?php\n+                                        $lastStatus = '';\n+                                        $statusList = [];\n+                                    ?>\n+                                @foreach($shipments as $key=> $shipment)\n+\n+                                <?php\n+                                    // if(!empty($shipment->statusVal->name)){\n+                                        // if($shipment->statusVal->name == \"Enquiry collected\") {\n+                                        //     $showAddItems = true;\n+                                        //     $style =\"style=background-color:yellow;padding:5px;\";\n+                                        // } else {\n+                                        //     $style =\"style=background-color:none\";\n+                                        //     $showAddItems = false;\n+                                        // }\n+                                    // }\n+                                    $status = '';\n+                                    $lastStatus = '';\n+                                    $statusList = '';\n+\n+                                    $status = $shipment->statusVal->name;\n+                                    foreach($shipment->boxes as $box) {\n+                                        if(($box->boxStatuses != null)) {\n+                                            $statusList = $shipment->last_status;\n+                                        }\n+                                    }\n+\n+\n+                                    $lastStatus = (!empty($statusList) ) ? $statusList : $status ;\n+                                    if($lastStatus == 'Enquiry collected') {\n+                                            $showAddItems = true;\n+                                            $style =\"style=background-color:yellow;padding:5px;\";\n+                                    } else {\n+                                        $style =\"style=background-color:none\";\n+                                        $showAddItems = false;\n+                                    }\n+                                    $statusss = null;\n+                                    if ($shipment->boxes->isEmpty()) {\n+                                        $statusss = $shipment->status_id;\n+                                    } else {\n+                                        if($statusss == 15 || $statusss == 1 || $statusss == null) {\n+\n+                                            foreach ($shipment->boxes as $box) {\n+                                                $latestStatus = $box->boxStatuses()->orderBy('id', 'desc')->first();\n+                                                if ($latestStatus && ($latestStatus->id != 15 && $latestStatus->id != 1)) {\n+                                                    $statusss = $latestStatus->status_id;\n+                                                    break;\n+                                                }\n+                                            }\n+                                        }\n+                                        else{\n+                                            $statusss = $shipment->status_id;\n+                                        }\n+\n+                                    }\n+                                ?>\n+                                    <tr>\n+                                        <td>\n+                                            @can(permission_edit())\n+                                            @if(branch()->id == $shipment->branch_id)\n+                                                <a href=\"{{edit_url($shipment->id)}}\"\n+                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning editBtn\" ststus=\"{{$statusss}}\" statusName=\"{{  $lastStatus??'' }}\">\n+                                                    <i class=\"fas  fa-lg fa-pencil-alt\"></i>\n+                                                </a>\n+                                            @endif\n+                                            @endcan\n+                                            @can(permission_view())\n+                                                <a href=\"{{show_url($shipment->id)}}\"\n+                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-success \">\n+                                                    <i class=\"fas  fa-lg fa-eye\"></i>\n+                                                </a>\n+                                            @endcan\n+                                            @can('shipment-print')\n+                                                <a href=\"{{route('branch.shipment.print',$shipment->id)}}\" target=\"_blank\"\n+                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\">\n+                                                    <i class=\"fas  fa-lg fa-print\"   title=\"Customs copy\"></i>\n+                                                </a>\n+\n+                                                <!--<a href=\"{{route('branch.shipment.print_customer',$shipment->id)}}\" target=\"_blank\"-->\n+                                                <!--    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\" style=\"background:#1274bb; border: 0px;\"  >-->\n+                                                <!--    <i class=\"fas  fa-lg fa-print\"   title=\"Customer copy\"></i>-->\n+                                                <!--</a>-->\n+\n+                                            @endcan\n+                                            @if($showAddItems)\n+                                                @if(branch()->id == $shipment->branch_id)\n+                                                    <a href=\"{{edit_url($shipment->id)}}\"\n+                                                        class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning\" >\n+                                                        <i class=\"fas  fa-lg fa-plus\"></i>\n+                                                    </a>\n+                                                @endif\n+                                            @endif\n+                                        </td>\n+                                        <td>{{ $shipment->booking_number }}</td>\n+                                        <td>{{ $shipment->number_of_pcs?$shipment->number_of_pcs: $shipment->number_of_pcs_create }}</td>\n+                                        <td>{{ $shipment->grand_total_weight }}</td>\n+                                        <td>{{ $shipment->shipMethType->name??\"\" }}</td>\n+                                        <td>{{ $shipment->sender->name }}</td>\n+                                        <td>{{ $shipment->sender->phone??'-' }}</td>\n+                                        <td>{{ $shipment->receiver->name??\"\"}}</td>\n+                                        <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n+                                        <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n+                                        <td>{{ $customer->sender->identification_number }}</td>\n+                                        <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n+                                        <td>{{ $shipment->payment_method }}</td>\n+                                        <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n+                                        <td>    @if($shipment->collected_by == 'driver')\n+                                                    {{ $shipment->driver?$shipment->driver->name:'-'}}\n+                                                @else\n+                                                    {{$shipment->staff?$shipment->staff->full_name:'-'}}\n+                                                @endif\n+                                        </td>\n+                                        <td>{{ !empty($shipment->created_date)? date('d-m-Y', strtotime($shipment->created_date)):''  }}</td>\n+\n+                                        <!-- @canany([permission_edit(),permission_view(),'shipment-show'])\n+                                            <form method=\"post\" action=\"{{delete_url($shipment->id)}}\"> -->\n+                                                <!-- <td>\n+                                                    @can(permission_edit())\n+                                                        <a href=\"{{edit_url($shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n+                                                            <i class=\"fas fa-pencil-alt\"></i>\n+                                                        </a>\n+                                                    @endcan\n+                                                    @can(permission_view())\n+                                                        <a href=\"{{show_url($shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-success\">\n+                                                            <i class=\"fas fa-eye\"></i>\n+                                                        </a>\n+                                                    @endcan\n+                                                    @can('shipment-print')\n+                                                        <a href=\"{{route('branch.shipment.print',$shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-dark\">\n+                                                            <i class=\"fas fa-print\"></i>\n+                                                        </a>\n+                                                    @endcan\n+                                                    @if($showAddItems)\n+                                                        <a href=\"{{route('branch.shipment.item',$shipment->id)}}\"\n+                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n+                                                            <i class=\"fas fa-plus\"></i>\n+                                                        </a>\n+                                                    @endif\n+                                                </td> -->\n+                                            <!-- </form> -->\n+                                        <!-- @endcanany -->\n+                                    </tr>\n+                                @endforeach\n+                                </tbody>\n+                            </table>\n+                            <div class=\"d-flex justify-content-end\">\n+                                {{ $shipments->onEachSide(1)->links() }}\n+                            </div>\n+\n+                        </div>\n+                    </div>\n+                </div>\n+\n+            </div>\n+            <!-- end container-fluid -->\n+\n+        </div>\n+        <!-- end content -->\n+\n+        <div class=\"modal fade\" id=\"exampleModalCenter\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalCenterTitle\" aria-hidden=\"true\">\n+            <div class=\"modal-dialog modal-dialog-centered\" role=\"document\">\n+              <div class=\"modal-content\">\n+                <div class=\"modal-header\">\n+                  <h5 class=\"modal-title\" id=\"exampleModalLongTitle\">Enter access key</h5>\n+                  <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n+                    <span aria-hidden=\"true\">&times;</span>\n+                  </button>\n+                </div>\n+                <div class=\"modal-body\">\n+                  <div class=\"form-group\">\n+                    <input type=\"password\" class=\"form-control\" id=\"passkey\">\n+                  </div>\n+                </div>\n+                <div class=\"modal-footer justify-content-center\">\n+                  {{-- <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button> --}}\n+                  <button type=\"button\" class=\"btn btn-primary\" id=\"passkeyBtn\">Submit</button>\n+                </div>\n+              </div>\n+            </div>\n+        </div>\n+\n+@endsection\n+@section('styles')\n+    @include('layouts.datatables_style')\n+@endsection\n+\n+@section('scripts')\n+    @include('layouts.datatables_js')\n+    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js\"></script>\n+    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js\"></script>\n+    @if(session('showModal'))\n+        <script>\n+            $(document).ready(function() {\n+                $('#exampleModalCenter').modal('show');\n+            });\n+        </script>\n+    @endif\n+    <script>\n+\n+$(document).ready(function () {\n+    $('#bookingdatatable').DataTable({\n+        \"autoWidth\": false,\n+        \"aaSorting\": [ [0,'desc'] ],\n+        \"scrollX\": true,\n+        \"paging\": false,\n+        \"responsive\": false,\n+        \"searching\": false\n+    });\n+\n+    $('.datepicker').datepicker({\n+        format: 'dd/mm/yyyy',\n+        autoclose: true,\n+        todayHighlight: true\n+    });\n+\n+\n+    $('#exportButton').click(function(event) {\n+        event.preventDefault();\n+\n+        var formData = $('#shipmentForm').serialize();\n+\n+        var exportUrl = '/branch/shipment/export?' + formData;\n+\n+        window.location.href = exportUrl;\n+    });\n+\n+    $('.editBtn').click(function(event) {\n+        event.preventDefault();\n+        var status = $(this).attr('ststus') || null;\n+        var statusName = $(this).attr('statusName');\n+        console.log(statusName);\n+        var url = $(this).attr('href');\n+        if(statusName == \"Shipment received\" || statusName == \"Enquiry collected\"){\n+            if(status == 15 || status == 1 || status == 2 || status == null ){\n+            window.location.href = url;\n+            }\n+            else{\n+                $('#passkey').attr('data-url', url);\n+                $('#exampleModalCenter').modal('show');\n+            }\n+        }\n+        else{\n+            $('#passkey').attr('data-url', url);\n+            $('#exampleModalCenter').modal('show');\n+        }\n+    });\n+\n+    $('#passkeyBtn').click(function(event) {\n+        var passkey = $('#passkey').val();\n+        var url = $('#passkey').data('url');\n+        var encryptedPasskey = CryptoJS.SHA256(passkey).toString();\n+\n+        var exportUrl = url + '?password=' + encodeURIComponent(encryptedPasskey);\n+\n+        window.location.href = exportUrl;\n+    });\n+\n+\n+\n+});\n+\n+    </script>\n+@endsection\n"
                },
                {
                    "date": 1733729606743,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -208,9 +208,9 @@\n                                         <td>{{ $shipment->sender->phone??'-' }}</td>\n                                         <td>{{ $shipment->receiver->name??\"\"}}</td>\n                                         <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n                                         <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n-                                        <td>{{ $customer->sender->identification_number }}</td>\n+                                        <td>{{ $shipment->sender->identification_number }}</td>\n                                         <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n                                         <td>{{ $shipment->payment_method }}</td>\n                                         <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n                                         <td>    @if($shipment->collected_by == 'driver')\n@@ -372,379 +372,4 @@\n });\n \n     </script>\n @endsection\n-@extends('layouts.app')\n-\n-@section('content')\n-\n-    <div class=\"content-page\" id=\"content-page\">\n-        <div class=\"content\">\n-\n-            <!-- Start Content-->\n-            <div class=\"container-fluid\">\n-\n-                <!-- start page title -->\n-                <div class=\"row\">\n-                    <div class=\"col-12\">\n-                        <div class=\"page-title-box\">\n-                            <div class=\"page-title-right\">\n-                                {!! breadcrumbs() !!}\n-                            </div>\n-                            <h4 class=\"page-title\">Invoices</h4>\n-                            @can(permission_create())\n-                                <div class=\"fa-pull-right pb-3\"><a href=\"{{create_url()}}\"\n-                                                                   class=\"btn btn-success\">Add New</a></div>\n-                            @endcan\n-                        </div>\n-                    </div>\n-\n-                </div>\n-\n-\n-                <div class=\"row\">\n-                    <div class=\"col-sm-12\">\n-\n-                        <div class=\"card-box table-responsive\">\n-{{--                            <form action=\"\" method=\"get\">--}}\n-{{--                                <div class=\"row justify-content-center\">--}}\n-\n-{{--                                    <div class=\"form-group\">--}}\n-{{--                                        <input type=\"date\" value=\"{{date('Y-m-d')}}\" max=\"{{date('Y-m-d')}}\"--}}\n-{{--                                               class=\"form-control\" id=\"propertyname\" name=\"date\"--}}\n-{{--                                               placeholder=\"Enter title\">--}}\n-{{--                                    </div>--}}\n-{{--                                    <div class=\"pl-1\">--}}\n-{{--                                        <button type=\"submit\" class=\"btn btn-success waves-effect waves-light\">Submit--}}\n-{{--                                        </button>--}}\n-{{--                                    </div>--}}\n-\n-{{--                                </div>--}}\n-{{--                            </form>--}}\n-\n-                            <div class=\"d-flex justify-content-end\" >\n-                                <form action=\"/branch/shipment\" class=\"d-flex\" id=\"shipmentForm\">\n-                                    <div class=\"row\">\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <input type=\"text\" name=\"from_date\" class=\"form-control datepicker\"  placeholder=\"From date\" value=\"{{ request('from_date') }}\">\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <input type=\"text\" name=\"to_date\" class=\"form-control datepicker\"    placeholder=\"To date\" value=\"{{ request('to_date') }}\">\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-3\">\n-                                            <div class=\"form-group\">\n-                                                <input name=\"search\" value=\"{{$search??''}}\" class=\"form-control \" type=\"search\" placeholder=\"Search\" aria-label=\"Search\">\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <button class=\"btn btn-info t-5\" type=\"submit\">Search</button>\n-                                            </div>\n-                                        </div>\n-                                        <div class=\"col-2\">\n-                                            <div class=\"form-group\">\n-                                                <a href=\"#\" class=\"btn btn-success\" id=\"exportButton\">Export</a>\n-                                            </div>\n-                                        </div>\n-                                    </div>\n-                                  </form>\n-                            </div>\n-                            <table id=\"bookingdatatable\"\n-                                   class=\"table table-striped table-bordered dt-responsive nowrap\"\n-                                   style=\"border-collapse: collapse; border-spacing: 0; width: 100%;\">\n-                                <thead>\n-\n-                                <tr>\n-                                    @canany([permission_edit(),permission_view(),'shipment-show'])\n-                                        <th style=\"text-align: center\">Action</th>\n-                                    @endcanany\n-                                    <th>Book<br>No</th>\n-                                    <th>No<br>Pcs</th>\n-                                    <th>Tot<br>Wgt</th>\n-                                    <th>Shipment <br>Type</th>\n-                                    <th>Sender<br>Name</th>\n-                                    <th>Sender<br>Phone</th>\n-                                    <th>Receiver<br>Name</th>\n-                                    <th>Receiver<br>Country</th>             \n-                                    <th>Receiver<br>State</th>\n-                                    <th>Document<br>Id</th>\n-                                    <th>Shipping<br>Status</th>\n-                                    <th>Payment<br>Method</th>\n-                                    <th>Courier<br>Company</th>\n-                                    <th>Driver/<br>Staff</th>\n-                                    <th>Date</th>\n-\n-                                </tr>\n-\n-                                </thead>\n-\n-                                <tbody>\n-                                    <?php\n-                                        $lastStatus = '';\n-                                        $statusList = [];\n-                                    ?>\n-                                @foreach($shipments as $key=> $shipment)\n-\n-                                <?php\n-                                    // if(!empty($shipment->statusVal->name)){\n-                                        // if($shipment->statusVal->name == \"Enquiry collected\") {\n-                                        //     $showAddItems = true;\n-                                        //     $style =\"style=background-color:yellow;padding:5px;\";\n-                                        // } else {\n-                                        //     $style =\"style=background-color:none\";\n-                                        //     $showAddItems = false;\n-                                        // }\n-                                    // }\n-                                    $status = '';\n-                                    $lastStatus = '';\n-                                    $statusList = '';\n-\n-                                    $status = $shipment->statusVal->name;\n-                                    foreach($shipment->boxes as $box) {\n-                                        if(($box->boxStatuses != null)) {\n-                                            $statusList = $shipment->last_status;\n-                                        }\n-                                    }\n-\n-\n-                                    $lastStatus = (!empty($statusList) ) ? $statusList : $status ;\n-                                    if($lastStatus == 'Enquiry collected') {\n-                                            $showAddItems = true;\n-                                            $style =\"style=background-color:yellow;padding:5px;\";\n-                                    } else {\n-                                        $style =\"style=background-color:none\";\n-                                        $showAddItems = false;\n-                                    }\n-                                    $statusss = null;\n-                                    if ($shipment->boxes->isEmpty()) {\n-                                        $statusss = $shipment->status_id;\n-                                    } else {\n-                                        if($statusss == 15 || $statusss == 1 || $statusss == null) {\n-\n-                                            foreach ($shipment->boxes as $box) {\n-                                                $latestStatus = $box->boxStatuses()->orderBy('id', 'desc')->first();\n-                                                if ($latestStatus && ($latestStatus->id != 15 && $latestStatus->id != 1)) {\n-                                                    $statusss = $latestStatus->status_id;\n-                                                    break;\n-                                                }\n-                                            }\n-                                        }\n-                                        else{\n-                                            $statusss = $shipment->status_id;\n-                                        }\n-\n-                                    }\n-                                ?>\n-                                    <tr>\n-                                        <td>\n-                                            @can(permission_edit())\n-                                            @if(branch()->id == $shipment->branch_id)\n-                                                <a href=\"{{edit_url($shipment->id)}}\"\n-                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning editBtn\" ststus=\"{{$statusss}}\" statusName=\"{{  $lastStatus??'' }}\">\n-                                                    <i class=\"fas  fa-lg fa-pencil-alt\"></i>\n-                                                </a>\n-                                            @endif\n-                                            @endcan\n-                                            @can(permission_view())\n-                                                <a href=\"{{show_url($shipment->id)}}\"\n-                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-success \">\n-                                                    <i class=\"fas  fa-lg fa-eye\"></i>\n-                                                </a>\n-                                            @endcan\n-                                            @can('shipment-print')\n-                                                <a href=\"{{route('branch.shipment.print',$shipment->id)}}\" target=\"_blank\"\n-                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\">\n-                                                    <i class=\"fas  fa-lg fa-print\"   title=\"Customs copy\"></i>\n-                                                </a>\n-\n-                                                <!--<a href=\"{{route('branch.shipment.print_customer',$shipment->id)}}\" target=\"_blank\"-->\n-                                                <!--    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\" style=\"background:#1274bb; border: 0px;\"  >-->\n-                                                <!--    <i class=\"fas  fa-lg fa-print\"   title=\"Customer copy\"></i>-->\n-                                                <!--</a>-->\n-\n-                                            @endcan\n-                                            @if($showAddItems)\n-                                                @if(branch()->id == $shipment->branch_id)\n-                                                    <a href=\"{{edit_url($shipment->id)}}\"\n-                                                        class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning\" >\n-                                                        <i class=\"fas  fa-lg fa-plus\"></i>\n-                                                    </a>\n-                                                @endif\n-                                            @endif\n-                                        </td>\n-                                        <td>{{ $shipment->booking_number }}</td>\n-                                        <td>{{ $shipment->number_of_pcs?$shipment->number_of_pcs: $shipment->number_of_pcs_create }}</td>\n-                                        <td>{{ $shipment->grand_total_weight }}</td>\n-                                        <td>{{ $shipment->shipMethType->name??\"\" }}</td>\n-                                        <td>{{ $shipment->sender->name }}</td>\n-                                        <td>{{ $shipment->sender->phone??'-' }}</td>\n-                                        <td>{{ $shipment->receiver->name??\"\"}}</td>\n-                                        <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n-                                        <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n-                                        <td>{{ $customer->identification_number }}</td>\n-                                        <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n-                                        <td>{{ $shipment->payment_method }}</td>\n-                                        <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n-                                        <td>    @if($shipment->collected_by == 'driver')\n-                                                    {{ $shipment->driver?$shipment->driver->name:'-'}}\n-                                                @else\n-                                                    {{$shipment->staff?$shipment->staff->full_name:'-'}}\n-                                                @endif\n-                                        </td>\n-                                        <td>{{ !empty($shipment->created_date)? date('d-m-Y', strtotime($shipment->created_date)):''  }}</td>\n-\n-                                        <!-- @canany([permission_edit(),permission_view(),'shipment-show'])\n-                                            <form method=\"post\" action=\"{{delete_url($shipment->id)}}\"> -->\n-                                                <!-- <td>\n-                                                    @can(permission_edit())\n-                                                        <a href=\"{{edit_url($shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n-                                                            <i class=\"fas fa-pencil-alt\"></i>\n-                                                        </a>\n-                                                    @endcan\n-                                                    @can(permission_view())\n-                                                        <a href=\"{{show_url($shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-success\">\n-                                                            <i class=\"fas fa-eye\"></i>\n-                                                        </a>\n-                                                    @endcan\n-                                                    @can('shipment-print')\n-                                                        <a href=\"{{route('branch.shipment.print',$shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-dark\">\n-                                                            <i class=\"fas fa-print\"></i>\n-                                                        </a>\n-                                                    @endcan\n-                                                    @if($showAddItems)\n-                                                        <a href=\"{{route('branch.shipment.item',$shipment->id)}}\"\n-                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n-                                                            <i class=\"fas fa-plus\"></i>\n-                                                        </a>\n-                                                    @endif\n-                                                </td> -->\n-                                            <!-- </form> -->\n-                                        <!-- @endcanany -->\n-                                    </tr>\n-                                @endforeach\n-                                </tbody>\n-                            </table>\n-                            <div class=\"d-flex justify-content-end\">\n-                                {{ $shipments->onEachSide(1)->links() }}\n-                            </div>\n-\n-                        </div>\n-                    </div>\n-                </div>\n-\n-            </div>\n-            <!-- end container-fluid -->\n-\n-        </div>\n-        <!-- end content -->\n-\n-        <div class=\"modal fade\" id=\"exampleModalCenter\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalCenterTitle\" aria-hidden=\"true\">\n-            <div class=\"modal-dialog modal-dialog-centered\" role=\"document\">\n-              <div class=\"modal-content\">\n-                <div class=\"modal-header\">\n-                  <h5 class=\"modal-title\" id=\"exampleModalLongTitle\">Enter access key</h5>\n-                  <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n-                    <span aria-hidden=\"true\">&times;</span>\n-                  </button>\n-                </div>\n-                <div class=\"modal-body\">\n-                  <div class=\"form-group\">\n-                    <input type=\"password\" class=\"form-control\" id=\"passkey\">\n-                  </div>\n-                </div>\n-                <div class=\"modal-footer justify-content-center\">\n-                  {{-- <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button> --}}\n-                  <button type=\"button\" class=\"btn btn-primary\" id=\"passkeyBtn\">Submit</button>\n-                </div>\n-              </div>\n-            </div>\n-        </div>\n-\n-@endsection\n-@section('styles')\n-    @include('layouts.datatables_style')\n-@endsection\n-\n-@section('scripts')\n-    @include('layouts.datatables_js')\n-    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js\"></script>\n-    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js\"></script>\n-    @if(session('showModal'))\n-        <script>\n-            $(document).ready(function() {\n-                $('#exampleModalCenter').modal('show');\n-            });\n-        </script>\n-    @endif\n-    <script>\n-\n-$(document).ready(function () {\n-    $('#bookingdatatable').DataTable({\n-        \"autoWidth\": false,\n-        \"aaSorting\": [ [0,'desc'] ],\n-        \"scrollX\": true,\n-        \"paging\": false,\n-        \"responsive\": false,\n-        \"searching\": false\n-    });\n-\n-    $('.datepicker').datepicker({\n-        format: 'dd/mm/yyyy',\n-        autoclose: true,\n-        todayHighlight: true\n-    });\n-\n-\n-    $('#exportButton').click(function(event) {\n-        event.preventDefault();\n-\n-        var formData = $('#shipmentForm').serialize();\n-\n-        var exportUrl = '/branch/shipment/export?' + formData;\n-\n-        window.location.href = exportUrl;\n-    });\n-\n-    $('.editBtn').click(function(event) {\n-        event.preventDefault();\n-        var status = $(this).attr('ststus') || null;\n-        var statusName = $(this).attr('statusName');\n-        console.log(statusName);\n-        var url = $(this).attr('href');\n-        if(statusName == \"Shipment received\" || statusName == \"Enquiry collected\"){\n-            if(status == 15 || status == 1 || status == 2 || status == null ){\n-            window.location.href = url;\n-            }\n-            else{\n-                $('#passkey').attr('data-url', url);\n-                $('#exampleModalCenter').modal('show');\n-            }\n-        }\n-        else{\n-            $('#passkey').attr('data-url', url);\n-            $('#exampleModalCenter').modal('show');\n-        }\n-    });\n-\n-    $('#passkeyBtn').click(function(event) {\n-        var passkey = $('#passkey').val();\n-        var url = $('#passkey').data('url');\n-        var encryptedPasskey = CryptoJS.SHA256(passkey).toString();\n-\n-        var exportUrl = url + '?password=' + encodeURIComponent(encryptedPasskey);\n-\n-        window.location.href = exportUrl;\n-    });\n-\n-\n-\n-});\n-\n-    </script>\n-@endsection\n"
                },
                {
                    "date": 1733730002203,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -208,9 +208,9 @@\n                                         <td>{{ $shipment->sender->phone??'-' }}</td>\n                                         <td>{{ $shipment->receiver->name??\"\"}}</td>\n                                         <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n                                         <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n-                                        <td>{{ $shipment->sender->identification_number }}</td>\n+                                        <td>{{ $shipmen->sender->identification_number }}</td>\n                                         <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n                                         <td>{{ $shipment->payment_method }}</td>\n                                         <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n                                         <td>    @if($shipment->collected_by == 'driver')\n"
                }
            ],
            "date": 1733726932267,
            "name": "Commit-0",
            "content": "@extends('layouts.app')\n\n@section('content')\n\n    <div class=\"content-page\" id=\"content-page\">\n        <div class=\"content\">\n\n            <!-- Start Content-->\n            <div class=\"container-fluid\">\n\n                <!-- start page title -->\n                <div class=\"row\">\n                    <div class=\"col-12\">\n                        <div class=\"page-title-box\">\n                            <div class=\"page-title-right\">\n                                {!! breadcrumbs() !!}\n                            </div>\n                            <h4 class=\"page-title\">Invoices</h4>\n                            @can(permission_create())\n                                <div class=\"fa-pull-right pb-3\"><a href=\"{{create_url()}}\"\n                                                                   class=\"btn btn-success\">Add New</a></div>\n                            @endcan\n                        </div>\n                    </div>\n\n                </div>\n\n\n                <div class=\"row\">\n                    <div class=\"col-sm-12\">\n\n                        <div class=\"card-box table-responsive\">\n{{--                            <form action=\"\" method=\"get\">--}}\n{{--                                <div class=\"row justify-content-center\">--}}\n\n{{--                                    <div class=\"form-group\">--}}\n{{--                                        <input type=\"date\" value=\"{{date('Y-m-d')}}\" max=\"{{date('Y-m-d')}}\"--}}\n{{--                                               class=\"form-control\" id=\"propertyname\" name=\"date\"--}}\n{{--                                               placeholder=\"Enter title\">--}}\n{{--                                    </div>--}}\n{{--                                    <div class=\"pl-1\">--}}\n{{--                                        <button type=\"submit\" class=\"btn btn-success waves-effect waves-light\">Submit--}}\n{{--                                        </button>--}}\n{{--                                    </div>--}}\n\n{{--                                </div>--}}\n{{--                            </form>--}}\n\n                            <div class=\"d-flex justify-content-end\" >\n                                <form action=\"/branch/shipment\" class=\"d-flex\" id=\"shipmentForm\">\n                                    <div class=\"row\">\n                                        <div class=\"col-2\">\n                                            <div class=\"form-group\">\n                                                <input type=\"text\" name=\"from_date\" class=\"form-control datepicker\"  placeholder=\"From date\" value=\"{{ request('from_date') }}\">\n                                            </div>\n                                        </div>\n                                        <div class=\"col-2\">\n                                            <div class=\"form-group\">\n                                                <input type=\"text\" name=\"to_date\" class=\"form-control datepicker\"    placeholder=\"To date\" value=\"{{ request('to_date') }}\">\n                                            </div>\n                                        </div>\n                                        <div class=\"col-3\">\n                                            <div class=\"form-group\">\n                                                <input name=\"search\" value=\"{{$search??''}}\" class=\"form-control \" type=\"search\" placeholder=\"Search\" aria-label=\"Search\">\n                                            </div>\n                                        </div>\n                                        <div class=\"col-2\">\n                                            <div class=\"form-group\">\n                                                <button class=\"btn btn-info t-5\" type=\"submit\">Search</button>\n                                            </div>\n                                        </div>\n                                        <div class=\"col-2\">\n                                            <div class=\"form-group\">\n                                                <a href=\"#\" class=\"btn btn-success\" id=\"exportButton\">Export</a>\n                                            </div>\n                                        </div>\n                                    </div>\n                                  </form>\n                            </div>\n                            <table id=\"bookingdatatable\"\n                                   class=\"table table-striped table-bordered dt-responsive nowrap\"\n                                   style=\"border-collapse: collapse; border-spacing: 0; width: 100%;\">\n                                <thead>\n\n                                <tr>\n                                    @canany([permission_edit(),permission_view(),'shipment-show'])\n                                        <th style=\"text-align: center\">Action</th>\n                                    @endcanany\n                                    <th>Book<br>No</th>\n                                    <th>No<br>Pcs</th>\n                                    <th>Tot<br>Wgt</th>\n                                    <th>Shipment <br>Type</th>\n                                    <th>Sender<br>Name</th>\n                                    <th>Sender<br>Phone</th>\n                                    <th>Receiver<br>Name</th>\n                                    <th>Receiver<br>Country</th>\n                                    <th>Receiver<br>Country</th>\n                                    <th>Receiver<br>State</th>\n                                    <th>Shipping<br>Status</th>\n                                    <th>Payment<br>Method</th>\n                                    <th>Courier<br>Company</th>\n                                    <th>Driver/<br>Staff</th>\n                                    <th>Date</th>\n\n                                </tr>\n\n                                </thead>\n\n                                <tbody>\n                                    <?php\n                                        $lastStatus = '';\n                                        $statusList = [];\n                                    ?>\n                                @foreach($shipments as $key=> $shipment)\n\n                                <?php\n                                    // if(!empty($shipment->statusVal->name)){\n                                        // if($shipment->statusVal->name == \"Enquiry collected\") {\n                                        //     $showAddItems = true;\n                                        //     $style =\"style=background-color:yellow;padding:5px;\";\n                                        // } else {\n                                        //     $style =\"style=background-color:none\";\n                                        //     $showAddItems = false;\n                                        // }\n                                    // }\n                                    $status = '';\n                                    $lastStatus = '';\n                                    $statusList = '';\n\n                                    $status = $shipment->statusVal->name;\n                                    foreach($shipment->boxes as $box) {\n                                        if(($box->boxStatuses != null)) {\n                                            $statusList = $shipment->last_status;\n                                        }\n                                    }\n\n\n                                    $lastStatus = (!empty($statusList) ) ? $statusList : $status ;\n                                    if($lastStatus == 'Enquiry collected') {\n                                            $showAddItems = true;\n                                            $style =\"style=background-color:yellow;padding:5px;\";\n                                    } else {\n                                        $style =\"style=background-color:none\";\n                                        $showAddItems = false;\n                                    }\n                                    $statusss = null;\n                                    if ($shipment->boxes->isEmpty()) {\n                                        $statusss = $shipment->status_id;\n                                    } else {\n                                        if($statusss == 15 || $statusss == 1 || $statusss == null) {\n\n                                            foreach ($shipment->boxes as $box) {\n                                                $latestStatus = $box->boxStatuses()->orderBy('id', 'desc')->first();\n                                                if ($latestStatus && ($latestStatus->id != 15 && $latestStatus->id != 1)) {\n                                                    $statusss = $latestStatus->status_id;\n                                                    break;\n                                                }\n                                            }\n                                        }\n                                        else{\n                                            $statusss = $shipment->status_id;\n                                        }\n\n                                    }\n                                ?>\n                                    <tr>\n                                        <td>\n                                            @can(permission_edit())\n                                            @if(branch()->id == $shipment->branch_id)\n                                                <a href=\"{{edit_url($shipment->id)}}\"\n                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning editBtn\" ststus=\"{{$statusss}}\" statusName=\"{{  $lastStatus??'' }}\">\n                                                    <i class=\"fas  fa-lg fa-pencil-alt\"></i>\n                                                </a>\n                                            @endif\n                                            @endcan\n                                            @can(permission_view())\n                                                <a href=\"{{show_url($shipment->id)}}\"\n                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-success \">\n                                                    <i class=\"fas  fa-lg fa-eye\"></i>\n                                                </a>\n                                            @endcan\n                                            @can('shipment-print')\n                                                <a href=\"{{route('branch.shipment.print',$shipment->id)}}\" target=\"_blank\"\n                                                    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\">\n                                                    <i class=\"fas  fa-lg fa-print\"   title=\"Customs copy\"></i>\n                                                </a>\n\n                                                <!--<a href=\"{{route('branch.shipment.print_customer',$shipment->id)}}\" target=\"_blank\"-->\n                                                <!--    class=\"btn btn-xs btn-icon waves-effect waves-light btn-dark\" style=\"background:#1274bb; border: 0px;\"  >-->\n                                                <!--    <i class=\"fas  fa-lg fa-print\"   title=\"Customer copy\"></i>-->\n                                                <!--</a>-->\n\n                                            @endcan\n                                            @if($showAddItems)\n                                                @if(branch()->id == $shipment->branch_id)\n                                                    <a href=\"{{edit_url($shipment->id)}}\"\n                                                        class=\"btn btn-xs btn-icon waves-effect waves-light btn-warning\" >\n                                                        <i class=\"fas  fa-lg fa-plus\"></i>\n                                                    </a>\n                                                @endif\n                                            @endif\n                                        </td>\n                                        <td>{{ $shipment->booking_number }}</td>\n                                        <td>{{ $shipment->number_of_pcs?$shipment->number_of_pcs: $shipment->number_of_pcs_create }}</td>\n                                        <td>{{ $shipment->grand_total_weight }}</td>\n                                        <td>{{ $shipment->shipMethType->name??\"\" }}</td>\n                                        <td>{{ $shipment->sender->name }}</td>\n                                        <td>{{ $shipment->sender->phone??'-' }}</td>\n                                        <td>{{ $shipment->receiver->name??\"\"}}</td>\n                                        <td>{{ $shipment->receiver->address->country->name??\"\"}}</td>\n                                        <td>{{ $shipment->receiver->address->state->name??\"\"}}</td>\n                                        <td><span {{  (!empty($lastStatus))?$style:''}}>{{  $lastStatus??'' }}</span></td>\n                                        <td>{{ $shipment->payment_method }}</td>\n                                        <td>{{ $shipment->agency?$shipment->agency->name:'-' }}</td>\n                                        <td>    @if($shipment->collected_by == 'driver')\n                                                    {{ $shipment->driver?$shipment->driver->name:'-'}}\n                                                @else\n                                                    {{$shipment->staff?$shipment->staff->full_name:'-'}}\n                                                @endif\n                                        </td>\n                                        <td>{{ !empty($shipment->created_date)? date('d-m-Y', strtotime($shipment->created_date)):''  }}</td>\n\n                                        <!-- @canany([permission_edit(),permission_view(),'shipment-show'])\n                                            <form method=\"post\" action=\"{{delete_url($shipment->id)}}\"> -->\n                                                <!-- <td>\n                                                    @can(permission_edit())\n                                                        <a href=\"{{edit_url($shipment->id)}}\"\n                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n                                                            <i class=\"fas fa-pencil-alt\"></i>\n                                                        </a>\n                                                    @endcan\n                                                    @can(permission_view())\n                                                        <a href=\"{{show_url($shipment->id)}}\"\n                                                           class=\"btn btn-icon waves-effect waves-light btn-success\">\n                                                            <i class=\"fas fa-eye\"></i>\n                                                        </a>\n                                                    @endcan\n                                                    @can('shipment-print')\n                                                        <a href=\"{{route('branch.shipment.print',$shipment->id)}}\"\n                                                           class=\"btn btn-icon waves-effect waves-light btn-dark\">\n                                                            <i class=\"fas fa-print\"></i>\n                                                        </a>\n                                                    @endcan\n                                                    @if($showAddItems)\n                                                        <a href=\"{{route('branch.shipment.item',$shipment->id)}}\"\n                                                           class=\"btn btn-icon waves-effect waves-light btn-warning\">\n                                                            <i class=\"fas fa-plus\"></i>\n                                                        </a>\n                                                    @endif\n                                                </td> -->\n                                            <!-- </form> -->\n                                        <!-- @endcanany -->\n                                    </tr>\n                                @endforeach\n                                </tbody>\n                            </table>\n                            <div class=\"d-flex justify-content-end\">\n                                {{ $shipments->onEachSide(1)->links() }}\n                            </div>\n\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n            <!-- end container-fluid -->\n\n        </div>\n        <!-- end content -->\n\n        <div class=\"modal fade\" id=\"exampleModalCenter\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalCenterTitle\" aria-hidden=\"true\">\n            <div class=\"modal-dialog modal-dialog-centered\" role=\"document\">\n              <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                  <h5 class=\"modal-title\" id=\"exampleModalLongTitle\">Enter access key</h5>\n                  <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                    <span aria-hidden=\"true\">&times;</span>\n                  </button>\n                </div>\n                <div class=\"modal-body\">\n                  <div class=\"form-group\">\n                    <input type=\"password\" class=\"form-control\" id=\"passkey\">\n                  </div>\n                </div>\n                <div class=\"modal-footer justify-content-center\">\n                  {{-- <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button> --}}\n                  <button type=\"button\" class=\"btn btn-primary\" id=\"passkeyBtn\">Submit</button>\n                </div>\n              </div>\n            </div>\n        </div>\n\n@endsection\n@section('styles')\n    @include('layouts.datatables_style')\n@endsection\n\n@section('scripts')\n    @include('layouts.datatables_js')\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js\"></script>\n    @if(session('showModal'))\n        <script>\n            $(document).ready(function() {\n                $('#exampleModalCenter').modal('show');\n            });\n        </script>\n    @endif\n    <script>\n\n$(document).ready(function () {\n    $('#bookingdatatable').DataTable({\n        \"autoWidth\": false,\n        \"aaSorting\": [ [0,'desc'] ],\n        \"scrollX\": true,\n        \"paging\": false,\n        \"responsive\": false,\n        \"searching\": false\n    });\n\n    $('.datepicker').datepicker({\n        format: 'dd/mm/yyyy',\n        autoclose: true,\n        todayHighlight: true\n    });\n\n\n    $('#exportButton').click(function(event) {\n        event.preventDefault();\n\n        var formData = $('#shipmentForm').serialize();\n\n        var exportUrl = '/branch/shipment/export?' + formData;\n\n        window.location.href = exportUrl;\n    });\n\n    $('.editBtn').click(function(event) {\n        event.preventDefault();\n        var status = $(this).attr('ststus') || null;\n        var statusName = $(this).attr('statusName');\n        console.log(statusName);\n        var url = $(this).attr('href');\n        if(statusName == \"Shipment received\" || statusName == \"Enquiry collected\"){\n            if(status == 15 || status == 1 || status == 2 || status == null ){\n            window.location.href = url;\n            }\n            else{\n                $('#passkey').attr('data-url', url);\n                $('#exampleModalCenter').modal('show');\n            }\n        }\n        else{\n            $('#passkey').attr('data-url', url);\n            $('#exampleModalCenter').modal('show');\n        }\n    });\n\n    $('#passkeyBtn').click(function(event) {\n        var passkey = $('#passkey').val();\n        var url = $('#passkey').data('url');\n        var encryptedPasskey = CryptoJS.SHA256(passkey).toString();\n\n        var exportUrl = url + '?password=' + encodeURIComponent(encryptedPasskey);\n\n        window.location.href = exportUrl;\n    });\n\n\n\n});\n\n    </script>\n@endsection\n"
        }
    ]
}
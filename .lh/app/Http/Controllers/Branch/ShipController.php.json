{
    "sourceFile": "app/Http/Controllers/Branch/ShipController.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 32,
            "patches": [
                {
                    "date": 1733216362012,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1733216374522,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,9 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-        dd\n+        dd()\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733216383909,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,9 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-        dd()\n+        dd($ship)\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733216519485,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,9 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-        dd($ship)\n+       \n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217156858,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,9 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-       \n+       $\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217168484,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,9 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-       $\n+       $have\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217174647,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,9 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-       $have\n+       $haveBpox\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217180520,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,9 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-       $haveBpox\n+       $haveBox=\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217188804,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,9 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-       $haveBox=\n+       $haveBox = Box\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217198304,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,9 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-       $haveBox = Box\n+       $haveBox = Box::\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217217951,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,9 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-       $haveBox = Box::\n+       $haveBox = Boxes:\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217230260,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,9 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-       $haveBox = Boxes:\n+       $haveBox = Boxes::wh\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217235749,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,9 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-       $haveBox = Boxes::wh\n+       $haveBox = Boxes::where()\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217273709,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,9 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-       $haveBox = Boxes::where()\n+       $haveBox = Boxes::where('ship_id')\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217287750,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,9 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-       $haveBox = Boxes::where('ship_id')\n+       $haveBox = Boxes::where('ship_id', $id)\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217304943,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,9 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-       $haveBox = Boxes::where('ship_id', $id)\n+       $haveBox = Boxes::where('ship_id', $shipId)\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217313451,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,10 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-       $haveBox = Boxes::where('ship_id', $shipId)\n+       $haveBox = Boxes::where('ship_id', $shipId);\n+       \n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217318607,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -362,9 +362,9 @@\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n        $haveBox = Boxes::where('ship_id', $shipId);\n-       \n+       dd\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217337454,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -362,9 +362,9 @@\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n        $haveBox = Boxes::where('ship_id', $shipId);\n-       dd\n+       dd($count())\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217348290,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -362,9 +362,9 @@\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n        $haveBox = Boxes::where('ship_id', $shipId);\n-       dd($count())\n+       dd(count(havceBOx))\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217355819,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -362,9 +362,9 @@\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n        $haveBox = Boxes::where('ship_id', $shipId);\n-       dd(count(havceBOx))\n+       dd(count(haveB0x))\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217377647,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -362,9 +362,9 @@\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n        $haveBox = Boxes::where('ship_id', $shipId);\n-       dd(count(haveB0x))\n+       dd(count($haveBox))\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217412305,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -362,9 +362,9 @@\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n        $haveBox = Boxes::where('ship_id', $shipId);\n-       dd(count($haveBox))\n+       dd(($haveBox));\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217471815,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,10 +361,10 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-       $haveBox = Boxes::where('ship_id', $shipId);\n-       dd(($haveBox));\n+       $haveBox = Boxes:: where all('ship_id', $shipId);\n+       dd($haveBox);\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217477875,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,9 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-       $haveBox = Boxes:: where all('ship_id', $shipId);\n+       $haveBox = Boxes::where ('ship_id', $shipId);\n        dd($haveBox);\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n"
                },
                {
                    "date": 1733217485233,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,9 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-       $haveBox = Boxes::where ('ship_id', $shipId);\n+       $haveBox = Boxes::all(where ('ship_id', $shipId);\n        dd($haveBox);\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n"
                },
                {
                    "date": 1733217492667,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,9 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-       $haveBox = Boxes::all(where ('ship_id', $shipId);\n+       $haveBox = Boxes::all()-where ('ship_id', $shipId);\n        dd($haveBox);\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n"
                },
                {
                    "date": 1733217501677,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,9 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-       $haveBox = Boxes::all()-where ('ship_id', $shipId);\n+       $haveBox = Boxes::all()->where ('ship_id', $shipId);\n        dd($haveBox);\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n"
                },
                {
                    "date": 1733217507694,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,9 +361,9 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-       $haveBox = Boxes::all()->where ('ship_id', $shipId);\n+       $haveBox = Boxes::all()-> where('ship_id', $shipId);\n        dd($haveBox);\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n"
                },
                {
                    "date": 1733217543189,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,10 +361,10 @@\n         $shipmentTypes = ShipTypes::all();\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n-       $haveBox = Boxes::all()-> where('ship_id', $shipId);\n-       dd($haveBox);\n+       $haveBox = Boxes::all()->where('ship_id', $shipId);\n+       dd(co$haveBox);\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217550366,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -362,9 +362,9 @@\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n        $haveBox = Boxes::all()->where('ship_id', $shipId);\n-       dd(co$haveBox);\n+       dd(count($haveBox));\n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733217623453,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -362,9 +362,9 @@\n         $statuses = status_list_admin(); //Statuses::get();\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n        $haveBox = Boxes::all()->where('ship_id', $shipId);\n-       dd(count($haveBox));\n+    \n         return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n"
                },
                {
                    "date": 1733218272108,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -363,9 +363,9 @@\n         $ports = PortOfOrigins::where('status',1)->get();\n         $agents = Agencies::all();\n        $haveBox = Boxes::all()->where('ship_id', $shipId);\n     \n-        return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n+        return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses',''));\n     }\n \n     public function shipDetailesUpdate(Request $request) {\n          try {\n"
                }
            ],
            "date": 1733216362012,
            "name": "Commit-0",
            "content": "<?php\n\nnamespace App\\Http\\Controllers\\Branch;\n\nuse App\\Http\\Controllers\\BaseController;\nuse App\\Http\\Controllers\\Controller;\nuse App\\Models\\Agencies;\nuse App\\Models\\Branches;\nuse App\\Models\\Countries;\nuse App\\Models\\Customers;\nuse App\\Models\\Packages;\nuse App\\Models\\Shipments;\nuse App\\Models\\Statuses;\nuse App\\Models\\Staffs;\nuse App\\Models\\Ships;\nuse App\\Models\\Boxes;\nuse App\\Models\\Vehicles;\nuse App\\Models\\Drivers;\nuse App\\Models\\ShipsBookings;\nuse App\\Models\\ShipTypes;\nuse App\\Models\\ShipmentTypes;\nuse App\\Models\\Tripsheets;\nuse App\\Models\\ClearingAgents;\nuse App\\Models\\PortOfOrigins;\nuse App\\Models\\ShipmentsStatuses;\nuse Illuminate\\Http\\Request;\nuse Illuminate\\Support\\Facades\\Log;\nuse Illuminate\\Support\\Collection;\nuse DataTables;\nuse DB;\n\nclass ShipController extends BaseController\n{\n    /**\n     * Display a listing of the resource.\n     *\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function index(Request $request)\n    {\n\n    }\n\n    /**\n     * Show the form for creating a new resource.\n     *\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function create()\n    {\n\n        $ships =  Ships::with('createdBy','shipmentStatus','shipmentMethodTypes','portOfOrigins','portOfDestinations','clearingAgents')->where('branch_id', branch()->id)->orderBy('id', 'desc')->get();\n        $staffs = Staffs::notadmin()->get();\n        $shipmentTypes = ShipTypes::all();\n        $statuses = status_list_admin(); //Statuses::get();\n        $ports = PortOfOrigins::where('status',1)->get();\n        $agents = Agencies::all();\n        return view('branches.ships.create', compact('staffs', 'ships', 'shipmentTypes', 'ports', 'agents','statuses'));\n\n    }\n\n    /**\n     * Store a newly created resource in storage.\n     *\n     * @param \\Illuminate\\Http\\Request $request\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function store(Request $request)\n    {\n\n        //  return $request;\n        // if (Ships::where('shipment_id', '=', $request->shipment_id)->first() != null) {\n        //     toastr()->error('shipment id already exists');\n        //     return redirect()->back();\n        // }\n\n        // if (Ships::where('shipment_name', '=', $request->shipment_name)->first() != null) {\n        //     toastr()->error('shipment name already exists');\n        //     return redirect()->back();\n        // }\n\n        // $messages = [\n        //     'shipment_id.required' => 'shipment number is required',\n        //     'shipment_name.required' => 'shipment name is required',\n        //     'shipment_type.required' => 'shipment type is required',\n        //     'port_of_origin.required' => 'port of origin required',\n        //     'port_of_origin.required' => 'port of origin required',\n        // ];\n\n        // $request->validate([\n        //     'shipment_id' => 'required|unique:ships',\n        //     'shipment_name' => 'required',\n        //     'shipment_type' => 'required',\n        //     'port_of_origin' => 'required',\n        // ]);\n\n\n        try {\n            \\DB::beginTransaction();\n            $ships = new Ships();\n            $ships->shipment_id = $request->shipment_id;\n            $ships->shipment_name = $request->shipment_id;\n            $ships->shipment_type_id = $request->shipment_type;\n            $ships->port_of_origin_id = $request->port_of_origin;\n            $ships->port_of_destination_id = $request->port_of_destination;\n            $ships->clearing_agent_id = $request->clearing_agent;\n            $ships->awd_id = $request->awd_number;\n            $ships->awb_number = $request->awd_number;\n            $ships->created_date = $request->created_date;\n            // $ships->created_time = $request->created_time;\n            $ships->license_details = $request->license_details;\n            $ships->shipment_details = $request->shipment_details;\n            $ships->created_by = $request->created_by;\n            $ships->branch_id = branch()->id;\n            $ships->shipment_status = $request->status;\n            $ships->exchange_rate = $request->exchange_rate;\n            $ships->save();\n            $ship_id = $ships->id;\n\n            \\DB::commit();\n        } catch (\\Exception $e) {\n\n            \\DB::rollBack();\n            Log::error($e->getMessage());\n            toastr()->error($e->getMessage());\n            return redirect()->back();\n        }\n\n        $ship_id = Ships::where('id',$ship_id )->first();\n        toastr()->success(section_title() . 'Added Successfully');\n\n        return  redirect()->route('branch.ship.create');\n        }\n\n    /**\n     * Display the specified resource.\n     *\n     * @param int $id\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function show($id)\n    {\n        $bookings = Shipments::where('ship_id', '')->get();\n\n        return view('branches.ships.create', compact('bookings'));\n\n        // $shipment = Shipments::with('driver')->findOrFail($id);\n        // return view('branches.shipments.show', compact('shipment'));\n    }\n\n    /**\n     * Show the form for editing the specified resource.\n     *\n     * @param int $id\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function edit($id)\n    {\n        $shipment = Shipments::with('driver')->findOrFail($id);\n        $agencies = Agencies::all();\n        $origin_offices = Branches::all();\n        $countries = Countries::all();\n        $drivers = Drivers::whereActive(true)->get();\n        return view('branches.shipments.edit', compact('shipment', 'agencies', 'origin_offices', 'countries','drivers'));\n\n    }\n\n    /**\n     * Update the specified resource in storage.\n     *\n     * @param \\Illuminate\\Http\\Request $request\n     * @param int $id\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function update(Request $request, $id)\n    {\n        try {\n            \\DB::beginTransaction();\n            $shipments = Shipments::findOrFail($id);\n            $shipments->booking_number = $request->booking_number;\n            $shipments->status_id = $request->status_id;\n            $shipments->sender_id = $request->sender_id;\n            $shipments->receiver_id = $request->receiver_id;\n            $shipments->created_by = $request->user()->id;\n            $shipments->shiping_date = date(\"Y-m-d\");\n            $shipments->receipt_number = $request->receipt_number;\n            $shipments->packing_type = $request->packing_type;\n            $shipments->courier_company = $request->courier_company;\n            $shipments->shiping_method = $request->shiping_method;\n            $shipments->payment_method = $request->payment_method;\n            $shipments->number_of_pcs = $request->number_of_pcs;\n            $shipments->weight = $request->weight;\n            $shipments->rate = $request->rate;\n            $shipments->packing_charge = $request->packing_charge;\n            $shipments->other_charges = $request->other_charges;\n            $shipments->discount = $request->discount;\n            $shipments->total_amount = $request->total_amount;\n            $shipments->length = $request->length;\n            $shipments->width = $request->width;\n            $shipments->height = $request->height;\n            $shipments->driver_id = $request->driver_id;\n            $shipments->barcode = $request->barcode;\n            $shipments->lrl_tracking_code = $request->lrl_tracking_code;\n            $shipments->updated_by = $request->user()->id;\n            $shipments->save();\n            $status = Statuses::find($request->status_id);\n            $shipments->status()->attach($status);\n            Packages::where('shipment_id', $shipments->id)->delete();\n\n            if ($request->description!=null) {\n                for ($i = 0; $i < count($request->description); $i++) {\n                    $package = new Packages();\n                    $package->shipment_id = $shipments->id;\n                    $package->branch_id = $shipments->branch_id;\n                    $package->description = $request->description[$i];\n                    $package->quantity = $request->qty[$i];\n                    $package->unit_price = $request->unit[$i];\n                    $package->subtotal = $request->subtotal[$i];\n                    $package->save();\n                }\n            }\n            \\DB::commit();\n        } catch (\\Exception $e) {\n\n            \\DB::rollBack();\n            Log::error($e->getMessage());\n            toastr()->error($e->getMessage());\n            return redirect()->back();\n        }\n        toastr()->success(section_title() . ' Updated Successfully');\n        return redirect()->to(index_url());\n    }\n\n    /**\n     * Remove the specified resource from storage.\n     *\n     * @param int $id\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function destroy($id)\n    {\n        //\n    }\n\n    public function print($id){\n        $shipment = Shipments::with('boxes')->with('packages')->with('agency')->with('receiver')->with('sender')->findOrFail($id);\n        return view('branches.shipments.printview', compact('shipment'));\n    }\n\n    public function groupbookings(Request $request){\n\n        // $bookinigIds = $request->bookinigId;\n        $bookinigIds = explode(',',  $request->bookinigId);\n        $ship_id = $request->ship_id;\n        $shipments = Shipments::where('ship_id', $ship_id)->update(['ship_id' => null]);\n\n        ShipsBookings::where('ship_id', $ship_id)->delete();\n\n        foreach( $bookinigIds as   $bookinigId ) {\n            $ship_bookings = new ShipsBookings();\n            $ship_bookings->ship_id = $ship_id;\n            $ship_bookings->booking_number =$bookinigId;\n            $ship_bookings->save();\n            $shipment = Shipments::where('id', $bookinigId)->update(['ship_id' =>  $ship_id]);\n        }\n\n        $ship_bookingsList = ShipsBookings::with('shipment')->with('ship')->where('ship_id', $ship_id)->get();\n        $res ='';\n        $tot_weight = 0;\n        $tot_value = 0;\n        $tot_temp =0;\n        foreach( $ship_bookingsList as $booking) {\n            $tot_temp= $booking->shipment->total_weight +$booking->shipment->msic_weight;\n            $tot_weight +=$tot_temp;\n            $tot_value += $booking->shipment->grand_total;\n            $res.= '<tr><td style=\"text-align:center\" >'.$booking->shipment->booking_number.'</td> ';\n            $res.= ' <td style=\"text-align:center\">'.$booking->ship->shipment_name.'</td>';\n            $res.= ' <td style=\"text-align:center\">'.$booking->shipment->number_of_pcs .'</td>';\n            $res.= ' <td style=\"text-align:center\">'.$booking->shipment->total_weight +$booking->shipment->msic_weight .'</td>';\n            $res.= ' <td style=\"text-align:center\">'.$booking->shipment->grand_total.'</td>';\n            $res.= ' <td style=\"text-align:center\"> Shipment Forwarded </td>';\n            $res.= '<td>\n                    <a href=\"#\"\n                       class=\"btn btn-icon waves-effect waves-light btn-success\">\n                        <i class=\"fas fa-eye\"></i>\n                    </a>\n                    <a href=\"shipment/print/'.$booking->shipment->id.'\"\n                       class=\"btn btn-icon waves-effect waves-light btn-success\">\n                        <i class=\"fas fa-print\"></i>\n                    </a>\n                    <a href=\"#\"\n                       class=\"btn btn-icon waves-effect waves-light btn-dark\">\n                        <i class=\"fas fa-undo\"></i>\n                    </a>\n                 </td> </tr>';\n            }\n            $res.='<tr><td  colspan=\"3\"> </td><td style=\"text-align:center\">'. $tot_weight.'</td><td style=\"text-align:center\" >'.$tot_value.'</td> <td colspan=\"2\"  ></td></tr>';\n            return $res;\n\n    }\n\n    public function getBoxDetails(Request $request) {\n        $boxId = $request->boxId;\n        $boxName = $request->boxName;\n        // $checkStatus = ShipsBookings::with('shipment.boxes','shipment.boxes.boxStatuses.status')->where('booking_id',$bookingId)->first();\n        $checkStatus = Boxes::with('boxStatuses.status')->where('id',$boxId)->first();\n        // foreach($checkStatus->shipment->boxes as $key => $boxes) {\n        foreach($checkStatus->boxStatuses as $key1 => $status) {\n            $checkStatus['dated'] = date('d-m-Y',strtotime($status->created_at));\n        }\n        // }\n        return response()->json($checkStatus);\n    }\n\n    public function viewManifesto(Request $request, $id) {\n        $id= $id;\n        $statuses = status_list_admin(); //Statuses::get();\n        $getShips = Ships::find($id);\n        // $querys = ShipsBookings::with('shipment','shipment.shipmentStatus','shipment.bookingNumberStatus.status','shipment.sender','shipment.receiver.address','shipment.receiver.address.state','shipment.boxes','shipment.boxes.boxStatuses','shipment.boxes.boxStatuses.status','shipment.agency','shipment.branch','ship','ship.createdBy','ship.origin','ship.portOfOrigins','ship.shipmentTypes','ship.clearingAgents')->where('ship_id',$id);\n\n        $querys =Boxes::with('shipment.driver','shipment.boxes','shipment.shipmentStatus','shipment.sender','shipment.receiver.address','shipment.receiver.address.state','shipment.boxes','shipment.boxes.boxStatuses','shipment.boxes.boxStatuses.status','shipment.agency','shipment.branch')->where('ship_id', $id)->where('is_transfer',0);\n\n        $ships = $querys->get();\n\n        return view('branches.ships.viewManifesto',compact('id','ships','getShips','statuses'));\n    }\n\n    public function manifestoExportView(Request $request, $id) {\n        $id= $id;\n            // $querys = ShipsBookings::with('shipment','shipment.shipmentStatus','shipment.bookingNumberStatus.status','shipment.sender','shipment.receiver.address','shipment.receiver.address.state','shipment.boxes','shipment.boxes.boxStatuses','shipment.boxes.boxStatuses.status','shipment.branch','ship','ship.createdBy','ship.portOfOrigins','ship.shipmentTypes','ship.clearingAgents')\n            //                         ->where('ship_id',$id);\n\n            // $querys = ShipsBookings::with('shipment','shipment.agency','shipment.shipmentStatus','shipment.bookingNumberStatus.status','shipment.sender','shipment.receiver.address','shipment.receiver.address.state','shipment.boxes','shipment.boxes.packages','shipment.boxes.boxStatuses','shipment.boxes.boxStatuses.status','shipment.branch','ship','ship.createdBy','ship.origin','ship.portOfOrigins','ship.shipmentTypes','ship.clearingAgents')->whereHas('shipment',function ($query) use ($request) {\n            //     $query->where('branch_id', branch()->id);\n            //     $query->where('is_transfer', NULL);\n            // })->where('ship_id',$id);\n// dd(branch()->id );\n            // $querys =Boxes::with('shipment')->whereHas('shipment',function ($query) use ($id) {\n            //         $query->where('branch_id', branch()->id);\n            //         $query->where('ship_id',$id);\n            //     })->where('is_transfer',0);\n            $querys = Boxes::with('shipment')->where('ship_id',$id)->where('is_transfer',0);\n\n            $boxes = $querys->get();\n\n            //   dd($boxes);\n            $getShips = Ships::find($id);\n            $statuses = status_list_admin(); //Statuses::get();\n            $branches = Branches::all();\n            $drivers = Drivers::all();\n            $tripsheets = Tripsheets::where('branch_id', branch()->id)->where('status', 'trip_created')->get();\n\n\n        return view('branches.ships.manifestoView',compact('id','boxes', 'branches', 'drivers', 'tripsheets','statuses','getShips'));\n    }\n\n    public function editShip($id) {\n        $shipId = $id;\n        $ship =  Ships::with('createdBy','shipmentStatus','shipmentMethodTypes','portOfOrigins','portOfDestinations','clearingAgents')->where('branch_id', branch()->id)->orderBy('id', 'desc')->find($id);\n        $staffs = Staffs::notadmin()->get();\n        $shipmentTypes = ShipTypes::all();\n        $statuses = status_list_admin(); //Statuses::get();\n        $ports = PortOfOrigins::where('status',1)->get();\n        $agents = Agencies::all();\n        dd\n        return view('branches.ships.editShips', compact('staffs', 'ship', 'shipmentTypes', 'ports', 'agents','statuses'));\n    }\n\n    public function shipDetailesUpdate(Request $request) {\n         try {\n            \\DB::beginTransaction();\n            $ships = Ships::find($request->shipId);\n            $ships->shipment_id = $request->shipment_id;\n            $ships->shipment_name = $request->shipment_id;\n            $ships->shipment_type_id = $request->shipment_type;\n            $ships->port_of_origin_id = $request->port_of_origin;\n            $ships->port_of_destination_id = $request->port_of_destination;\n            $ships->clearing_agent_id = $request->clearing_agent;\n            $ships->awd_id = $request->awd_number;\n            $ships->awb_number = $request->awd_number;\n            $ships->created_date = $request->created_date;\n            // $ships->created_time = $request->created_time;\n            $ships->license_details = $request->license_details;\n            $ships->shipment_details = $request->shipment_details;\n            $ships->created_by = $request->created_by;\n            $ships->branch_id = branch()->id;\n            $ships->shipment_status = $request->status;\n            $ships->exchange_rate = $request->exchange_rate;\n            $ships->save();\n            $ship_id = $ships->id;\n\n            \\DB::commit();\n        } catch (\\Exception $e) {\n\n            \\DB::rollBack();\n            Log::error($e->getMessage());\n            toastr()->error($e->getMessage());\n            return redirect()->back();\n        }\n\n        $ship_id = Ships::where('id',$ship_id )->first();\n        toastr()->success('Shipment Updated Successfully');\n\n        return redirect()->route('branch.ship.create');\n    }\n\n    public function detailedView($id) {\n        $shipId = $id;\n        $shipment = Ships::with('createdBy','shipmentStatus','shipmentMethodTypes','portOfOrigins','portOfDestinations','clearingAgents')->where('branch_id', branch()->id)->findOrFail($id);\n        // $shipBookings = ShipsBookings::with('shipment','shipment.boxes')->where('ship_id', $shipId)->get();\n        $shipBookings =  Boxes::with('boxStatuses.status','shipment.shipmentStatus','shipment.packages','boxStatuses.status')->whereHas('shipment',function ($query) {\n            $query->where('branch_id', branch()->id);\n        })->where('is_shipment',1)->where('ship_id',$shipId)->get();\n\n        foreach($shipBookings as $key => $box) {\n            $lastStatus = collect($box->boxStatuses)->last();\n            $shipBookings[$key][\"last_status\"] = $lastStatus->status->name;\n        }\n        // return $shipBookings;\n        return view('branches.ships.detailedView', compact('shipment','shipBookings'));\n    }\n\n}\n"
        }
    ]
}